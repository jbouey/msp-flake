import{s as T,r as j,j as e,K as f}from"./index-D3EplXpq.js";import{g as B,h as A,a as M,i as O,j as P,P as $,R as h,k as L}from"./useIntegrations-A8m14Gip.js";function F({level:s}){const t=h[s||"unknown"]||h.unknown;return e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium rounded",style:{color:t.color,backgroundColor:t.bgColor},children:t.label})}function W({status:s}){const r={pass:{icon:"✓",color:"text-green-400"},fail:{icon:"✗",color:"text-red-400"},critical:{icon:"!",color:"text-red-500"},warning:{icon:"⚠",color:"text-yellow-400"},info:{icon:"i",color:"text-blue-400"}},{icon:t,color:d}=r[s]||r.info;return e.jsx("span",{className:`font-bold ${d}`,children:t})}function z({resource:s}){const[r,t]=j.useState(!1),d=L[s.resource_type]||s.resource_type,l=s.compliance_checks||[],a=l.filter(c=>c.status==="fail"||c.status==="critical"),x=l.filter(c=>c.status==="warning");return e.jsxs("div",{className:"bg-gray-800 rounded-lg border border-gray-700",children:[e.jsx("div",{className:"p-4 cursor-pointer hover:bg-gray-750 transition-colors",onClick:()=>t(!r),children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:"text-xs text-gray-500 uppercase",children:d}),e.jsx(F,{level:s.risk_level})]}),e.jsx("h3",{className:"font-medium text-white",children:s.name}),e.jsx("p",{className:"text-xs text-gray-500 font-mono mt-1",children:s.resource_id})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm",children:[a.length>0&&e.jsxs("span",{className:"text-red-400",children:[a.length," failing"]}),x.length>0&&e.jsxs("span",{className:"text-yellow-400",children:[x.length," warnings"]}),e.jsx("svg",{className:`w-5 h-5 text-gray-400 transition-transform ${r?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]})]})}),r&&e.jsxs("div",{className:"px-4 pb-4 border-t border-gray-700 pt-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-300 mb-3",children:"Compliance Checks"}),e.jsx("div",{className:"space-y-2",children:Object.entries(s.compliance_checks).map(([c,i])=>e.jsx("div",{className:`p-3 rounded-lg ${i.status==="fail"||i.status==="critical"?"bg-red-900/20 border border-red-800":i.status==="warning"?"bg-yellow-900/20 border border-yellow-800":"bg-gray-900/50 border border-gray-700"}`,children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(W,{status:i.status}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium text-white",children:i.check}),e.jsx("span",{className:"text-xs text-gray-500",children:i.control})]}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:i.description}),i.details&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:i.details})]})]})},c))})]})]})}function H({lastSync:s,onSync:r,syncing:t}){const d=l=>l?new Date(l).toLocaleString():"Never";return e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700 flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:"Last synchronized"}),e.jsx("p",{className:"text-white font-medium",children:d(s)})]}),e.jsx("button",{onClick:r,disabled:t,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2",children:t?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4",fill:"none"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Syncing..."]}):e.jsxs(e.Fragment,{children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})}),"Sync Now"]})})]})}function V({resourceTypes:s,selectedType:r,onTypeChange:t,selectedRisk:d,onRiskChange:l}){return e.jsxs("div",{className:"flex flex-wrap gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Resource Type"}),e.jsxs("select",{value:r||"",onChange:a=>t(a.target.value||null),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm",children:[e.jsx("option",{value:"",children:"All Types"}),s.map(a=>e.jsx("option",{value:a,children:L[a]||a},a))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-400 mb-1",children:"Risk Level"}),e.jsxs("select",{value:d||"",onChange:a=>l(a.target.value||null),className:"px-3 py-1.5 bg-gray-700 border border-gray-600 rounded text-white text-sm",children:[e.jsx("option",{value:"",children:"All Levels"}),Object.keys(h).map(a=>e.jsx("option",{value:a,children:h[a].label},a))]})]})]})}function K({total:s,byRisk:r}){return e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:s}),e.jsx("p",{className:"text-sm text-gray-400",children:"Total Resources"})]}),["critical","high","medium","low"].map(t=>e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 border border-gray-700",style:{borderLeftColor:h[t].color,borderLeftWidth:3},children:[e.jsx("p",{className:"text-2xl font-bold",style:{color:h[t].color},children:r[t]||0}),e.jsx("p",{className:"text-sm text-gray-400",children:h[t].label})]},t))]})}function U(){const{siteId:s,integrationId:r}=T(),[t,d]=j.useState(null),[l,a]=j.useState(null),[x,c]=j.useState(0),[i,w]=j.useState(null),u=50,{data:o,isLoading:R}=B(s||null,r||null),{data:g,isLoading:N}=A(s||null,r||null,{resource_type:t||void 0,risk_level:l||void 0,limit:u,offset:x*u}),I=M(),_=O(),{data:m}=P(s||null,r||null,i);if(j.useEffect(()=>{m&&["completed","failed","timeout"].includes(m.status)&&(w(null),s&&r&&_(s,r))},[m==null?void 0:m.status]),!s||!r)return e.jsx("div",{className:"p-6 text-gray-400",children:"Missing site or integration ID"});const k=async()=>{try{const n=await I.mutateAsync({siteId:s,integrationId:r});w(n.job_id)}catch(n){console.error("Sync failed:",n)}},b=(g==null?void 0:g.resources)||[],p=(g==null?void 0:g.total)||0,v={critical:0,high:0,medium:0,low:0,unknown:0};b.forEach(n=>{const C=n.risk_level||"unknown";v[C]=(v[C]||0)+1});const E=Array.from(new Set(b.map(n=>n.resource_type))),y=o?$[o.provider]:null,S=i!==null&&(m==null?void 0:m.status)==="running";return e.jsxs("div",{className:"min-h-screen bg-gray-900 p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-400 mb-1",children:[e.jsx(f,{to:"/sites",className:"hover:text-white",children:"Sites"}),e.jsx("span",{children:"/"}),e.jsx(f,{to:`/sites/${s}`,className:"hover:text-white",children:s}),e.jsx("span",{children:"/"}),e.jsx(f,{to:`/sites/${s}/integrations`,className:"hover:text-white",children:"Integrations"}),e.jsx("span",{children:"/"}),e.jsx("span",{className:"text-white",children:(o==null?void 0:o.name)||r})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-white flex items-center gap-3",children:[(o==null?void 0:o.name)||"Loading...",y&&e.jsx("span",{className:"text-sm font-normal px-2 py-0.5 rounded",style:{backgroundColor:y.color+"20",color:y.color},children:y.name})]}),e.jsxs("p",{className:"text-gray-400 mt-1",children:[p," resources collected"]})]}),e.jsxs(f,{to:`/sites/${s}/integrations`,className:"text-gray-400 hover:text-white flex items-center gap-1",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"Back to Integrations"]})]})]}),o&&e.jsx("div",{className:"mb-6",children:e.jsx(H,{lastSync:o.last_sync,onSync:k,syncing:S})}),e.jsx(K,{total:p,byRisk:v}),e.jsx(V,{resourceTypes:E,selectedType:t,onTypeChange:n=>{d(n),c(0)},selectedRisk:l,onRiskChange:n=>{a(n),c(0)}}),(R||N)&&e.jsx("div",{className:"flex items-center justify-center p-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),!N&&b.length>0&&e.jsx("div",{className:"space-y-3",children:b.map(n=>e.jsx(z,{resource:n},n.id))}),!N&&b.length===0&&e.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 border border-gray-700 text-center",children:[e.jsx("p",{className:"text-gray-400",children:t||l?"No resources match the current filters":"No resources have been collected yet"}),!t&&!l&&e.jsx("button",{onClick:k,disabled:S,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:"Run Initial Sync"})]}),p>u&&e.jsxs("div",{className:"mt-6 flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["Showing ",x*u+1," - ",Math.min((x+1)*u,p)," of ",p]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>c(n=>Math.max(0,n-1)),disabled:x===0,className:"px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600 disabled:opacity-50",children:"Previous"}),e.jsx("button",{onClick:()=>c(n=>n+1),disabled:(x+1)*u>=p,className:"px-3 py-1 bg-gray-700 text-white rounded hover:bg-gray-600 disabled:opacity-50",children:"Next"})]})]})]})}export{U as default};
