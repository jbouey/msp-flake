import{r as l,a6 as T,j as e,S as w,G as j,a7 as b,B as E}from"./index-D3EplXpq.js";function R(t){return t?new Date(t).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"}):"Never"}const I=({role:t})=>{const i={admin:"error",operator:"warning",readonly:"default"};return e.jsx(E,{variant:i[t]||"default",children:t})},D=({status:t})=>{const i={active:"success",disabled:"error",pending:"warning",expired:"default",revoked:"default"};return e.jsx(E,{variant:i[t]||"default",children:t})},O=({user:t,currentUserId:i,onEdit:d,onToggleStatus:n,onDelete:o,onResetPassword:r})=>{const p=t.id===i;return e.jsxs("tr",{className:"hover:bg-fill-tertiary/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-accent-primary flex items-center justify-center text-white font-bold text-sm",children:(t.display_name||t.username).charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-medium text-label-primary",children:[t.display_name||t.username,p&&e.jsx("span",{className:"text-xs text-label-tertiary ml-2",children:"(you)"})]}),e.jsx("p",{className:"text-xs text-label-tertiary",children:t.username})]})]})}),e.jsx("td",{className:"px-4 py-3 text-sm text-label-secondary",children:t.email||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(I,{role:t.role})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(D,{status:t.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-label-tertiary",children:R(t.last_login)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(t),className:"text-xs text-accent-primary hover:underline",children:"Edit"}),e.jsx("button",{onClick:()=>r(t),className:"text-xs text-label-secondary hover:text-label-primary",children:"Reset Password"}),!p&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>n(t),className:`text-xs ${t.status==="active"?"text-yellow-500":"text-green-500"} hover:underline`,children:t.status==="active"?"Disable":"Enable"}),e.jsx("button",{onClick:()=>o(t),className:"text-xs text-red-500 hover:underline",children:"Delete"})]})]})})]})},q=({invite:t,onResend:i,onRevoke:d})=>{const n=new Date(t.expires_at)<new Date;return e.jsxs("tr",{className:"hover:bg-fill-tertiary/50 transition-colors",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-label-primary",children:t.email}),t.display_name&&e.jsx("p",{className:"text-xs text-label-tertiary",children:t.display_name})]})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(I,{role:t.role})}),e.jsx("td",{className:"px-4 py-3",children:e.jsx(D,{status:n?"expired":t.status})}),e.jsx("td",{className:"px-4 py-3 text-sm text-label-tertiary",children:t.invited_by_name||"Unknown"}),e.jsx("td",{className:"px-4 py-3 text-sm text-label-tertiary",children:R(t.expires_at)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>i(t),className:"text-xs text-accent-primary hover:underline",children:"Resend"}),e.jsx("button",{onClick:()=>d(t),className:"text-xs text-red-500 hover:underline",children:"Revoke"})]})})]})},V=({isOpen:t,onClose:i,onSubmit:d,isLoading:n,error:o})=>{const[r,p]=l.useState(""),[x,h]=l.useState("operator"),[m,u]=l.useState("");if(!t)return null;const f=c=>{c.preventDefault(),d({email:r,role:x,display_name:m||void 0})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Invite User"}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Email Address *"}),e.jsx("input",{type:"email",value:r,onChange:c=>p(c.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",placeholder:"user@example.com",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:m,onChange:c=>u(c.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",placeholder:"John Doe"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Role *"}),e.jsxs("select",{value:x,onChange:c=>h(c.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",children:[e.jsx("option",{value:"admin",children:"Admin - Full access including user management"}),e.jsx("option",{value:"operator",children:"Operator - View and execute actions"}),e.jsx("option",{value:"readonly",children:"Readonly - View only access"})]})]}),o&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:o}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-label-secondary hover:text-label-primary transition-colors",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50",disabled:n||!r,children:n?e.jsx(w,{size:"sm"}):"Send Invite"})]})]})]})})},G=({user:t,onClose:i,onSubmit:d,isLoading:n,error:o})=>{const[r,p]=l.useState((t==null?void 0:t.role)||"operator"),[x,h]=l.useState((t==null?void 0:t.display_name)||"");if(l.useEffect(()=>{t&&(p(t.role),h(t.display_name||""))},[t]),!t)return null;const m=u=>{u.preventDefault(),d(t.id,{role:r!==t.role?r:void 0,display_name:x!==t.display_name?x:void 0})};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Edit User"}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Username"}),e.jsx("input",{type:"text",value:t.username,disabled:!0,className:"w-full px-3 py-2 bg-fill-tertiary border border-separator-default rounded-lg text-label-tertiary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Display Name"}),e.jsx("input",{type:"text",value:x,onChange:u=>h(u.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Role"}),e.jsxs("select",{value:r,onChange:u=>p(u.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",children:[e.jsx("option",{value:"admin",children:"Admin"}),e.jsx("option",{value:"operator",children:"Operator"}),e.jsx("option",{value:"readonly",children:"Readonly"})]})]}),o&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:o}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-label-secondary hover:text-label-primary transition-colors",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50",disabled:n,children:n?e.jsx(w,{size:"sm"}):"Save Changes"})]})]})]})})},J=({user:t,onClose:i,onSubmit:d,isLoading:n,error:o})=>{const[r,p]=l.useState(""),[x,h]=l.useState("");if(!t)return null;const m=c=>{c.preventDefault(),r===x&&d(t.id,r)},u=r===x,f=r.length>=12;return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:["Reset Password for ",t.display_name||t.username]}),e.jsxs("form",{onSubmit:m,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"New Password *"}),e.jsx("input",{type:"password",value:r,onChange:c=>p(c.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",placeholder:"Minimum 12 characters",required:!0}),r&&!f&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Password must be at least 12 characters"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Confirm Password *"}),e.jsx("input",{type:"password",value:x,onChange:c=>h(c.target.value),className:"w-full px-3 py-2 bg-fill-secondary border border-separator-default rounded-lg text-label-primary focus:outline-none focus:border-accent-primary",required:!0}),x&&!u&&e.jsx("p",{className:"text-xs text-red-400 mt-1",children:"Passwords do not match"})]}),o&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400 text-sm",children:o}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{type:"button",onClick:i,className:"px-4 py-2 text-label-secondary hover:text-label-primary transition-colors",disabled:n,children:"Cancel"}),e.jsx("button",{type:"submit",className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors disabled:opacity-50",disabled:n||!f||!u,children:n?e.jsx(w,{size:"sm"}):"Reset Password"})]})]})]})})};function W(){const[t,i]=l.useState("users"),[d,n]=l.useState([]),[o,r]=l.useState([]),[p,x]=l.useState(!0),[h,m]=l.useState(null),[u,f]=l.useState(!1),[c,S]=l.useState(null),[P,k]=l.useState(null),[C,v]=l.useState(!1),[U,y]=l.useState(null),_=T.useMemo(()=>{try{return JSON.parse(localStorage.getItem("user")||"{}").id||""}catch{return""}},[]),N=async()=>{x(!0),m(null);try{const[s,a]=await Promise.all([b.getUsers(),b.getInvites()]);n(s),r(a)}catch(s){m(s instanceof Error?s.message:"Failed to load users")}finally{x(!1)}};l.useEffect(()=>{N()},[]);const A=async s=>{v(!0),y(null);try{await b.inviteUser(s),f(!1),N()}catch(a){y(a instanceof Error?a.message:"Failed to send invite")}finally{v(!1)}},M=async(s,a)=>{v(!0),y(null);try{await b.updateUser(s,a),S(null),N()}catch(g){y(g instanceof Error?g.message:"Failed to update user")}finally{v(!1)}},F=async s=>{if(confirm(`Are you sure you want to ${s.status==="active"?"disable":"enable"} ${s.display_name||s.username}?`))try{await b.updateUser(s.id,{status:s.status==="active"?"disabled":"active"}),N()}catch(a){m(a instanceof Error?a.message:"Failed to update user status")}},$=async s=>{if(confirm(`Are you sure you want to delete ${s.display_name||s.username}? This cannot be undone.`))try{await b.deleteUser(s.id),N()}catch(a){m(a instanceof Error?a.message:"Failed to delete user")}},z=async(s,a)=>{v(!0),y(null);try{await b.adminResetPassword(s,a),k(null),alert("Password reset successfully")}catch(g){y(g instanceof Error?g.message:"Failed to reset password")}finally{v(!1)}},B=async s=>{try{await b.resendInvite(s.id),alert("Invite resent successfully"),N()}catch(a){m(a instanceof Error?a.message:"Failed to resend invite")}},L=async s=>{if(confirm(`Are you sure you want to revoke the invite for ${s.email}?`))try{await b.revokeInvite(s.id),N()}catch(a){m(a instanceof Error?a.message:"Failed to revoke invite")}};return p?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(w,{})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-label-primary",children:"User Management"}),e.jsx("p",{className:"text-label-tertiary mt-1",children:"Manage admin users and role-based access control"})]}),e.jsxs("button",{onClick:()=>f(!0),className:"px-4 py-2 bg-accent-primary text-white rounded-lg hover:bg-accent-primary/90 transition-colors flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"Invite User"]})]}),h&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 rounded-lg text-red-400",children:h}),e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs(j,{className:"p-4",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"Total Users"}),e.jsx("p",{className:"text-2xl font-bold text-label-primary",children:d.length})]}),e.jsxs(j,{className:"p-4",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"Active"}),e.jsx("p",{className:"text-2xl font-bold text-green-400",children:d.filter(s=>s.status==="active").length})]}),e.jsxs(j,{className:"p-4",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"Admins"}),e.jsx("p",{className:"text-2xl font-bold text-purple-400",children:d.filter(s=>s.role==="admin").length})]}),e.jsxs(j,{className:"p-4",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"Pending Invites"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-400",children:o.length})]})]}),e.jsxs("div",{className:"flex gap-1 bg-fill-secondary p-1 rounded-lg w-fit",children:[e.jsxs("button",{onClick:()=>i("users"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t==="users"?"bg-accent-primary text-white":"text-label-secondary hover:text-label-primary"}`,children:["Users (",d.length,")"]}),e.jsxs("button",{onClick:()=>i("invites"),className:`px-4 py-2 rounded-md text-sm font-medium transition-colors ${t==="invites"?"bg-accent-primary text-white":"text-label-secondary hover:text-label-primary"}`,children:["Pending Invites (",o.length,")"]})]}),e.jsx(j,{children:t==="users"?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-separator-default",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"User"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Last Login"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-separator-default",children:d.map(s=>e.jsx(O,{user:s,currentUserId:_,onEdit:S,onToggleStatus:F,onDelete:$,onResetPassword:k},s.id))})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-separator-default",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Role"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Invited By"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Expires"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-tertiary",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-separator-default",children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-8 text-center text-label-tertiary",children:"No pending invites"})}):o.map(s=>e.jsx(q,{invite:s,onResend:B,onRevoke:L},s.id))})]})}),e.jsx(V,{isOpen:u,onClose:()=>{f(!1),y(null)},onSubmit:A,isLoading:C,error:U}),e.jsx(G,{user:c,onClose:()=>{S(null),y(null)},onSubmit:M,isLoading:C,error:U}),e.jsx(J,{user:P,onClose:()=>{k(null),y(null)},onSubmit:z,isLoading:C,error:U})]})}export{W as default};
