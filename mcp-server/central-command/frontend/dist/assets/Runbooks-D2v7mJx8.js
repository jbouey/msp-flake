import{j as e,L as C,r as m,u as _,a as S,b as R,G as c,S as A,R as D}from"./index-Dfzg2dGd.js";const g=s=>s<1e3?`${s}ms`:s<6e4?`${(s/1e3).toFixed(1)}s`:`${(s/6e4).toFixed(1)}m`,j=s=>new Date(s).toLocaleDateString([],{month:"short",day:"numeric",year:"numeric"}),E=s=>new Date(s).toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),$=({runbook:s,executions:l,isLoadingExecutions:d,onClose:x})=>{const i=s.success_rate>=95?"text-health-healthy":s.success_rate>=80?"text-health-warning":"text-health-critical";return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/30 backdrop-blur-sm",onClick:x}),e.jsxs("div",{className:"relative w-full max-w-2xl max-h-[90vh] overflow-hidden bg-white/95 backdrop-blur-xl rounded-ios-lg shadow-2xl border border-white/50",children:[e.jsxs("div",{className:"p-6 border-b border-separator-light",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:"text-sm font-mono text-label-tertiary",children:s.id}),e.jsx(C,{level:s.level,showLabel:!0}),s.is_disruptive&&e.jsx("span",{className:"px-2 py-0.5 text-xs bg-orange-100 text-orange-700 rounded-full",children:"Disruptive"})]}),e.jsx("h2",{className:"text-xl font-semibold text-label-primary",children:s.name}),e.jsx("p",{className:"text-label-secondary mt-1",children:s.description})]}),e.jsx("button",{onClick:x,className:"p-2 hover:bg-separator-light rounded-ios-sm transition-colors",children:e.jsx("svg",{className:"w-5 h-5 text-label-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex flex-wrap gap-1 mt-3",children:s.hipaa_controls.map(a=>e.jsxs("span",{className:"px-2 py-1 text-xs bg-accent-tint text-accent-primary rounded-full",children:["HIPAA ",a]},a))})]}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-200px)]",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-4 p-6 bg-gray-50",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Executions"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:s.execution_count.toLocaleString()})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Success Rate"}),e.jsxs("p",{className:`text-2xl font-semibold mt-1 ${i}`,children:[s.success_rate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xs text-gray-600 uppercase tracking-wide",children:"Avg Time"}),e.jsx("p",{className:"text-2xl font-semibold text-gray-900 mt-1",children:g(s.avg_execution_time_ms)})]})]}),e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Execution Steps"}),e.jsx("div",{className:"space-y-2",children:s.steps.map((a,r)=>{const n=a;return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-ios-sm",children:[e.jsx("span",{className:"w-6 h-6 flex items-center justify-center bg-accent-primary text-white text-xs font-medium rounded-full",children:r+1}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:n.action||n.name||`Step ${r+1}`}),n.timeout_seconds&&e.jsxs("p",{className:"text-xs text-gray-500",children:["Timeout: ",n.timeout_seconds,"s"]})]})]},r)})})]}),Object.keys(s.parameters).length>0&&e.jsxs("div",{className:"p-6 border-b border-gray-200",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Parameters"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:Object.entries(s.parameters).map(([a,r])=>e.jsxs("div",{className:"p-2 bg-gray-50 rounded-ios-sm",children:[e.jsx("p",{className:"text-xs text-gray-600",children:a}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:typeof r=="boolean"?r?"Yes":"No":String(r)})]},a))})]}),e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-sm font-semibold text-gray-500 uppercase tracking-wide mb-3",children:"Recent Executions"}),d?e.jsx("div",{className:"space-y-2",children:[1,2,3].map(a=>e.jsx("div",{className:"h-16 bg-gray-100 rounded-ios-sm animate-pulse"},a))}):l.length===0?e.jsx("p",{className:"text-gray-500 text-sm",children:"No recent executions"}):e.jsx("div",{className:"space-y-2",children:l.map(a=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-white border border-gray-200 rounded-ios-sm",children:[e.jsx("div",{className:`w-2 h-2 rounded-full flex-shrink-0 ${a.success?"bg-health-healthy":"bg-health-critical"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:a.hostname}),e.jsx("span",{className:"text-xs text-gray-500",children:a.site_id.replace(/-/g," ").replace(/\b\w/g,r=>r.toUpperCase())})]}),a.output&&e.jsx("p",{className:"text-xs text-gray-600 truncate",children:a.output}),a.error&&e.jsx("p",{className:"text-xs text-health-critical truncate",children:a.error})]}),e.jsxs("div",{className:"text-right flex-shrink-0",children:[e.jsx("p",{className:"text-xs text-gray-500",children:E(a.executed_at)}),e.jsx("p",{className:"text-xs text-gray-600",children:g(a.execution_time_ms)})]})]},a.id))})]}),e.jsx("div",{className:"p-6 bg-gray-50 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("span",{children:["Created: ",j(s.created_at)]}),e.jsxs("span",{children:["Last updated: ",j(s.updated_at)]})]})})]})]})]})},T=()=>{const[s,l]=m.useState(null),[d,x]=m.useState("all"),[i,a]=m.useState(""),{data:r=[],isLoading:n,error:h}=_(),{data:p}=S(s),{data:N=[],isLoading:b}=R(s,10),u=r.filter(t=>{const o=d==="all"||t.level===d,L=i===""||t.name.toLowerCase().includes(i.toLowerCase())||t.id.toLowerCase().includes(i.toLowerCase())||t.hipaa_controls.some(k=>k.toLowerCase().includes(i.toLowerCase()));return o&&L}),y=r.reduce((t,o)=>t+o.execution_count,0),f=r.length>0?r.reduce((t,o)=>t+o.success_rate,0)/r.length:0,v=r.filter(t=>t.level==="L1").length,w=r.filter(t=>t.is_disruptive).length;return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Runbook Library"}),e.jsx("p",{className:"text-label-tertiary mt-1",children:"Automated remediation playbooks with HIPAA control mappings"})]})}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(c,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Total Runbooks"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:r.length})]}),e.jsxs(c,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Total Executions"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:y.toLocaleString()})]}),e.jsxs(c,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Avg Success Rate"}),e.jsxs("p",{className:"text-2xl font-semibold text-health-healthy mt-1",children:[f.toFixed(1),"%"]})]}),e.jsxs(c,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"L1 Deterministic"}),e.jsx("p",{className:"text-2xl font-semibold text-ios-blue mt-1",children:v})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-label-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Search runbooks, HIPAA controls...",value:i,onChange:t=>a(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/50 border border-separator-light rounded-ios-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent"})]}),e.jsx("div",{className:"flex items-center gap-1 bg-separator-light rounded-ios-md p-1",children:["all","L1","L2","L3"].map(t=>e.jsx("button",{onClick:()=>x(t),className:`px-3 py-1.5 text-sm rounded-ios-sm transition-colors ${d===t?"bg-white shadow-sm text-label-primary font-medium":"text-label-secondary hover:text-label-primary"}`,children:t==="all"?"All":t},t))})]}),n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(A,{size:"lg"})}):h?e.jsx(c,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-health-critical",children:"Failed to load runbooks"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:String(h)})]})}):u.length===0?e.jsx(c,{children:e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-label-secondary",children:"No runbooks match your filters"}),e.jsx("button",{onClick:()=>{x("all"),a("")},className:"text-accent-primary text-sm mt-2 hover:underline",children:"Clear filters"})]})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:u.map(t=>e.jsx(D,{runbook:t,onClick:()=>l(t.id)},t.id))}),e.jsx(c,{padding:"sm",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs text-label-tertiary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-ios-blue/10 text-ios-blue rounded",children:"L1"}),e.jsx("span",{children:"Deterministic (<100ms)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-ios-purple/10 text-ios-purple rounded",children:"L2"}),e.jsx("span",{children:"LLM-assisted (2-5s)"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"px-1.5 py-0.5 bg-orange-100 text-orange-700 rounded",children:"Disruptive"}),e.jsxs("span",{children:[w," runbooks may cause service interruption"]})]})]})}),p&&e.jsx($,{runbook:p,executions:N,isLoadingExecutions:b,onClose:()=>l(null)})]})};export{T as Runbooks,T as default};
