import{w as C,r as h,j as e,S,G as _}from"./index-CMHeoQ51.js";const y={timezone:"America/New_York",date_format:"MM/DD/YYYY",session_timeout_minutes:60,require_2fa:!1,auto_update_enabled:!0,update_window_start:"02:00",update_window_end:"06:00",rollout_percentage:5,telemetry_retention_days:90,incident_retention_days:365,audit_log_retention_days:730,email_notifications_enabled:!0,slack_notifications_enabled:!1,escalation_timeout_minutes:60,api_rate_limit:100,webhook_timeout_seconds:30},Y=["America/New_York","America/Chicago","America/Denver","America/Los_Angeles","America/Phoenix","UTC","Europe/London","Europe/Paris"],L=[{value:"MM/DD/YYYY",label:"MM/DD/YYYY (US)"},{value:"DD/MM/YYYY",label:"DD/MM/YYYY (EU)"},{value:"YYYY-MM-DD",label:"YYYY-MM-DD (ISO)"}],p=({title:n,description:s,icon:l,children:d})=>e.jsxs(_,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-ios bg-accent-primary/10 flex items-center justify-center text-accent-primary",children:l}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-label-primary",children:n}),e.jsx("p",{className:"text-sm text-label-tertiary",children:s})]})]}),e.jsx("div",{className:"space-y-4 pl-14",children:d})]}),g=({label:n,description:s,checked:l,onChange:d,disabled:m})=>e.jsxs("label",{className:`flex items-center justify-between py-2 ${m?"opacity-50":"cursor-pointer"}`,children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:n}),s&&e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:s})]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:c=>d(c.target.checked),disabled:m,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-fill-tertiary peer-focus:ring-2 peer-focus:ring-accent-primary/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-primary"})]})]}),j=({label:n,description:s,value:l,onChange:d,options:m})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:n}),s&&e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:s})]}),e.jsx("select",{value:l,onChange:c=>d(c.target.value),className:"px-3 py-1.5 text-sm rounded-ios bg-fill-secondary text-label-primary border border-separator-light focus:border-accent-primary focus:ring-1 focus:ring-accent-primary",children:m.map(c=>e.jsx("option",{value:c.value,children:c.label},c.value))})]}),x=({label:n,description:s,value:l,onChange:d,min:m,max:c,step:f=1,suffix:u})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:n}),s&&e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:s})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"number",value:l,onChange:i=>d(parseInt(i.target.value)||0),min:m,max:c,step:f,className:"w-24 px-3 py-1.5 text-sm rounded-ios bg-fill-secondary text-label-primary border border-separator-light focus:border-accent-primary focus:ring-1 focus:ring-accent-primary text-right"}),u&&e.jsx("span",{className:"text-sm text-label-tertiary",children:u})]})]}),v=({label:n,description:s,value:l,onChange:d})=>e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:n}),s&&e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:s})]}),e.jsx("input",{type:"time",value:l,onChange:m=>d(m.target.value),className:"px-3 py-1.5 text-sm rounded-ios bg-fill-secondary text-label-primary border border-separator-light focus:border-accent-primary focus:ring-1 focus:ring-accent-primary"})]}),A=()=>{const{user:n}=C(),[s,l]=h.useState(y),[d,m]=h.useState(!0),[c,f]=h.useState(!1),[u,i]=h.useState(null),[w,b]=h.useState(!1);h.useEffect(()=>{k()},[]);const k=async()=>{try{const t=localStorage.getItem("auth_token"),r=await fetch("/api/dashboard/admin/settings",{headers:{Authorization:`Bearer ${t}`}});if(r.ok){const o=await r.json();l({...y,...o})}}catch(t){console.error("Failed to load settings:",t)}finally{m(!1)}},N=async()=>{f(!0),i(null);try{const t=localStorage.getItem("auth_token"),r=await fetch("/api/dashboard/admin/settings",{method:"PUT",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify(s)});if(r.ok)i({type:"success",text:"Settings saved successfully"}),b(!1);else{const o=await r.json();i({type:"error",text:o.detail||"Failed to save settings"})}}catch{i({type:"error",text:"Failed to save settings"})}finally{f(!1)}},a=(t,r)=>{l(o=>({...o,[t]:r})),b(!0),i(null)};return(n==null?void 0:n.role)!=="admin"?e.jsxs("div",{className:"p-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-red-600",children:"Access Denied"}),e.jsx("p",{className:"text-label-tertiary mt-2",children:"You need admin privileges to access system settings."})]}):d?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsx(S,{size:"lg"})}):e.jsxs("div",{className:"space-y-6 max-w-4xl",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-label-primary",children:"Settings"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:"Configure system-wide preferences and behavior"})]}),e.jsx("button",{onClick:N,disabled:c||!w,className:"px-4 py-2 text-sm rounded-ios bg-accent-primary text-white hover:bg-accent-primary/90 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:c?"Saving...":"Save Changes"})]}),u&&e.jsx("div",{className:`p-4 rounded-ios ${u.type==="success"?"bg-green-500/10 text-green-600 border border-green-500/20":"bg-red-500/10 text-red-600 border border-red-500/20"}`,children:u.text}),e.jsxs(p,{title:"Display",description:"Configure timezone and date formatting",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),children:[e.jsx(j,{label:"Timezone",description:"Used for scheduling and display",value:s.timezone,onChange:t=>a("timezone",t),options:Y.map(t=>({value:t,label:t}))}),e.jsx(j,{label:"Date Format",value:s.date_format,onChange:t=>a("date_format",t),options:L})]}),e.jsxs(p,{title:"Security",description:"Session and authentication settings",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})}),children:[e.jsx(x,{label:"Session Timeout",description:"Auto-logout after inactivity",value:s.session_timeout_minutes,onChange:t=>a("session_timeout_minutes",t),min:5,max:480,suffix:"minutes"}),e.jsx(g,{label:"Require Two-Factor Authentication",description:"Enforce 2FA for all admin users",checked:s.require_2fa,onChange:t=>a("require_2fa",t)})]}),e.jsxs(p,{title:"Fleet Updates",description:"Configure automatic update behavior",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})}),children:[e.jsx(g,{label:"Automatic Updates",description:"Allow appliances to auto-update within maintenance window",checked:s.auto_update_enabled,onChange:t=>a("auto_update_enabled",t)}),e.jsx(v,{label:"Maintenance Window Start",value:s.update_window_start,onChange:t=>a("update_window_start",t)}),e.jsx(v,{label:"Maintenance Window End",value:s.update_window_end,onChange:t=>a("update_window_end",t)}),e.jsx(x,{label:"Default Rollout Percentage",description:"Initial percentage for staged rollouts",value:s.rollout_percentage,onChange:t=>a("rollout_percentage",t),min:1,max:100,suffix:"%"})]}),e.jsxs(p,{title:"Data Retention",description:"Configure how long data is kept",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),children:[e.jsx(x,{label:"Telemetry Retention",description:"Execution telemetry and metrics",value:s.telemetry_retention_days,onChange:t=>a("telemetry_retention_days",t),min:30,max:365,suffix:"days"}),e.jsx(x,{label:"Incident Retention",description:"Incident history and resolution data",value:s.incident_retention_days,onChange:t=>a("incident_retention_days",t),min:90,max:1825,suffix:"days"}),e.jsx(x,{label:"Audit Log Retention",description:"Admin actions and system events",value:s.audit_log_retention_days,onChange:t=>a("audit_log_retention_days",t),min:365,max:2555,suffix:"days"})]}),e.jsxs(p,{title:"Notifications",description:"Global notification preferences",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),children:[e.jsx(g,{label:"Email Notifications",description:"Send L3 escalations via email",checked:s.email_notifications_enabled,onChange:t=>a("email_notifications_enabled",t)}),e.jsx(g,{label:"Slack Notifications",description:"Post alerts to Slack channels",checked:s.slack_notifications_enabled,onChange:t=>a("slack_notifications_enabled",t)}),e.jsx(x,{label:"Escalation Timeout",description:"Re-notify if not acknowledged",value:s.escalation_timeout_minutes,onChange:t=>a("escalation_timeout_minutes",t),min:5,max:1440,suffix:"minutes"})]}),e.jsxs(p,{title:"API",description:"Rate limiting and webhook configuration",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"})}),children:[e.jsx(x,{label:"API Rate Limit",description:"Requests per minute per client",value:s.api_rate_limit,onChange:t=>a("api_rate_limit",t),min:10,max:1e3,suffix:"req/min"}),e.jsx(x,{label:"Webhook Timeout",description:"Max wait time for webhook responses",value:s.webhook_timeout_seconds,onChange:t=>a("webhook_timeout_seconds",t),min:5,max:120,suffix:"seconds"})]}),e.jsxs(_,{className:"p-6 border-red-500/20",children:[e.jsxs("div",{className:"flex items-start gap-4 mb-6",children:[e.jsx("div",{className:"w-10 h-10 rounded-ios bg-red-500/10 flex items-center justify-center text-red-500",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-label-primary",children:"Danger Zone"}),e.jsx("p",{className:"text-sm text-label-tertiary",children:"Irreversible actions"})]})]}),e.jsxs("div",{className:"space-y-4 pl-14",children:[e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:"Purge Old Telemetry"}),e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:"Delete telemetry older than retention period"})]}),e.jsx("button",{onClick:async()=>{if(confirm("Permanently delete old telemetry data? This cannot be undone."))try{const t=localStorage.getItem("auth_token"),r=await fetch("/api/dashboard/admin/settings/purge-telemetry",{method:"POST",headers:{Authorization:`Bearer ${t}`}}),o=await r.json();r.ok?i({type:"success",text:`Purged ${o.deleted} telemetry records (>${o.retention_days} days old)`}):i({type:"error",text:o.detail||"Purge failed"})}catch{i({type:"error",text:"Failed to purge telemetry"})}},className:"px-3 py-1.5 text-sm rounded-ios bg-red-500/10 text-red-600 border border-red-500/20 hover:bg-red-500/20 transition-colors",children:"Purge Now"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:"Reset Learning Data"}),e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:"Clear all patterns and L1 rules (keeps runbooks)"})]}),e.jsx("button",{onClick:async()=>{if(confirm("Reset ALL learning data? This will delete all patterns and auto-promoted L1 rules. This cannot be undone."))try{const t=localStorage.getItem("auth_token"),r=await fetch("/api/dashboard/admin/settings/reset-learning",{method:"POST",headers:{Authorization:`Bearer ${t}`}}),o=await r.json();r.ok?i({type:"success",text:`Reset complete: ${o.patterns_deleted} patterns and ${o.rules_deleted} rules deleted`}):i({type:"error",text:o.detail||"Reset failed"})}catch{i({type:"error",text:"Failed to reset learning data"})}},className:"px-3 py-1.5 text-sm rounded-ios bg-red-500/10 text-red-600 border border-red-500/20 hover:bg-red-500/20 transition-colors",children:"Reset"})]})]})]})]})};export{A as Settings,A as default};
