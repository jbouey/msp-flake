import{r as x,c as T,d as B,e as M,f as A,j as e,G as n,S as f,B as N}from"./index-ByrxzNCH.js";const D={services:"bg-blue-100 text-blue-700",security:"bg-red-100 text-red-700",network:"bg-purple-100 text-purple-700",storage:"bg-amber-100 text-amber-700",updates:"bg-green-100 text-green-700",active_directory:"bg-indigo-100 text-indigo-700",backup:"bg-cyan-100 text-cyan-700",antivirus:"bg-rose-100 text-rose-700"},F=({severity:t})=>{const i={critical:"bg-health-critical/10 text-health-critical",high:"bg-orange-100 text-orange-700",medium:"bg-yellow-100 text-yellow-700",low:"bg-gray-100 text-gray-600"};return e.jsx("span",{className:`px-2 py-0.5 text-xs rounded-full ${i[t]||i.medium}`,children:t})},I=({checked:t,onChange:i,disabled:a})=>e.jsx("button",{role:"switch","aria-checked":t,disabled:a,onClick:()=>i(!t),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-accent-primary focus:ring-offset-2 ${t?"bg-health-healthy":"bg-gray-300"} ${a?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,children:e.jsx("span",{className:`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${t?"translate-x-6":"translate-x-1"}`})}),z=({runbook:t,onToggle:i,isLoading:a})=>e.jsxs("tr",{className:"border-b border-separator-light hover:bg-fill-secondary/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("div",{className:"flex items-center gap-3",children:e.jsx(I,{checked:t.enabled,onChange:h=>i(t.runbook_id,h),disabled:a})})}),e.jsx("td",{className:"py-3 px-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-label-primary",children:t.name}),e.jsx("p",{className:"text-xs text-label-tertiary font-mono",children:t.runbook_id})]})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`px-2 py-1 text-xs rounded-full ${D[t.category]||"bg-gray-100 text-gray-700"}`,children:t.category.replace(/_/g," ")})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx(F,{severity:t.severity})}),e.jsx("td",{className:"py-3 px-4",children:t.is_disruptive&&e.jsx(N,{variant:"warning",children:"Disruptive"})}),e.jsx("td",{className:"py-3 px-4 text-sm text-label-secondary max-w-xs truncate",children:t.description||"-"})]}),O=()=>{const[t,i]=x.useState(null),[a,h]=x.useState("all"),[c,b]=x.useState(""),[p,d]=x.useState(null),{data:g,isLoading:v}=T(),{data:w=[]}=B(),{data:l=[],isLoading:k}=M(t),m=A(),C=(g==null?void 0:g.sites)||[],y=x.useMemo(()=>l.filter(s=>{var o;const r=a==="all"||s.category===a,u=c===""||s.name.toLowerCase().includes(c.toLowerCase())||s.runbook_id.toLowerCase().includes(c.toLowerCase())||(((o=s.description)==null?void 0:o.toLowerCase().includes(c.toLowerCase()))??!1);return r&&u}),[l,a,c]),S=l.filter(s=>s.enabled).length,R=l.filter(s=>!s.enabled).length,L=l.filter(s=>s.is_disruptive).length,_=x.useMemo(()=>{const s={};return l.forEach(r=>{s[r.category]=(s[r.category]||0)+1}),s},[l]),$=async(s,r)=>{if(t)try{await m.mutateAsync({siteId:t,runbookId:s,enabled:r}),d({message:`Runbook ${r?"enabled":"disabled"}`,type:"success"}),setTimeout(()=>d(null),2e3)}catch(u){d({message:`Failed to update runbook: ${u}`,type:"error"}),setTimeout(()=>d(null),3e3)}},j=async(s,r)=>{if(!t)return;const u=l.filter(o=>o.category===s);for(const o of u)try{await m.mutateAsync({siteId:t,runbookId:o.runbook_id,enabled:r})}catch(E){console.error(`Failed to update ${o.runbook_id}:`,E)}d({message:`${s} runbooks ${r?"enabled":"disabled"}`,type:"success"}),setTimeout(()=>d(null),2e3)};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Runbook Configuration"}),e.jsx("p",{className:"text-label-tertiary mt-1",children:"Enable or disable automated remediation runbooks per site"})]})}),e.jsx(n,{children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("label",{className:"text-sm font-medium text-label-secondary",children:"Select Site:"}),v?e.jsx(f,{size:"sm"}):e.jsxs("select",{value:t||"",onChange:s=>i(s.target.value||null),className:"flex-1 max-w-md px-3 py-2 bg-fill-secondary text-label-primary border border-separator-light rounded-ios focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[e.jsx("option",{value:"",children:"Choose a site..."}),C.map(s=>e.jsxs("option",{value:s.site_id,children:[s.clinic_name," (",s.site_id,")"]},s.site_id))]})]})}),t?k?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(f,{size:"lg"})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(n,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Total Runbooks"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:l.length})]}),e.jsxs(n,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Enabled"}),e.jsx("p",{className:"text-2xl font-semibold text-health-healthy mt-1",children:S})]}),e.jsxs(n,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Disabled"}),e.jsx("p",{className:"text-2xl font-semibold text-label-tertiary mt-1",children:R})]}),e.jsxs(n,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Disruptive"}),e.jsx("p",{className:"text-2xl font-semibold text-health-warning mt-1",children:L})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-label-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Search runbooks...",value:c,onChange:s=>b(s.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/50 border border-separator-light rounded-ios-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-1 bg-separator-light rounded-ios-md p-1",children:[e.jsxs("button",{onClick:()=>h("all"),className:`px-3 py-1.5 text-sm rounded-ios-sm transition-colors ${a==="all"?"bg-white shadow-sm text-label-primary font-medium":"text-label-secondary hover:text-label-primary"}`,children:["All (",l.length,")"]}),w.map(s=>e.jsxs("button",{onClick:()=>h(s),className:`px-3 py-1.5 text-sm rounded-ios-sm transition-colors ${a===s?"bg-white shadow-sm text-label-primary font-medium":"text-label-secondary hover:text-label-primary"}`,children:[s.replace(/_/g," ")," (",_[s]||0,")"]},s))]})]}),a!=="all"&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-sm text-label-tertiary",children:["Bulk actions for ",a,":"]}),e.jsx("button",{onClick:()=>j(a,!0),disabled:m.isPending,className:"px-3 py-1.5 text-xs rounded-ios bg-health-healthy/10 text-health-healthy hover:bg-health-healthy/20 disabled:opacity-50 transition-colors",children:"Enable All"}),e.jsx("button",{onClick:()=>j(a,!1),disabled:m.isPending,className:"px-3 py-1.5 text-xs rounded-ios bg-blue-50 text-blue-600 hover:bg-blue-100 disabled:opacity-50 transition-colors",children:"Disable All"})]}),e.jsx(n,{className:"overflow-hidden",children:y.length===0?e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{className:"text-label-secondary",children:"No runbooks match your filters"}),e.jsx("button",{onClick:()=>{h("all"),b("")},className:"text-accent-primary text-sm mt-2 hover:underline",children:"Clear filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-fill-secondary text-left text-xs uppercase text-label-tertiary tracking-wide",children:[e.jsx("th",{className:"py-3 px-4 w-20",children:"Enabled"}),e.jsx("th",{className:"py-3 px-4",children:"Runbook"}),e.jsx("th",{className:"py-3 px-4",children:"Category"}),e.jsx("th",{className:"py-3 px-4",children:"Severity"}),e.jsx("th",{className:"py-3 px-4",children:"Flags"}),e.jsx("th",{className:"py-3 px-4",children:"Description"})]})}),e.jsx("tbody",{children:y.map(s=>e.jsx(z,{runbook:s,onToggle:$,isLoading:m.isPending},s.runbook_id))})]})})}),e.jsx(n,{padding:"sm",children:e.jsxs("div",{className:"flex items-center justify-center gap-6 text-xs text-label-tertiary",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-health-healthy"}),e.jsx("span",{children:"Enabled - Runbook will auto-execute when triggered"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-gray-300"}),e.jsx("span",{children:"Disabled - Runbook skipped, drift still detected"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(N,{variant:"warning",children:"Disruptive"}),e.jsx("span",{children:"May cause service interruption"})]})]})})]}):e.jsx(n,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-16 h-16 mx-auto text-label-tertiary mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1,d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})}),e.jsx("p",{className:"text-label-secondary text-lg",children:"Select a site to configure runbooks"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:"Each site can have its own runbook configuration"})]})}),p&&e.jsx("div",{className:`fixed bottom-4 right-4 px-4 py-3 rounded-ios shadow-lg z-50 ${p.type==="success"?"bg-health-healthy text-white":"bg-health-critical text-white"}`,children:p.message})]})};export{O as RunbookConfig,O as default};
