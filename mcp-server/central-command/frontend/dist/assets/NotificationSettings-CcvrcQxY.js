import{r as x,j as e,S as w,G as j,B as N}from"./index-Dfzg2dGd.js";const k={email_enabled:!0,email_recipients:[],email_from_name:null,slack_enabled:!1,slack_webhook_url:null,slack_channel:"#incidents",slack_username:"OsirisCare",slack_icon_emoji:":warning:",pagerduty_enabled:!1,pagerduty_routing_key:null,pagerduty_service_id:null,teams_enabled:!1,teams_webhook_url:null,webhook_enabled:!1,webhook_url:null,webhook_secret:null,webhook_headers:null,escalation_timeout_minutes:60,auto_acknowledge:!1,include_raw_data:!0},b=({title:t,description:n,icon:p,enabled:c,onToggle:h,onTest:i,testResult:s,children:d})=>e.jsxs(j,{className:"p-6",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-10 h-10 rounded-ios flex items-center justify-center ${c?"bg-accent-primary/20 text-accent-primary":"bg-fill-tertiary text-label-tertiary"}`,children:p}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-label-primary",children:t}),e.jsx("p",{className:"text-xs text-label-tertiary",children:n})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[c&&i&&e.jsx("button",{onClick:i,disabled:(s==null?void 0:s.status)==="pending",className:"px-3 py-1.5 text-xs rounded-ios bg-fill-secondary text-label-primary border border-separator-light hover:bg-fill-tertiary transition-colors disabled:opacity-50",children:(s==null?void 0:s.status)==="pending"?"Testing...":"Test"}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:c,onChange:h,className:"sr-only peer"}),e.jsx("div",{className:"w-11 h-6 bg-fill-tertiary peer-focus:ring-2 peer-focus:ring-accent-primary/30 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-accent-primary"})]})]})]}),s&&s.status!=="pending"&&e.jsx("div",{className:`mb-4 p-3 rounded-ios text-sm ${s.status==="success"?"bg-green-500/10 text-green-500 border border-green-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"}`,children:s.status==="success"?"Test notification sent successfully!":`Test failed: ${s.message}`}),c&&e.jsx("div",{className:"space-y-4 pt-4 border-t border-separator-light",children:d})]}),m=({label:t,type:n="text",value:p,onChange:c,placeholder:h,helpText:i,required:s})=>e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:[t," ",s&&e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:n,value:p,onChange:d=>c(d.target.value),placeholder:h,className:"w-full px-3 py-2 text-sm rounded-ios bg-fill-secondary text-label-primary border border-separator-light focus:border-accent-primary focus:ring-1 focus:ring-accent-primary"}),i&&e.jsx("p",{className:"text-xs text-label-tertiary mt-1",children:i})]}),C=({label:t,values:n,onChange:p,placeholder:c})=>{const[h,i]=x.useState(""),s=l=>{if(l.key==="Enter"||l.key===","){l.preventDefault();const o=h.trim();o&&!n.includes(o)&&(p([...n,o]),i(""))}},d=l=>{p(n.filter((o,f)=>f!==l))};return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:t}),e.jsxs("div",{className:"flex flex-wrap gap-2 p-2 rounded-ios bg-fill-secondary border border-separator-light min-h-[42px]",children:[n.map((l,o)=>e.jsxs(N,{variant:"default",className:"flex items-center gap-1",children:[l,e.jsx("button",{onClick:()=>d(o),className:"ml-1 hover:text-red-500",children:"x"})]},o)),e.jsx("input",{type:"text",value:h,onChange:l=>i(l.target.value),onKeyDown:s,placeholder:n.length===0?c:"",className:"flex-1 min-w-[150px] bg-transparent outline-none text-sm text-label-primary"})]}),e.jsx("p",{className:"text-xs text-label-tertiary mt-1",children:"Press Enter or comma to add"})]})},T=()=>{const[t,n]=x.useState(k),[p,c]=x.useState(!0),[h,i]=x.useState(!1),[s,d]=x.useState(null),[l,o]=x.useState({});x.useEffect(()=>{f()},[]);const f=async()=>{try{const a=await fetch("/api/partners/me/notifications/settings",{headers:{"X-API-Key":localStorage.getItem("partner_api_key")||""}});if(a.ok){const u=await a.json();n({...k,...u})}}catch(a){console.error("Failed to load notification settings:",a)}finally{c(!1)}},_=async()=>{i(!0),d(null);try{const a=await fetch("/api/partners/me/notifications/settings",{method:"PUT",headers:{"Content-Type":"application/json","X-API-Key":localStorage.getItem("partner_api_key")||""},body:JSON.stringify(t)});if(a.ok)d({type:"success",text:"Settings saved successfully!"});else{const u=await a.text();d({type:"error",text:`Failed to save: ${u}`})}}catch{d({type:"error",text:"Failed to save settings. Please try again."})}finally{i(!1)}},g=async a=>{o(u=>({...u,[a]:{channel:a,status:"pending"}}));try{const y=await(await fetch(`/api/partners/me/notifications/settings/test?channel=${a}`,{method:"POST",headers:{"X-API-Key":localStorage.getItem("partner_api_key")||""}})).json();o(v=>({...v,[a]:{channel:a,status:y.status==="sent"?"success":"failed",message:y.error}}))}catch{o(y=>({...y,[a]:{channel:a,status:"failed",message:"Connection error"}}))}},r=a=>{n(u=>({...u,...a}))};return p?e.jsx("div",{className:"flex items-center justify-center py-24",children:e.jsx(w,{size:"lg"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold text-label-primary",children:"Notification Settings"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:"Configure how you receive L3 escalation alerts"})]}),e.jsx("button",{onClick:_,disabled:h,className:"px-4 py-2 text-sm rounded-ios bg-accent-primary text-white hover:bg-accent-primary/90 transition-colors disabled:opacity-50",children:h?"Saving...":"Save Settings"})]}),s&&e.jsx("div",{className:`p-4 rounded-ios ${s.type==="success"?"bg-green-500/10 text-green-500 border border-green-500/20":"bg-red-500/10 text-red-500 border border-red-500/20"}`,children:s.text}),e.jsxs(b,{title:"Email",description:"Receive escalation alerts via email",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})}),enabled:t.email_enabled,onToggle:()=>r({email_enabled:!t.email_enabled}),onTest:()=>g("email"),testResult:l.email,children:[e.jsx(C,{label:"Recipients",values:t.email_recipients,onChange:a=>r({email_recipients:a}),placeholder:"Enter email addresses"}),e.jsx(m,{label:"From Name",value:t.email_from_name||"",onChange:a=>r({email_from_name:a}),placeholder:"OsirisCare Alerts",helpText:"Display name for outgoing emails"})]}),e.jsxs(b,{title:"Slack",description:"Post escalation alerts to a Slack channel",icon:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M5.042 15.165a2.528 2.528 0 0 1-2.52 2.523A2.528 2.528 0 0 1 0 15.165a2.527 2.527 0 0 1 2.522-2.52h2.52v2.52zM6.313 15.165a2.527 2.527 0 0 1 2.521-2.52 2.527 2.527 0 0 1 2.521 2.52v6.313A2.528 2.528 0 0 1 8.834 24a2.528 2.528 0 0 1-2.521-2.522v-6.313zM8.834 5.042a2.528 2.528 0 0 1-2.521-2.52A2.528 2.528 0 0 1 8.834 0a2.528 2.528 0 0 1 2.521 2.522v2.52H8.834zM8.834 6.313a2.528 2.528 0 0 1 2.521 2.521 2.528 2.528 0 0 1-2.521 2.521H2.522A2.528 2.528 0 0 1 0 8.834a2.528 2.528 0 0 1 2.522-2.521h6.312zM18.956 8.834a2.528 2.528 0 0 1 2.522-2.521A2.528 2.528 0 0 1 24 8.834a2.528 2.528 0 0 1-2.522 2.521h-2.522V8.834zM17.688 8.834a2.528 2.528 0 0 1-2.523 2.521 2.527 2.527 0 0 1-2.52-2.521V2.522A2.527 2.527 0 0 1 15.165 0a2.528 2.528 0 0 1 2.523 2.522v6.312zM15.165 18.956a2.528 2.528 0 0 1 2.523 2.522A2.528 2.528 0 0 1 15.165 24a2.527 2.527 0 0 1-2.52-2.522v-2.522h2.52zM15.165 17.688a2.527 2.527 0 0 1-2.52-2.523 2.526 2.526 0 0 1 2.52-2.52h6.313A2.527 2.527 0 0 1 24 15.165a2.528 2.528 0 0 1-2.522 2.523h-6.313z"})}),enabled:t.slack_enabled,onToggle:()=>r({slack_enabled:!t.slack_enabled}),onTest:()=>g("slack"),testResult:l.slack,children:[e.jsx(m,{label:"Webhook URL",value:t.slack_webhook_url||"",onChange:a=>r({slack_webhook_url:a}),placeholder:"https://hooks.slack.com/services/...",required:!0}),e.jsx(m,{label:"Channel",value:t.slack_channel||"",onChange:a=>r({slack_channel:a}),placeholder:"#incidents"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(m,{label:"Bot Username",value:t.slack_username,onChange:a=>r({slack_username:a}),placeholder:"OsirisCare"}),e.jsx(m,{label:"Icon Emoji",value:t.slack_icon_emoji,onChange:a=>r({slack_icon_emoji:a}),placeholder:":warning:"})]})]}),e.jsxs(b,{title:"PagerDuty",description:"Create PagerDuty incidents for critical alerts",icon:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M9.211 0c-2.06 0-3.801 1.67-3.801 3.73v16.54c0 2.06 1.741 3.73 3.801 3.73h5.578c2.06 0 3.801-1.67 3.801-3.73V3.73C18.59 1.67 16.849 0 14.789 0H9.211zm2.894 5.94a4.04 4.04 0 0 1 4.04 4.04 4.04 4.04 0 0 1-4.04 4.04 4.04 4.04 0 0 1-4.04-4.04 4.04 4.04 0 0 1 4.04-4.04z"})}),enabled:t.pagerduty_enabled,onToggle:()=>r({pagerduty_enabled:!t.pagerduty_enabled}),onTest:()=>g("pagerduty"),testResult:l.pagerduty,children:[e.jsx(m,{label:"Routing Key",type:"password",value:t.pagerduty_routing_key||"",onChange:a=>r({pagerduty_routing_key:a}),placeholder:"Enter your PagerDuty routing key",helpText:"Events API v2 routing key from your PagerDuty service",required:!0}),e.jsx(m,{label:"Service ID",value:t.pagerduty_service_id||"",onChange:a=>r({pagerduty_service_id:a}),placeholder:"P123ABC",helpText:"Optional: Service ID for reference"})]}),e.jsx(b,{title:"Microsoft Teams",description:"Post alerts to a Teams channel",icon:e.jsx("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"currentColor",children:e.jsx("path",{d:"M20.625 8.066h-3.748v7.873h-2.19V8.066H10.94V6.123h9.684v1.943zm-10.59 7.873H8.66v-4.654c0-.93.046-1.547-.098-1.862-.145-.315-.457-.473-.94-.473-.506 0-.867.172-1.082.517-.214.346-.32.84-.32 1.483v4.989H4.846V8.066h1.282v.986c.368-.397.72-.685 1.056-.862.335-.176.744-.265 1.227-.265.774 0 1.377.232 1.808.696.432.464.647 1.144.647 2.039v5.279H10.035z"})}),enabled:t.teams_enabled,onToggle:()=>r({teams_enabled:!t.teams_enabled}),onTest:()=>g("teams"),testResult:l.teams,children:e.jsx(m,{label:"Webhook URL",value:t.teams_webhook_url||"",onChange:a=>r({teams_webhook_url:a}),placeholder:"https://outlook.office.com/webhook/...",helpText:"Incoming webhook URL from your Teams channel connector",required:!0})}),e.jsxs(b,{title:"Webhook",description:"Send alerts to a custom webhook (PSA/RMM integration)",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"})}),enabled:t.webhook_enabled,onToggle:()=>r({webhook_enabled:!t.webhook_enabled}),onTest:()=>g("webhook"),testResult:l.webhook,children:[e.jsx(m,{label:"Webhook URL",value:t.webhook_url||"",onChange:a=>r({webhook_url:a}),placeholder:"https://your-psa.com/api/webhook",required:!0}),e.jsx(m,{label:"Signing Secret",type:"password",value:t.webhook_secret||"",onChange:a=>r({webhook_secret:a}),placeholder:"Optional HMAC signing secret",helpText:"If provided, requests will include X-OsirisCare-Signature header"})]}),e.jsxs(j,{className:"p-6",children:[e.jsx("h3",{className:"font-medium text-label-primary mb-4",children:"Escalation Behavior"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-1",children:"Escalation Timeout (minutes)"}),e.jsx("input",{type:"number",min:5,max:1440,value:t.escalation_timeout_minutes,onChange:a=>r({escalation_timeout_minutes:parseInt(a.target.value)||60}),className:"w-32 px-3 py-2 text-sm rounded-ios bg-fill-secondary text-label-primary border border-separator-light"}),e.jsx("p",{className:"text-xs text-label-tertiary mt-1",children:"Re-notify if not acknowledged within this time"})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.auto_acknowledge,onChange:a=>r({auto_acknowledge:a.target.checked}),className:"w-4 h-4 rounded border-separator-light text-accent-primary focus:ring-accent-primary/30"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:"Auto-acknowledge"}),e.jsx("p",{className:"text-xs text-label-tertiary",children:"Automatically mark tickets as acknowledged when notification is sent"})]})]}),e.jsxs("label",{className:"flex items-center gap-3 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.include_raw_data,onChange:a=>r({include_raw_data:a.target.checked}),className:"w-4 h-4 rounded border-separator-light text-accent-primary focus:ring-accent-primary/30"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:"Include raw data"}),e.jsx("p",{className:"text-xs text-label-tertiary",children:"Include full incident data in webhook payloads"})]})]})]})]})]})};export{T as NotificationSettings,T as default};
