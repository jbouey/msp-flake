import{x as u,a4 as a,a5 as l}from"./index-ByrxzNCH.js";const _="/api/integrations";class h extends Error{constructor(e,n){super(n),this.status=e,this.name="ApiError"}}function d(){return localStorage.getItem("auth_token")}async function o(t,e){const n=`${_}${t}`,r=d(),s={"Content-Type":"application/json"};r&&(s.Authorization=`Bearer ${r}`);const c=await fetch(n,{...e,headers:{...s,...e==null?void 0:e.headers}});if(!c.ok){const f=await c.json().catch(()=>({detail:"Unknown error"}));throw new h(c.status,f.detail||`HTTP ${c.status}`)}return c.json()}const i={listIntegrations:(t,e)=>{const n=new URLSearchParams;e!=null&&e.status&&n.set("status",e.status),e!=null&&e.provider&&n.set("provider",e.provider);const r=n.toString();return o(`/sites/${t}${r?`?${r}`:""}`)},getIntegration:(t,e)=>o(`/sites/${t}/${e}`),createIntegration:(t,e)=>o(`/sites/${t}`,{method:"POST",body:JSON.stringify(e)}),deleteIntegration:(t,e)=>o(`/sites/${t}/${e}`,{method:"DELETE"}),listResources:(t,e,n)=>{const r=new URLSearchParams;n!=null&&n.resource_type&&r.set("resource_type",n.resource_type),n!=null&&n.risk_level&&r.set("risk_level",n.risk_level),n!=null&&n.limit&&r.set("limit",String(n.limit)),n!=null&&n.offset&&r.set("offset",String(n.offset));const s=r.toString();return o(`/sites/${t}/${e}/resources${s?`?${s}`:""}`)},triggerSync:(t,e)=>o(`/sites/${t}/${e}/sync`,{method:"POST"}),getSyncStatus:(t,e,n)=>o(`/sites/${t}/${e}/sync/${n}`),getSiteHealth:t=>o(`/sites/${t}/health`),getAWSSetupInstructions:()=>o("/aws/setup-instructions"),generateAWSExternalId:()=>o("/aws/generate-external-id",{method:"POST"})},C={aws:{name:"Amazon Web Services",description:"IAM users, S3 buckets, EC2 instances, RDS, CloudTrail, Security Groups",icon:"aws",color:"#FF9900",setupType:"iam_role"},google_workspace:{name:"Google Workspace",description:"Users, Groups, MFA status, Organizational Units",icon:"google",color:"#4285F4",setupType:"oauth"},okta:{name:"Okta",description:"Users, Groups, Applications, Policies",icon:"okta",color:"#007DC1",setupType:"oauth"},azure_ad:{name:"Azure AD (Entra ID)",description:"Users, Groups, Conditional Access Policies, Directory Roles",icon:"microsoft",color:"#0078D4",setupType:"oauth"},microsoft_security:{name:"Microsoft Security (Defender + Intune)",description:"Security Alerts, Intune Devices, Secure Score, Device Compliance",icon:"shield",color:"#00A4EF",setupType:"oauth"}},F={critical:{label:"Critical",color:"#DC2626",bgColor:"#FEE2E2"},high:{label:"High",color:"#EA580C",bgColor:"#FFEDD5"},medium:{label:"Medium",color:"#CA8A04",bgColor:"#FEF3C7"},low:{label:"Low",color:"#16A34A",bgColor:"#DCFCE7"},unknown:{label:"Unknown",color:"#6B7280",bgColor:"#F3F4F6"}},I={iam_user:"IAM User",s3_bucket:"S3 Bucket",ec2_instance:"EC2 Instance",rds_instance:"RDS Instance",cloudtrail:"CloudTrail",security_group:"Security Group",user:"User",group:"Group",org_unit:"Organizational Unit",application:"Application",policy_password:"Password Policy",policy_mfa_enroll:"MFA Enrollment Policy",policy_okta_sign_on:"Sign-On Policy",conditional_access_policy:"Conditional Access Policy",directory_role:"Directory Role",security_alert:"Security Alert",intune_device:"Intune Device",compliance_policy:"Compliance Policy",secure_score:"Secure Score",azure_ad_device:"Azure AD Device"},y=6e4,A=5e3,g=3e4;function S(t,e){e instanceof Error&&e.message.includes("cancelled")||console.error(`Integration mutation error (${t}):`,e)}function T(t,e){return u({queryKey:["integrations",t,e],queryFn:()=>i.listIntegrations(t,e),enabled:!!t,refetchInterval:y,staleTime:g})}function v(t,e){return u({queryKey:["integration",t,e],queryFn:()=>i.getIntegration(t,e),enabled:!!t&&!!e,refetchInterval:y,staleTime:g})}function q(){const t=a();return l({mutationFn:({siteId:e,data:n})=>i.createIntegration(e,n),onSuccess:(e,{siteId:n})=>{t.invalidateQueries({queryKey:["integrations",n]}),t.invalidateQueries({queryKey:["integrationsHealth",n]})},onError:e=>S("createIntegration",e)})}function p(){const t=a();return l({mutationFn:({siteId:e,integrationId:n})=>i.deleteIntegration(e,n),onSuccess:(e,{siteId:n,integrationId:r})=>{t.invalidateQueries({queryKey:["integrations",n]}),t.invalidateQueries({queryKey:["integration",n,r]}),t.invalidateQueries({queryKey:["integrationsHealth",n]})},onError:e=>S("deleteIntegration",e)})}function $(t,e,n){return u({queryKey:["integrationResources",t,e,n],queryFn:()=>i.listResources(t,e,n),enabled:!!t&&!!e,refetchInterval:y,staleTime:g})}function P(){const t=a();return l({mutationFn:({siteId:e,integrationId:n})=>i.triggerSync(e,n),onSuccess:(e,{siteId:n,integrationId:r})=>{t.invalidateQueries({queryKey:["integration",n,r]})},onError:e=>S("triggerSync",e)})}function D(t,e,n){return u({queryKey:["syncJob",t,e,n],queryFn:()=>i.getSyncStatus(t,e,n),enabled:!!t&&!!e&&!!n,refetchInterval:r=>{var s,c;return((s=r.state.data)==null?void 0:s.status)==="running"||((c=r.state.data)==null?void 0:c.status)==="pending"?A:!1},staleTime:1e3})}function R(t){return u({queryKey:["integrationsHealth",t],queryFn:()=>i.getSiteHealth(t),enabled:!!t,refetchInterval:y,staleTime:g})}function b(){return u({queryKey:["awsSetupInstructions"],queryFn:i.getAWSSetupInstructions,staleTime:24*60*60*1e3})}function k(){return l({mutationFn:()=>i.generateAWSExternalId(),onError:t=>S("generateAWSExternalId",t)})}function w(){const t=a();return(e,n)=>{t.invalidateQueries({queryKey:["integrationResources",e,n]}),t.invalidateQueries({queryKey:["integration",e,n]})}}export{C as P,F as R,P as a,p as b,R as c,q as d,k as e,b as f,v as g,$ as h,w as i,D as j,I as k,T as u};
