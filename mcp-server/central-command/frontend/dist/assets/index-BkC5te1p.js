import{r as g,j as e,Z as de,m as xe,a6 as B,a4 as Se,x as re,a5 as ne}from"./index-Dfzg2dGd.js";const me=g.createContext(void 0),te="partner_api_key",Qe=({children:r})=>{const[n,o]=g.useState(null),[d,u]=g.useState(null),[y,w]=g.useState(!0),[v,s]=g.useState(null);g.useEffect(()=>{(async()=>{if(await t()){w(!1);return}const x=localStorage.getItem(te);x?await a(x):w(!1)})()},[]);const t=async()=>{try{const c=await fetch("/api/partner-auth/me",{credentials:"include"});if(c.ok){const h=await c.json();return o({id:h.id,name:h.name,slug:h.slug,brand_name:h.brand_name||h.name,email:h.email,auth_provider:h.auth_provider,tenant_id:h.tenant_id,primary_color:"#4F46E5",logo_url:null,contact_email:h.email,revenue_share_percent:40,site_count:0,provisions:{pending:0,claimed:0}}),!0}}catch(c){console.error("Session check failed:",c)}return!1},a=async c=>{w(!0),s(null);try{const h=await fetch("/api/partners/me",{headers:{"X-API-Key":c}});if(h.ok){const x=await h.json();o(x),u(c),localStorage.setItem(te,c)}else localStorage.removeItem(te),s("Invalid or expired API key"),o(null),u(null)}catch{s("Failed to connect to server")}finally{w(!1)}},i=async c=>(await a(c),n!==null),l=async()=>{localStorage.removeItem(te);try{await fetch("/api/partner-auth/logout",{method:"POST",credentials:"include"})}catch(c){console.error("Logout request failed:",c)}o(null),u(null),s(null)},p=async()=>t();return e.jsx(me.Provider,{value:{partner:n,apiKey:d,isAuthenticated:n!==null,isLoading:y,error:v,login:i,logout:l,checkSession:p},children:r})},ee=()=>{const r=g.useContext(me);if(r===void 0)throw new Error("usePartner must be used within a PartnerProvider");return r},_e={invalid_state:"Session expired. Please try again.",token_exchange_failed:"Authentication failed. Please try again.",auth_failed:"Authentication failed. Please try again.",missing_params:"Invalid OAuth callback.",invalid_provider:"Invalid authentication provider."},We=()=>{const[r,n]=de(),o=xe(),{login:d,isAuthenticated:u,isLoading:y,error:w}=ee(),[v,s]=g.useState(""),[t,a]=g.useState("idle"),[i,l]=g.useState(null),[p,c]=g.useState(null),[h,x]=g.useState({microsoft:!1,google:!1}),[S,P]=g.useState(!0),N=r.get("token"),C=r.get("error"),M=r.get("error_description"),O=r.get("pending"),$=r.get("email");g.useEffect(()=>{(async()=>{try{const I=await fetch("/api/partner-auth/providers");if(I.ok){const b=await I.json();x(b.providers||{microsoft:!1,google:!1})}}catch(I){console.error("Failed to fetch OAuth providers:",I)}finally{P(!1)}})()},[]),g.useEffect(()=>{if(C){const L=_e[C]||M||`Authentication error: ${C}`;l(L),a("error"),n({})}},[C,M,n]),g.useEffect(()=>{N&&F(N)},[N]),g.useEffect(()=>{u&&!y&&o("/partner/dashboard",{replace:!0})},[u,y,o]);const F=async L=>{a("loading"),l(null);try{const I=await fetch("/api/partners/auth/magic",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:L})});if(I.ok){const b=await I.json();b.api_key&&await d(b.api_key)}else{const b=await I.json();l(b.detail||"Invalid or expired magic link"),a("error")}}catch{l("Failed to validate magic link"),a("error")}},f=async L=>{if(L.preventDefault(),!v.trim())return;a("loading"),l(null),await d(v.trim())||(l(w||"Invalid API key"),a("error"))},k=L=>{c(L),l(null),window.location.href=`/api/partner-auth/${L}`},E=h.microsoft||h.google;return y||t==="loading"?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-950 via-purple-900 to-indigo-900 flex items-center justify-center p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-1/4 -left-32 w-96 h-96 bg-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 -right-32 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"max-w-md w-full relative",style:{background:"rgba(255,255,255,0.85)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderRadius:"20px",boxShadow:"0 8px 32px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.5)"},children:e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"w-14 h-14 mx-auto mb-4 rounded-2xl flex items-center justify-center",style:{background:"linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%)"},children:e.jsx("svg",{className:"w-7 h-7 text-white animate-pulse-soft",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:N?"Validating Access":"Loading"}),e.jsx("p",{className:"text-gray-500",children:"Please wait..."})]})})]}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-950 via-purple-900 to-indigo-900 flex items-center justify-center p-6 relative overflow-hidden animate-fade-in",children:[e.jsx("div",{className:"absolute top-1/4 -left-32 w-96 h-96 bg-indigo-600/20 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute bottom-1/4 -right-32 w-96 h-96 bg-purple-600/20 rounded-full blur-3xl"}),e.jsxs("div",{className:"max-w-md w-full relative z-10",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"w-16 h-16 rounded-2xl mx-auto mb-4 flex items-center justify-center shadow-lg",style:{background:"linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%)",boxShadow:"0 4px 20px rgba(79, 70, 229, 0.4)"},children:e.jsx("svg",{className:"w-9 h-9 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("h1",{className:"text-3xl font-bold text-white tracking-tight",children:"Partner Portal"}),e.jsx("p",{className:"text-indigo-200/80 mt-2",children:"OsirisCare Reseller Dashboard"})]}),e.jsxs("div",{className:"p-8",style:{background:"rgba(255,255,255,0.88)",backdropFilter:"blur(40px) saturate(180%)",WebkitBackdropFilter:"blur(40px) saturate(180%)",borderRadius:"20px",boxShadow:"0 8px 32px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.5)"},children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2 text-center",children:"Partner Login"}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:"Sign in with your business identity to access your dashboard."}),O&&e.jsx("div",{className:"mb-6 p-4 bg-amber-50 border border-amber-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-amber-500 mt-0.5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-amber-800 font-medium",children:"Account Pending Approval"}),e.jsxs("p",{className:"text-amber-700 text-sm mt-1",children:["Your signup request for ",e.jsx("strong",{children:$})," has been submitted and is awaiting administrator approval."]}),e.jsx("p",{className:"text-amber-600 text-sm mt-2",children:"You'll receive an email once your account is approved."})]})]})}),(i||t==="error")&&!O&&e.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg",children:e.jsx("p",{className:"text-red-700 text-sm",children:i||"Authentication failed"})}),!S&&E&&e.jsxs("div",{className:"space-y-3 mb-6",children:[h.microsoft&&e.jsxs("button",{type:"button",onClick:()=>k("microsoft"),disabled:p!==null,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-gray-50/80 border border-gray-200 rounded-xl hover:bg-gray-100/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 21 21",children:[e.jsx("rect",{fill:"#f25022",x:"1",y:"1",width:"9",height:"9"}),e.jsx("rect",{fill:"#7fba00",x:"11",y:"1",width:"9",height:"9"}),e.jsx("rect",{fill:"#05a6f0",x:"1",y:"11",width:"9",height:"9"}),e.jsx("rect",{fill:"#ffba08",x:"11",y:"11",width:"9",height:"9"})]}),e.jsx("span",{className:"font-medium text-gray-900",children:p==="microsoft"?"Redirecting...":"Sign in with Microsoft"})]}),h.google&&e.jsxs("button",{type:"button",onClick:()=>k("google"),disabled:p!==null,className:"w-full flex items-center justify-center gap-3 px-4 py-3 bg-gray-50/80 border border-gray-200 rounded-xl hover:bg-gray-100/80 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:[e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",children:[e.jsx("path",{fill:"#4285F4",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),e.jsx("path",{fill:"#34A853",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),e.jsx("path",{fill:"#FBBC05",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),e.jsx("path",{fill:"#EA4335",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),e.jsx("span",{className:"font-medium text-gray-900",children:p==="google"?"Redirecting...":"Sign in with Google"})]}),e.jsxs("div",{className:"relative my-4",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200"})}),e.jsx("div",{className:"relative flex justify-center text-sm",children:e.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or use API key"})})]})]}),e.jsxs("form",{onSubmit:f,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-700 mb-1",children:"API Key"}),e.jsx("input",{type:"password",id:"apiKey",value:v,onChange:L=>s(L.target.value),placeholder:"Enter your partner API key",required:!0,className:"w-full px-4 py-3 bg-gray-50/80 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500/40 focus:border-indigo-300 outline-none transition font-mono text-sm"})]}),e.jsx("button",{type:"submit",disabled:!v.trim(),className:"w-full py-3 text-white font-semibold rounded-xl disabled:opacity-50 disabled:cursor-not-allowed transition-all hover:brightness-110",style:{background:"linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%)",boxShadow:"0 4px 14px rgba(79, 70, 229, 0.35)"},children:"Sign In"})]}),e.jsx("div",{className:"mt-6 pt-6 border-t border-gray-200",children:e.jsxs("p",{className:"text-center text-sm text-gray-500",children:["Don't have an API key?"," ",e.jsx("a",{href:"mailto:partners@osiriscare.net",className:"text-indigo-600 hover:underline",children:"Contact us"})]})})]}),e.jsx("p",{className:"mt-8 text-center text-sm text-indigo-300/60",children:"Powered by OsirisCare HIPAA Compliance Platform"})]})]})};var Ee=Object.defineProperty,ae=Object.getOwnPropertySymbols,he=Object.prototype.hasOwnProperty,ue=Object.prototype.propertyIsEnumerable,ce=(r,n,o)=>n in r?Ee(r,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[n]=o,ie=(r,n)=>{for(var o in n||(n={}))he.call(n,o)&&ce(r,o,n[o]);if(ae)for(var o of ae(n))ue.call(n,o)&&ce(r,o,n[o]);return r},le=(r,n)=>{var o={};for(var d in r)he.call(r,d)&&n.indexOf(d)<0&&(o[d]=r[d]);if(r!=null&&ae)for(var d of ae(r))n.indexOf(d)<0&&ue.call(r,d)&&(o[d]=r[d]);return o};/**
 * @license QR Code generator library (TypeScript)
 * Copyright (c) Project Nayuki.
 * SPDX-License-Identifier: MIT
 */var X;(r=>{const n=class _{constructor(s,t,a,i){if(this.version=s,this.errorCorrectionLevel=t,this.modules=[],this.isFunction=[],s<_.MIN_VERSION||s>_.MAX_VERSION)throw new RangeError("Version value out of range");if(i<-1||i>7)throw new RangeError("Mask value out of range");this.size=s*4+17;let l=[];for(let c=0;c<this.size;c++)l.push(!1);for(let c=0;c<this.size;c++)this.modules.push(l.slice()),this.isFunction.push(l.slice());this.drawFunctionPatterns();const p=this.addEccAndInterleave(a);if(this.drawCodewords(p),i==-1){let c=1e9;for(let h=0;h<8;h++){this.applyMask(h),this.drawFormatBits(h);const x=this.getPenaltyScore();x<c&&(i=h,c=x),this.applyMask(h)}}u(0<=i&&i<=7),this.mask=i,this.applyMask(i),this.drawFormatBits(i),this.isFunction=[]}static encodeText(s,t){const a=r.QrSegment.makeSegments(s);return _.encodeSegments(a,t)}static encodeBinary(s,t){const a=r.QrSegment.makeBytes(s);return _.encodeSegments([a],t)}static encodeSegments(s,t,a=1,i=40,l=-1,p=!0){if(!(_.MIN_VERSION<=a&&a<=i&&i<=_.MAX_VERSION)||l<-1||l>7)throw new RangeError("Invalid value");let c,h;for(c=a;;c++){const N=_.getNumDataCodewords(c,t)*8,C=w.getTotalBits(s,c);if(C<=N){h=C;break}if(c>=i)throw new RangeError("Data too long")}for(const N of[_.Ecc.MEDIUM,_.Ecc.QUARTILE,_.Ecc.HIGH])p&&h<=_.getNumDataCodewords(c,N)*8&&(t=N);let x=[];for(const N of s){o(N.mode.modeBits,4,x),o(N.numChars,N.mode.numCharCountBits(c),x);for(const C of N.getData())x.push(C)}u(x.length==h);const S=_.getNumDataCodewords(c,t)*8;u(x.length<=S),o(0,Math.min(4,S-x.length),x),o(0,(8-x.length%8)%8,x),u(x.length%8==0);for(let N=236;x.length<S;N^=253)o(N,8,x);let P=[];for(;P.length*8<x.length;)P.push(0);return x.forEach((N,C)=>P[C>>>3]|=N<<7-(C&7)),new _(c,t,P,l)}getModule(s,t){return 0<=s&&s<this.size&&0<=t&&t<this.size&&this.modules[t][s]}getModules(){return this.modules}drawFunctionPatterns(){for(let a=0;a<this.size;a++)this.setFunctionModule(6,a,a%2==0),this.setFunctionModule(a,6,a%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);const s=this.getAlignmentPatternPositions(),t=s.length;for(let a=0;a<t;a++)for(let i=0;i<t;i++)a==0&&i==0||a==0&&i==t-1||a==t-1&&i==0||this.drawAlignmentPattern(s[a],s[i]);this.drawFormatBits(0),this.drawVersion()}drawFormatBits(s){const t=this.errorCorrectionLevel.formatBits<<3|s;let a=t;for(let l=0;l<10;l++)a=a<<1^(a>>>9)*1335;const i=(t<<10|a)^21522;u(i>>>15==0);for(let l=0;l<=5;l++)this.setFunctionModule(8,l,d(i,l));this.setFunctionModule(8,7,d(i,6)),this.setFunctionModule(8,8,d(i,7)),this.setFunctionModule(7,8,d(i,8));for(let l=9;l<15;l++)this.setFunctionModule(14-l,8,d(i,l));for(let l=0;l<8;l++)this.setFunctionModule(this.size-1-l,8,d(i,l));for(let l=8;l<15;l++)this.setFunctionModule(8,this.size-15+l,d(i,l));this.setFunctionModule(8,this.size-8,!0)}drawVersion(){if(this.version<7)return;let s=this.version;for(let a=0;a<12;a++)s=s<<1^(s>>>11)*7973;const t=this.version<<12|s;u(t>>>18==0);for(let a=0;a<18;a++){const i=d(t,a),l=this.size-11+a%3,p=Math.floor(a/3);this.setFunctionModule(l,p,i),this.setFunctionModule(p,l,i)}}drawFinderPattern(s,t){for(let a=-4;a<=4;a++)for(let i=-4;i<=4;i++){const l=Math.max(Math.abs(i),Math.abs(a)),p=s+i,c=t+a;0<=p&&p<this.size&&0<=c&&c<this.size&&this.setFunctionModule(p,c,l!=2&&l!=4)}}drawAlignmentPattern(s,t){for(let a=-2;a<=2;a++)for(let i=-2;i<=2;i++)this.setFunctionModule(s+i,t+a,Math.max(Math.abs(i),Math.abs(a))!=1)}setFunctionModule(s,t,a){this.modules[t][s]=a,this.isFunction[t][s]=!0}addEccAndInterleave(s){const t=this.version,a=this.errorCorrectionLevel;if(s.length!=_.getNumDataCodewords(t,a))throw new RangeError("Invalid argument");const i=_.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][t],l=_.ECC_CODEWORDS_PER_BLOCK[a.ordinal][t],p=Math.floor(_.getNumRawDataModules(t)/8),c=i-p%i,h=Math.floor(p/i);let x=[];const S=_.reedSolomonComputeDivisor(l);for(let N=0,C=0;N<i;N++){let M=s.slice(C,C+h-l+(N<c?0:1));C+=M.length;const O=_.reedSolomonComputeRemainder(M,S);N<c&&M.push(0),x.push(M.concat(O))}let P=[];for(let N=0;N<x[0].length;N++)x.forEach((C,M)=>{(N!=h-l||M>=c)&&P.push(C[N])});return u(P.length==p),P}drawCodewords(s){if(s.length!=Math.floor(_.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");let t=0;for(let a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(let i=0;i<this.size;i++)for(let l=0;l<2;l++){const p=a-l,h=(a+1&2)==0?this.size-1-i:i;!this.isFunction[h][p]&&t<s.length*8&&(this.modules[h][p]=d(s[t>>>3],7-(t&7)),t++)}}u(t==s.length*8)}applyMask(s){if(s<0||s>7)throw new RangeError("Mask value out of range");for(let t=0;t<this.size;t++)for(let a=0;a<this.size;a++){let i;switch(s){case 0:i=(a+t)%2==0;break;case 1:i=t%2==0;break;case 2:i=a%3==0;break;case 3:i=(a+t)%3==0;break;case 4:i=(Math.floor(a/3)+Math.floor(t/2))%2==0;break;case 5:i=a*t%2+a*t%3==0;break;case 6:i=(a*t%2+a*t%3)%2==0;break;case 7:i=((a+t)%2+a*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][a]&&i&&(this.modules[t][a]=!this.modules[t][a])}}getPenaltyScore(){let s=0;for(let l=0;l<this.size;l++){let p=!1,c=0,h=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[l][x]==p?(c++,c==5?s+=_.PENALTY_N1:c>5&&s++):(this.finderPenaltyAddHistory(c,h),p||(s+=this.finderPenaltyCountPatterns(h)*_.PENALTY_N3),p=this.modules[l][x],c=1);s+=this.finderPenaltyTerminateAndCount(p,c,h)*_.PENALTY_N3}for(let l=0;l<this.size;l++){let p=!1,c=0,h=[0,0,0,0,0,0,0];for(let x=0;x<this.size;x++)this.modules[x][l]==p?(c++,c==5?s+=_.PENALTY_N1:c>5&&s++):(this.finderPenaltyAddHistory(c,h),p||(s+=this.finderPenaltyCountPatterns(h)*_.PENALTY_N3),p=this.modules[x][l],c=1);s+=this.finderPenaltyTerminateAndCount(p,c,h)*_.PENALTY_N3}for(let l=0;l<this.size-1;l++)for(let p=0;p<this.size-1;p++){const c=this.modules[l][p];c==this.modules[l][p+1]&&c==this.modules[l+1][p]&&c==this.modules[l+1][p+1]&&(s+=_.PENALTY_N2)}let t=0;for(const l of this.modules)t=l.reduce((p,c)=>p+(c?1:0),t);const a=this.size*this.size,i=Math.ceil(Math.abs(t*20-a*10)/a)-1;return u(0<=i&&i<=9),s+=i*_.PENALTY_N4,u(0<=s&&s<=2568888),s}getAlignmentPatternPositions(){if(this.version==1)return[];{const s=Math.floor(this.version/7)+2,t=this.version==32?26:Math.ceil((this.version*4+4)/(s*2-2))*2;let a=[6];for(let i=this.size-7;a.length<s;i-=t)a.splice(1,0,i);return a}}static getNumRawDataModules(s){if(s<_.MIN_VERSION||s>_.MAX_VERSION)throw new RangeError("Version number out of range");let t=(16*s+128)*s+64;if(s>=2){const a=Math.floor(s/7)+2;t-=(25*a-10)*a-55,s>=7&&(t-=36)}return u(208<=t&&t<=29648),t}static getNumDataCodewords(s,t){return Math.floor(_.getNumRawDataModules(s)/8)-_.ECC_CODEWORDS_PER_BLOCK[t.ordinal][s]*_.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][s]}static reedSolomonComputeDivisor(s){if(s<1||s>255)throw new RangeError("Degree out of range");let t=[];for(let i=0;i<s-1;i++)t.push(0);t.push(1);let a=1;for(let i=0;i<s;i++){for(let l=0;l<t.length;l++)t[l]=_.reedSolomonMultiply(t[l],a),l+1<t.length&&(t[l]^=t[l+1]);a=_.reedSolomonMultiply(a,2)}return t}static reedSolomonComputeRemainder(s,t){let a=t.map(i=>0);for(const i of s){const l=i^a.shift();a.push(0),t.forEach((p,c)=>a[c]^=_.reedSolomonMultiply(p,l))}return a}static reedSolomonMultiply(s,t){if(s>>>8||t>>>8)throw new RangeError("Byte out of range");let a=0;for(let i=7;i>=0;i--)a=a<<1^(a>>>7)*285,a^=(t>>>i&1)*s;return u(a>>>8==0),a}finderPenaltyCountPatterns(s){const t=s[1];u(t<=this.size*3);const a=t>0&&s[2]==t&&s[3]==t*3&&s[4]==t&&s[5]==t;return(a&&s[0]>=t*4&&s[6]>=t?1:0)+(a&&s[6]>=t*4&&s[0]>=t?1:0)}finderPenaltyTerminateAndCount(s,t,a){return s&&(this.finderPenaltyAddHistory(t,a),t=0),t+=this.size,this.finderPenaltyAddHistory(t,a),this.finderPenaltyCountPatterns(a)}finderPenaltyAddHistory(s,t){t[0]==0&&(s+=this.size),t.pop(),t.unshift(s)}};n.MIN_VERSION=1,n.MAX_VERSION=40,n.PENALTY_N1=3,n.PENALTY_N2=3,n.PENALTY_N3=40,n.PENALTY_N4=10,n.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],n.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],r.QrCode=n;function o(v,s,t){if(s<0||s>31||v>>>s)throw new RangeError("Value out of range");for(let a=s-1;a>=0;a--)t.push(v>>>a&1)}function d(v,s){return(v>>>s&1)!=0}function u(v){if(!v)throw new Error("Assertion error")}const y=class D{constructor(s,t,a){if(this.mode=s,this.numChars=t,this.bitData=a,t<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}static makeBytes(s){let t=[];for(const a of s)o(a,8,t);return new D(D.Mode.BYTE,s.length,t)}static makeNumeric(s){if(!D.isNumeric(s))throw new RangeError("String contains non-numeric characters");let t=[];for(let a=0;a<s.length;){const i=Math.min(s.length-a,3);o(parseInt(s.substring(a,a+i),10),i*3+1,t),a+=i}return new D(D.Mode.NUMERIC,s.length,t)}static makeAlphanumeric(s){if(!D.isAlphanumeric(s))throw new RangeError("String contains unencodable characters in alphanumeric mode");let t=[],a;for(a=0;a+2<=s.length;a+=2){let i=D.ALPHANUMERIC_CHARSET.indexOf(s.charAt(a))*45;i+=D.ALPHANUMERIC_CHARSET.indexOf(s.charAt(a+1)),o(i,11,t)}return a<s.length&&o(D.ALPHANUMERIC_CHARSET.indexOf(s.charAt(a)),6,t),new D(D.Mode.ALPHANUMERIC,s.length,t)}static makeSegments(s){return s==""?[]:D.isNumeric(s)?[D.makeNumeric(s)]:D.isAlphanumeric(s)?[D.makeAlphanumeric(s)]:[D.makeBytes(D.toUtf8ByteArray(s))]}static makeEci(s){let t=[];if(s<0)throw new RangeError("ECI assignment value out of range");if(s<128)o(s,8,t);else if(s<16384)o(2,2,t),o(s,14,t);else if(s<1e6)o(6,3,t),o(s,21,t);else throw new RangeError("ECI assignment value out of range");return new D(D.Mode.ECI,0,t)}static isNumeric(s){return D.NUMERIC_REGEX.test(s)}static isAlphanumeric(s){return D.ALPHANUMERIC_REGEX.test(s)}getData(){return this.bitData.slice()}static getTotalBits(s,t){let a=0;for(const i of s){const l=i.mode.numCharCountBits(t);if(i.numChars>=1<<l)return 1/0;a+=4+l+i.bitData.length}return a}static toUtf8ByteArray(s){s=encodeURI(s);let t=[];for(let a=0;a<s.length;a++)s.charAt(a)!="%"?t.push(s.charCodeAt(a)):(t.push(parseInt(s.substring(a+1,a+3),16)),a+=2);return t}};y.NUMERIC_REGEX=/^[0-9]*$/,y.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,y.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:";let w=y;r.QrSegment=y})(X||(X={}));(r=>{(n=>{const o=class{constructor(u,y){this.ordinal=u,this.formatBits=y}};o.LOW=new o(0,1),o.MEDIUM=new o(1,0),o.QUARTILE=new o(2,3),o.HIGH=new o(3,2),n.Ecc=o})(r.QrCode||(r.QrCode={}))})(X||(X={}));(r=>{(n=>{const o=class{constructor(u,y){this.modeBits=u,this.numBitsCharCount=y}numCharCountBits(u){return this.numBitsCharCount[Math.floor((u+7)/17)]}};o.NUMERIC=new o(1,[10,12,14]),o.ALPHANUMERIC=new o(2,[9,11,13]),o.BYTE=new o(4,[8,16,16]),o.KANJI=new o(8,[8,10,12]),o.ECI=new o(7,[0,0,0]),n.Mode=o})(r.QrSegment||(r.QrSegment={}))})(X||(X={}));var q=X;/**
 * @license qrcode.react
 * Copyright (c) Paul O'Shannessy
 * SPDX-License-Identifier: ISC
 */var Pe={L:q.QrCode.Ecc.LOW,M:q.QrCode.Ecc.MEDIUM,Q:q.QrCode.Ecc.QUARTILE,H:q.QrCode.Ecc.HIGH},pe=128,ge="L",fe="#FFFFFF",ye="#000000",be=!1,je=1,Ae=4,Me=0,Re=.1;function ve(r,n=0){const o=[];return r.forEach(function(d,u){let y=null;d.forEach(function(w,v){if(!w&&y!==null){o.push(`M${y+n} ${u+n}h${v-y}v1H${y+n}z`),y=null;return}if(v===d.length-1){if(!w)return;y===null?o.push(`M${v+n},${u+n} h1v1H${v+n}z`):o.push(`M${y+n},${u+n} h${v+1-y}v1H${y+n}z`);return}w&&y===null&&(y=v)})}),o.join("")}function Ne(r,n){return r.slice().map((o,d)=>d<n.y||d>=n.y+n.h?o:o.map((u,y)=>y<n.x||y>=n.x+n.w?u:!1))}function Le(r,n,o,d){if(d==null)return null;const u=r.length+o*2,y=Math.floor(n*Re),w=u/n,v=(d.width||y)*w,s=(d.height||y)*w,t=d.x==null?r.length/2-v/2:d.x*w,a=d.y==null?r.length/2-s/2:d.y*w,i=d.opacity==null?1:d.opacity;let l=null;if(d.excavate){let c=Math.floor(t),h=Math.floor(a),x=Math.ceil(v+t-c),S=Math.ceil(s+a-h);l={x:c,y:h,w:x,h:S}}const p=d.crossOrigin;return{x:t,y:a,h:s,w:v,excavation:l,opacity:i,crossOrigin:p}}function Ie(r,n){return n!=null?Math.max(Math.floor(n),0):r?Ae:Me}function we({value:r,level:n,minVersion:o,includeMargin:d,marginSize:u,imageSettings:y,size:w,boostLevel:v}){let s=B.useMemo(()=>{const c=(Array.isArray(r)?r:[r]).reduce((h,x)=>(h.push(...q.QrSegment.makeSegments(x)),h),[]);return q.QrCode.encodeSegments(c,Pe[n],o,void 0,void 0,v)},[r,n,o,v]);const{cells:t,margin:a,numCells:i,calculatedImageSettings:l}=B.useMemo(()=>{let p=s.getModules();const c=Ie(d,u),h=p.length+c*2,x=Le(p,w,c,y);return{cells:p,margin:c,numCells:h,calculatedImageSettings:x}},[s,w,y,d,u]);return{qrcode:s,margin:a,cells:t,numCells:i,calculatedImageSettings:l}}var Fe=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}(),De=B.forwardRef(function(n,o){const d=n,{value:u,size:y=pe,level:w=ge,bgColor:v=fe,fgColor:s=ye,includeMargin:t=be,minVersion:a=je,boostLevel:i,marginSize:l,imageSettings:p}=d,h=le(d,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","marginSize","imageSettings"]),{style:x}=h,S=le(h,["style"]),P=p==null?void 0:p.src,N=B.useRef(null),C=B.useRef(null),M=B.useCallback(b=>{N.current=b,typeof o=="function"?o(b):o&&(o.current=b)},[o]),[O,$]=B.useState(!1),{margin:F,cells:f,numCells:k,calculatedImageSettings:E}=we({value:u,level:w,minVersion:a,boostLevel:i,includeMargin:t,marginSize:l,imageSettings:p,size:y});B.useEffect(()=>{if(N.current!=null){const b=N.current,R=b.getContext("2d");if(!R)return;let H=f;const U=C.current,z=E!=null&&U!==null&&U.complete&&U.naturalHeight!==0&&U.naturalWidth!==0;z&&E.excavation!=null&&(H=Ne(f,E.excavation));const W=window.devicePixelRatio||1;b.height=b.width=y*W;const K=y/k*W;R.scale(K,K),R.fillStyle=v,R.fillRect(0,0,k,k),R.fillStyle=s,Fe?R.fill(new Path2D(ve(H,F))):f.forEach(function(G,j){G.forEach(function(m,A){m&&R.fillRect(A+F,j+F,1,1)})}),E&&(R.globalAlpha=E.opacity),z&&R.drawImage(U,E.x+F,E.y+F,E.w,E.h)}}),B.useEffect(()=>{$(!1)},[P]);const L=ie({height:y,width:y},x);let I=null;return P!=null&&(I=B.createElement("img",{src:P,key:P,style:{display:"none"},onLoad:()=>{$(!0)},ref:C,crossOrigin:E==null?void 0:E.crossOrigin})),B.createElement(B.Fragment,null,B.createElement("canvas",ie({style:L,height:y,width:y,ref:M,role:"img"},S)),I)});De.displayName="QRCodeCanvas";var ke=B.forwardRef(function(n,o){const d=n,{value:u,size:y=pe,level:w=ge,bgColor:v=fe,fgColor:s=ye,includeMargin:t=be,minVersion:a=je,boostLevel:i,title:l,marginSize:p,imageSettings:c}=d,h=le(d,["value","size","level","bgColor","fgColor","includeMargin","minVersion","boostLevel","title","marginSize","imageSettings"]),{margin:x,cells:S,numCells:P,calculatedImageSettings:N}=we({value:u,level:w,minVersion:a,boostLevel:i,includeMargin:t,marginSize:p,imageSettings:c,size:y});let C=S,M=null;c!=null&&N!=null&&(N.excavation!=null&&(C=Ne(S,N.excavation)),M=B.createElement("image",{href:c.src,height:N.h,width:N.w,x:N.x+x,y:N.y+x,preserveAspectRatio:"none",opacity:N.opacity,crossOrigin:N.crossOrigin}));const O=ve(C,x);return B.createElement("svg",ie({height:y,width:y,viewBox:`0 0 ${P} ${P}`,ref:o,role:"img"},h),!!l&&B.createElement("title",null,l),B.createElement("path",{fill:v,d:`M0,0 h${P}v${P}H0z`,shapeRendering:"crispEdges"}),B.createElement("path",{fill:s,d:O,shapeRendering:"crispEdges"}),M)});ke.displayName="QRCodeSVG";const Oe=()=>{var O,$,F;const{apiKey:r}=ee(),[n,o]=g.useState(null),[d,u]=g.useState(null),[y,w]=g.useState([]),[v,s]=g.useState(!0),[t,a]=g.useState(!1),[i,l]=g.useState(null),p=r?{headers:{"X-API-Key":r}}:{credentials:"include"};g.useEffect(()=>{c()},[]);const c=async()=>{s(!0),l(null);try{const[f,k,E]=await Promise.all([fetch("/api/billing/status",p),fetch("/api/billing/config"),fetch("/api/billing/invoices",p)]);if(f.ok&&o(await f.json()),k.ok&&u(await k.json()),E.ok){const L=await E.json();w(L.invoices||[])}}catch(f){l("Failed to load billing information"),console.error("Billing fetch error:",f)}finally{s(!1)}},h=async f=>{a(!0);try{const k=await fetch("/api/billing/checkout",{method:"POST",headers:{"Content-Type":"application/json",...r?{"X-API-Key":r}:{}},credentials:r?void 0:"include",body:JSON.stringify({price_id:f})});if(k.ok){const E=await k.json();window.location.href=E.checkout_url}else{const E=await k.json();l(E.detail||"Failed to create checkout session")}}catch{l("Failed to create checkout session")}finally{a(!1)}},x=async()=>{a(!0);try{const f=await fetch("/api/billing/portal",{method:"POST",headers:r?{"X-API-Key":r}:{},credentials:r?void 0:"include"});if(f.ok){const k=await f.json();window.location.href=k.portal_url}else{const k=await f.json();l(k.detail||"Failed to open billing portal")}}catch{l("Failed to open billing portal")}finally{a(!1)}},S=async()=>{if(confirm("Are you sure you want to cancel your subscription? You will still have access until the end of your billing period.")){a(!0);try{const f=await fetch("/api/billing/subscription/cancel",{method:"POST",headers:r?{"X-API-Key":r}:{},credentials:r?void 0:"include"});if(f.ok)c();else{const k=await f.json();l(k.detail||"Failed to cancel subscription")}}catch{l("Failed to cancel subscription")}finally{a(!1)}}},P=async()=>{a(!0);try{const f=await fetch("/api/billing/subscription/reactivate",{method:"POST",headers:r?{"X-API-Key":r}:{},credentials:r?void 0:"include"});if(f.ok)c();else{const k=await f.json();l(k.detail||"Failed to reactivate subscription")}}catch{l("Failed to reactivate subscription")}finally{a(!1)}},N=(f,k="usd")=>new Intl.NumberFormat("en-US",{style:"currency",currency:k.toUpperCase()}).format(f/100),C=f=>new Date(f).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}),M=f=>{switch(f){case"active":return"bg-green-100 text-green-800";case"trialing":return"bg-blue-100 text-blue-800";case"past_due":return"bg-red-100 text-red-800";case"canceling":return"bg-yellow-100 text-yellow-800";case"canceled":case"none":return"bg-gray-100 text-gray-800";default:return"bg-gray-100 text-gray-800"}};return v?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"w-8 h-8 rounded-xl flex items-center justify-center animate-pulse-soft",style:{background:"linear-gradient(135deg, #4F46E5, #7C3AED)"}})}):e.jsxs("div",{className:"space-y-6",children:[i&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-red-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"text-red-700",children:i}),e.jsx("button",{onClick:()=>l(null),className:"ml-auto text-red-500 hover:text-red-700",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),n&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Subscription Status"}),e.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${M(n.subscription_status)}`,children:n.subscription_status==="none"?"No Subscription":n.subscription_status})]}),n.has_subscription&&n.subscription?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Current Plan"}),e.jsxs("p",{className:"text-xl font-semibold text-gray-900",children:[(O=n.subscription.plan)!=null&&O.amount?N(n.subscription.plan.amount):"$--",e.jsxs("span",{className:"text-sm font-normal text-gray-500",children:["/",(($=n.subscription.plan)==null?void 0:$.interval)||"month"]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Current Period Ends"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:C(n.subscription.current_period_end)})]}),n.upcoming_invoice&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500 mb-1",children:"Next Payment"}),e.jsx("p",{className:"text-xl font-semibold text-gray-900",children:N(n.upcoming_invoice.amount_due,n.upcoming_invoice.currency)}),n.upcoming_invoice.next_payment_date&&e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["on ",C(n.upcoming_invoice.next_payment_date)]})]})]}),n.subscription.cancel_at_period_end&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-yellow-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-yellow-800",children:"Subscription Canceling"}),e.jsxs("p",{className:"text-sm text-yellow-700",children:["Your subscription will end on ",C(n.subscription.current_period_end),"."]})]}),e.jsx("button",{onClick:P,disabled:t,className:"ml-auto px-4 py-2 bg-yellow-600 text-white font-medium rounded-lg hover:bg-yellow-700 disabled:opacity-50 transition",children:"Reactivate"})]})}),e.jsxs("div",{className:"flex gap-3 pt-4 border-t",children:[e.jsx("button",{onClick:x,disabled:t,className:"px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition",children:"Manage Billing"}),!n.subscription.cancel_at_period_end&&e.jsx("button",{onClick:S,disabled:t,className:"px-4 py-2 text-red-600 hover:text-red-800 font-medium transition",children:"Cancel Subscription"})]})]}):e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 mb-2",children:"Deploy OsirisCare appliances for HIPAA compliance monitoring, operator-authorized remediation, and audit-ready evidence."}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Per-appliance pricing â€¢ Each site/domain requires one appliance"}),d&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("svg",{className:"w-6 h-6 text-green-600 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-green-800",children:"Save up to 80% vs. Traditional MSP + Compliance"}),e.jsxs("p",{className:"text-sm text-green-700",children:["Traditional cost: ~$",(F=d.value_comparison.total_traditional)==null?void 0:F.monthly.toLocaleString(),"/mo per site"]})]})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:Object.entries(d.appliance_tiers).map(([f,k])=>e.jsxs("div",{className:`border-2 rounded-xl p-6 ${f==="practice"?"border-indigo-500 ring-2 ring-indigo-100":"border-gray-200"}`,children:[f==="practice"&&e.jsx("span",{className:"inline-block px-3 py-1 text-xs font-semibold text-indigo-600 bg-indigo-100 rounded-full mb-4",children:"Most Popular"}),e.jsx("h4",{className:"text-xl font-bold text-gray-900",children:k.name}),e.jsx("p",{className:"text-sm text-gray-500 mb-2",children:k.description}),e.jsxs("div",{className:"mt-2 mb-4",children:[e.jsxs("span",{className:"text-3xl font-bold text-gray-900",children:["$",k.price_monthly]}),e.jsx("span",{className:"text-gray-500",children:"/mo per appliance"})]}),e.jsx("p",{className:"text-sm text-gray-600 mb-4 font-medium",children:k.max_endpoints?`Up to ${k.max_endpoints} endpoints`:"Unlimited endpoints"}),e.jsxs("ul",{className:"space-y-2 mb-6",children:[k.features.slice(0,5).map((E,L)=>e.jsxs("li",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx("svg",{className:"w-4 h-4 text-green-500 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),E]},L)),k.features.length>5&&e.jsxs("li",{className:"text-sm text-indigo-600 font-medium",children:["+",k.features.length-5," more features"]})]}),e.jsx("button",{onClick:()=>h(`price_appliance_${f}_monthly`),disabled:t,className:`w-full py-2 px-4 font-medium rounded-lg transition disabled:opacity-50 ${f==="practice"?"bg-indigo-600 text-white hover:bg-indigo-700":"bg-gray-100 text-gray-900 hover:bg-gray-200"}`,children:t?"Loading...":"Get Started"})]},f))}),e.jsx("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:e.jsxs("p",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Alternative:"})," Pay $",d.endpoint_price_monthly,"/endpoint/month for usage-based pricing that scales automatically."]})})]})]})]}),(n==null?void 0:n.payment_methods)&&n.payment_methods.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Payment Methods"}),e.jsx("button",{onClick:x,className:"text-sm text-indigo-600 hover:text-indigo-800 font-medium",children:"Manage"})]}),e.jsx("div",{className:"space-y-3",children:n.payment_methods.map(f=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border border-gray-200 rounded-lg",children:[e.jsx("div",{className:"w-12 h-8 bg-gray-100 rounded flex items-center justify-center",children:e.jsx("span",{className:"text-xs font-bold text-gray-600 uppercase",children:f.brand})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"font-medium text-gray-900",children:["â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ â€¢â€¢â€¢â€¢ ",f.last4]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Expires ",f.exp_month,"/",f.exp_year]})]}),f.is_default&&e.jsx("span",{className:"px-2 py-1 text-xs font-medium text-green-700 bg-green-100 rounded",children:"Default"})]},f.id))})]}),y.length>0&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Invoice History"}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Invoice"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Amount"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:y.map(f=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-mono text-sm",children:f.number})}),e.jsx("td",{className:"px-4 py-3 text-sm text-gray-600",children:C(f.created)}),e.jsx("td",{className:"px-4 py-3 text-sm font-medium text-gray-900",children:N(f.amount_paid||f.amount_due,f.currency)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${f.status==="paid"?"bg-green-100 text-green-800":f.status==="open"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:f.status})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[f.hosted_invoice_url&&e.jsx("a",{href:f.hosted_invoice_url,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-indigo-600 hover:text-indigo-800",children:"View"}),f.invoice_pdf&&e.jsx("a",{href:f.invoice_pdf,target:"_blank",rel:"noopener noreferrer",className:"text-sm text-gray-600 hover:text-gray-800",children:"PDF"})]})})]},f.id))})]})})]})]})},se=[{id:"healthcare",name:"Healthcare",icon:"ðŸ¥"},{id:"finance",name:"Finance",icon:"ðŸ¦"},{id:"technology",name:"Technology",icon:"ðŸ’»"},{id:"retail",name:"Retail",icon:"ðŸ›’"},{id:"government",name:"Government",icon:"ðŸ›ï¸"},{id:"defense",name:"Defense",icon:"ðŸ›¡ï¸"},{id:"legal",name:"Legal",icon:"âš–ï¸"},{id:"education",name:"Education",icon:"ðŸŽ“"},{id:"manufacturing",name:"Manufacturing",icon:"ðŸ­"},{id:"general",name:"General",icon:"ðŸ“‹"}],Te=[{id:"basic",name:"Basic",description:"Essential compliance monitoring"},{id:"standard",name:"Standard",description:"Compliance monitoring + guided remediation"},{id:"full",name:"Full Coverage",description:"Complete automation + priority support"}],Be=()=>{var G,j;const{apiKey:r}=ee(),[n,o]=g.useState(!0),[d,u]=g.useState(!1),[y,w]=g.useState(null),[v,s]=g.useState(null),[,t]=g.useState(null),[a,i]=g.useState([]),[l,p]=g.useState({}),[c,h]=g.useState([]),[x,S]=g.useState({}),[P,N]=g.useState("healthcare"),[C,M]=g.useState("standard"),[O,$]=g.useState([]),[F,f]=g.useState(null),[k,E]=g.useState([]),[L,I]=g.useState(""),b=r?{headers:{"X-API-Key":r}}:{credentials:"include"};g.useEffect(()=>{R()},[]);const R=async()=>{var m,A,T;o(!0),w(null);try{const[V,oe]=await Promise.all([fetch("/api/partners/me/compliance/defaults",b),fetch("/api/partners/me/sites/compliance/summary",b)]);if(V.ok){const Q=await V.json();t(Q.defaults),i(Q.available_frameworks||[]),p(Q.industry_presets||{}),N(((m=Q.defaults)==null?void 0:m.default_industry)||"healthcare"),M(((A=Q.defaults)==null?void 0:A.default_coverage_tier)||"standard"),$(((T=Q.defaults)==null?void 0:T.default_frameworks)||["hipaa"])}if(oe.ok){const Q=await oe.json();h(Q.sites||[]),S(Q.framework_distribution||{})}}catch(V){w("Failed to load compliance settings"),console.error(V)}finally{o(!1)}},H=async()=>{u(!0),w(null),s(null);try{const m=await fetch("/api/partners/me/compliance/defaults",{method:"PUT",headers:{"Content-Type":"application/json",...r?{"X-API-Key":r}:{}},credentials:r?void 0:"include",body:JSON.stringify({default_frameworks:O,default_industry:P,default_coverage_tier:C})});if(m.ok)s("Default compliance settings updated"),R();else{const A=await m.json();w(A.detail||"Failed to save settings")}}catch{w("Failed to save settings")}finally{u(!1)}},U=async(m,A)=>{try{const T=await fetch(`/api/partners/me/sites/${m}/compliance/apply-preset?industry=${A}`,{method:"POST",headers:r?{"X-API-Key":r}:{},credentials:r?void 0:"include"});if(T.ok)s(`Applied ${A} preset to site`),f(null),R();else{const V=await T.json();w(V.detail||"Failed to apply preset")}}catch{w("Failed to apply preset")}},z=async m=>{try{const A=await fetch(`/api/partners/me/sites/${m}/compliance`,{method:"PUT",headers:{"Content-Type":"application/json",...r?{"X-API-Key":r}:{}},credentials:r?void 0:"include",body:JSON.stringify({enabled_frameworks:k,industry:L||null})});if(A.ok)s("Site compliance settings updated"),f(null),R();else{const T=await A.json();w(T.detail||"Failed to update site")}}catch{w("Failed to update site")}},W=(m,A,T)=>{A.includes(m)?T(A.filter(V=>V!==m)):T([...A,m])},K=m=>{const A=a.find(T=>T.id===m);return(A==null?void 0:A.name)||m.toUpperCase()};return n?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-2 border-indigo-500 border-t-transparent"})}):e.jsxs("div",{className:"space-y-6",children:[y&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center justify-between",children:[e.jsx("span",{children:y}),e.jsx("button",{onClick:()=>w(null),className:"text-red-500 hover:text-red-700",children:"Ã—"})]}),v&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center justify-between",children:[e.jsx("span",{children:v}),e.jsx("button",{onClick:()=>s(null),className:"text-green-500 hover:text-green-700",children:"Ã—"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Framework Usage"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[Object.entries(x).map(([m,A])=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("p",{className:"text-2xl font-bold text-indigo-600",children:A}),e.jsx("p",{className:"text-sm text-gray-600",children:K(m)})]},m)),Object.keys(x).length===0&&e.jsx("p",{className:"text-gray-500 col-span-full",children:"No frameworks configured yet"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Default Compliance Settings"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"These settings apply to new sites by default. Individual sites can override these settings."}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Industry"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-2",children:se.map(m=>e.jsxs("button",{onClick:()=>N(m.id),className:`px-3 py-2 rounded-lg text-sm font-medium transition ${P===m.id?"bg-indigo-600 text-white":"bg-gray-100 text-gray-700 hover:bg-gray-200"}`,children:[e.jsx("span",{className:"mr-1",children:m.icon})," ",m.name]},m.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Coverage Tier"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:Te.map(m=>e.jsxs("button",{onClick:()=>M(m.id),className:`p-4 rounded-lg border-2 text-left transition ${C===m.id?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("p",{className:"font-medium text-gray-900",children:m.name}),e.jsx("p",{className:"text-sm text-gray-500",children:m.description})]},m.id))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Default Frameworks"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:a.map(m=>e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition ${O.includes(m.id)?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"checkbox",checked:O.includes(m.id),onChange:()=>W(m.id,O,$),className:"mt-1 h-4 w-4 text-indigo-600 rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:m.name}),e.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:m.description})]})]},m.id))})]}),l[P]&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-700 mb-2",children:["Industry Preset for ",(G=se.find(m=>m.id===P))==null?void 0:G.name,":"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:l[P].map(m=>e.jsx("span",{className:"px-2 py-1 bg-white rounded text-sm text-gray-600 border",children:K(m)},m))})]}),e.jsx("button",{onClick:H,disabled:d,className:"px-6 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition",children:d?"Saving...":"Save Default Settings"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"p-6 border-b",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Site Compliance Configuration"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Configure compliance frameworks for each site"})]}),c.length===0?e.jsx("div",{className:"p-12 text-center",children:e.jsx("p",{className:"text-gray-500",children:"No sites configured yet"})}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Site"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Industry"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Frameworks"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:c.map(m=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"font-medium text-gray-900",children:m.site_name}),e.jsx("p",{className:"text-sm text-gray-500",children:m.site_id})]}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 capitalize",children:m.industry||"Not set"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 capitalize",children:m.tier}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:m.frameworks.map(A=>e.jsx("span",{className:"px-2 py-0.5 bg-indigo-100 text-indigo-700 text-xs rounded",children:K(A)},A))})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${m.status==="active"||m.status==="online"?"bg-green-100 text-green-800":m.status==="pending"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:m.status})}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsx("button",{onClick:()=>{f(m.site_id),E(m.frameworks),I(m.industry||"")},className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium",children:"Configure"})})]},m.site_id))})]})]}),F&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 modal-backdrop",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-2xl shadow-xl max-h-[90vh] overflow-y-auto",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:["Configure Compliance - ",(j=c.find(m=>m.site_id===F))==null?void 0:j.site_name]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Apply Industry Preset"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:se.map(m=>e.jsxs("button",{onClick:()=>U(F,m.id),className:"px-3 py-1.5 text-sm bg-gray-100 hover:bg-gray-200 rounded-lg transition",children:[m.icon," ",m.name]},m.id))})]}),e.jsx("div",{className:"border-t pt-4 mb-4",children:e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Or customize frameworks manually:"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Industry"}),e.jsxs("select",{value:L,onChange:m=>I(m.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500",children:[e.jsx("option",{value:"",children:"Use default"}),se.map(m=>e.jsx("option",{value:m.id,children:m.name},m.id))]})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Enabled Frameworks"}),e.jsx("div",{className:"grid grid-cols-2 gap-3 max-h-64 overflow-y-auto",children:a.map(m=>e.jsxs("label",{className:`flex items-start gap-3 p-3 rounded-lg border cursor-pointer transition ${k.includes(m.id)?"border-indigo-600 bg-indigo-50":"border-gray-200 hover:border-gray-300"}`,children:[e.jsx("input",{type:"checkbox",checked:k.includes(m.id),onChange:()=>W(m.id,k,E),className:"mt-1 h-4 w-4 text-indigo-600 rounded"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900 text-sm",children:m.name}),e.jsx("p",{className:"text-xs text-gray-500",children:m.description})]})]},m.id))})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>f(null),className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition",children:"Cancel"}),e.jsx("button",{onClick:()=>z(F),className:"px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition",children:"Save Changes"})]})]})})]})},Y=()=>{const r=localStorage.getItem("partner_api_key");return r?{"X-API-Key":r}:{}},J={async getExceptions(r,n=!0){const o=await fetch(`/api/exceptions?site_id=${r}&active_only=${n}`,{credentials:"include",headers:Y()});if(!o.ok)throw new Error("Failed to fetch exceptions");return o.json()},async getSummary(r){const n=await fetch(`/api/exceptions/summary?site_id=${r}`,{credentials:"include",headers:Y()});if(!n.ok)throw new Error("Failed to fetch summary");return n.json()},async createException(r){const n=await fetch("/api/exceptions",{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...Y()},body:JSON.stringify(r)});if(!n.ok){const o=await n.json();throw new Error(o.detail||"Failed to create exception")}return n.json()},async renewException(r,n){const o=await fetch(`/api/exceptions/${r}/renew`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...Y()},body:JSON.stringify(n)});if(!o.ok)throw new Error("Failed to renew exception");return o.json()},async revokeException(r,n){const o=await fetch(`/api/exceptions/${r}/revoke`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json",...Y()},body:JSON.stringify({reason:n})});if(!o.ok)throw new Error("Failed to revoke exception");return o.json()},async getAuditLog(r){const n=await fetch(`/api/exceptions/${r}/audit`,{credentials:"include",headers:Y()});if(!n.ok)throw new Error("Failed to fetch audit log");return n.json()}};function $e({sites:r}){var h;const[n,o]=g.useState(((h=r[0])==null?void 0:h.id)||""),[d,u]=g.useState(!1),[y,w]=g.useState(null),[v,s]=g.useState(!1),t=Se(),{data:a=[],isLoading:i}=re({queryKey:["exceptions",n,v],queryFn:()=>J.getExceptions(n,!v),enabled:!!n}),{data:l}=re({queryKey:["exception-summary",n],queryFn:()=>J.getSummary(n),enabled:!!n}),p=ne({mutationFn:({id:x,reason:S})=>J.revokeException(x,S),onSuccess:()=>{t.invalidateQueries({queryKey:["exceptions"]}),t.invalidateQueries({queryKey:["exception-summary"]})}}),c=ne({mutationFn:({id:x,data:S})=>J.renewException(x,S),onSuccess:()=>{t.invalidateQueries({queryKey:["exceptions"]}),t.invalidateQueries({queryKey:["exception-summary"]})}});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 tracking-tight",children:"Exception Management"}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Manage compliance exceptions and risk acceptances"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("select",{value:n,onChange:x=>o(x.target.value),className:"rounded-md border-gray-300 shadow-sm",children:r.map(x=>e.jsx("option",{value:x.id,children:x.name},x.id))}),e.jsx("button",{onClick:()=>u(!0),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"+ New Exception"})]})]}),l&&e.jsxs("div",{className:"grid grid-cols-5 gap-4",children:[e.jsx(Z,{title:"Active",value:l.active,color:"green"}),e.jsx(Z,{title:"Expiring Soon",value:l.expiring_soon,color:"yellow"}),e.jsx(Z,{title:"Expired",value:l.expired,color:"red"}),e.jsx(Z,{title:"Revoked",value:l.revoked,color:"gray"}),e.jsx(Z,{title:"Total",value:l.total,color:"blue"})]}),e.jsx("div",{className:"flex items-center gap-4",children:e.jsxs("label",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",checked:!v,onChange:x=>s(!x.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Active only"})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Scope"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Item"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Expires"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Approved By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:i?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"Loading..."})}):a.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"No exceptions found"})}):a.map(x=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-blue-600",children:e.jsx("button",{onClick:()=>w(x),children:x.id})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs ${x.scope_type==="runbook"?"bg-purple-100 text-purple-800":x.scope_type==="check"?"bg-blue-100 text-blue-800":"bg-orange-100 text-orange-800"}`,children:x.scope_type})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:[x.item_id,x.device_filter&&e.jsxs("span",{className:"ml-2 text-gray-400 text-xs",children:["(",x.device_filter,")"]})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx(Ce,{exception:x})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:x.is_valid&&e.jsxs(e.Fragment,{children:[x.days_until_expiration," days",e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-400",children:new Date(x.expiration_date).toLocaleDateString()})]})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:[x.approved_by,e.jsx("br",{}),e.jsx("span",{className:"text-xs text-gray-400",children:x.approval_tier})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:x.is_active&&x.is_valid&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const S=prompt("Renewal reason:");S&&c.mutate({id:x.id,data:{reason:S}})},className:"text-blue-600 hover:text-blue-800",children:"Renew"}),e.jsx("button",{onClick:()=>{const S=prompt("Revocation reason:");S&&p.mutate({id:x.id,reason:S})},className:"text-red-600 hover:text-red-800",children:"Revoke"})]})})]},x.id))})]})}),d&&e.jsx(ze,{siteId:n,onClose:()=>u(!1),onSuccess:()=>{u(!1),t.invalidateQueries({queryKey:["exceptions"]}),t.invalidateQueries({queryKey:["exception-summary"]})}}),y&&e.jsx(Ue,{exception:y,onClose:()=>w(null)})]})}function Z({title:r,value:n,color:o}){const d={green:"bg-green-100 text-green-800 border-green-200",yellow:"bg-yellow-100 text-yellow-800 border-yellow-200",red:"bg-red-100 text-red-800 border-red-200",gray:"bg-gray-100 text-gray-800 border-gray-200",blue:"bg-blue-100 text-blue-800 border-blue-200"};return e.jsxs("div",{className:`p-4 rounded-2xl border ${d[o]}`,children:[e.jsx("div",{className:"text-2xl font-bold tabular-nums",children:n}),e.jsx("div",{className:"text-sm",children:r})]})}function Ce({exception:r}){return r.is_active?r.is_valid?r.days_until_expiration<=14?e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-yellow-100 text-yellow-600",children:"Expiring Soon"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-green-100 text-green-600",children:"Active"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-red-100 text-red-600",children:"Expired"}):e.jsx("span",{className:"px-2 py-1 rounded-full text-xs bg-gray-100 text-gray-600",children:"Revoked"})}function ze({siteId:r,onClose:n,onSuccess:o}){const[d,u]=g.useState({site_id:r,scope_type:"runbook",item_id:"",device_filter:"",reason:"",compensating_control:"",risk_accepted_by:"",duration_days:30,action:"both"}),[y,w]=g.useState(""),v=ne({mutationFn:J.createException,onSuccess:()=>o(),onError:t=>w(t.message)}),s=t=>{t.preventDefault(),w(""),v.mutate({...d,device_filter:d.device_filter||void 0,compensating_control:d.compensating_control||void 0})};return e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50 modal-backdrop",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:"Create Compliance Exception"}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-100 text-red-700 rounded",children:y}),e.jsxs("form",{onSubmit:s,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Scope Type"}),e.jsxs("select",{value:d.scope_type,onChange:t=>u({...d,scope_type:t.target.value}),className:"w-full rounded-md border-gray-300 shadow-sm",required:!0,children:[e.jsx("option",{value:"runbook",children:"Runbook"}),e.jsx("option",{value:"check",children:"Check"}),e.jsx("option",{value:"control",children:"Control"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Item ID"}),e.jsx("input",{type:"text",value:d.item_id,onChange:t=>u({...d,item_id:t.target.value}),placeholder:"e.g., RB-WIN-PATCH-001",className:"w-full rounded-md border-gray-300 shadow-sm",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Device Filter (optional)"}),e.jsx("input",{type:"text",value:d.device_filter,onChange:t=>u({...d,device_filter:t.target.value}),placeholder:"e.g., hostname:LEGACY-* or leave empty for all devices",className:"w-full rounded-md border-gray-300 shadow-sm"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Leave empty to apply to all devices at this site"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Reason *"}),e.jsx("textarea",{value:d.reason,onChange:t=>u({...d,reason:t.target.value}),placeholder:"Explain why this exception is needed...",className:"w-full rounded-md border-gray-300 shadow-sm",rows:3,required:!0,minLength:10})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Compensating Control (recommended)"}),e.jsx("textarea",{value:d.compensating_control,onChange:t=>u({...d,compensating_control:t.target.value}),placeholder:"What alternative protection is in place? (e.g., Network segmentation isolates the system)",className:"w-full rounded-md border-gray-300 shadow-sm",rows:2})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Risk Accepted By *"}),e.jsx("input",{type:"text",value:d.risk_accepted_by,onChange:t=>u({...d,risk_accepted_by:t.target.value}),placeholder:"Name and role (e.g., Dr. Smith, Practice Owner)",className:"w-full rounded-md border-gray-300 shadow-sm",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Duration"}),e.jsxs("select",{value:d.duration_days,onChange:t=>u({...d,duration_days:parseInt(t.target.value)}),className:"w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:7,children:"7 days"}),e.jsx("option",{value:14,children:"14 days"}),e.jsx("option",{value:30,children:"30 days"}),e.jsx("option",{value:60,children:"60 days"}),e.jsx("option",{value:90,children:"90 days (max for partners)"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Action"}),e.jsxs("select",{value:d.action,onChange:t=>u({...d,action:t.target.value}),className:"w-full rounded-md border-gray-300 shadow-sm",children:[e.jsx("option",{value:"both",children:"Suppress Alert + Skip Remediation"}),e.jsx("option",{value:"suppress_alert",children:"Suppress Alert Only"}),e.jsx("option",{value:"skip_remediation",children:"Skip Remediation Only"})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Choose what happens when this check fails"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t",children:[e.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:v.isPending,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50",children:v.isPending?"Creating...":"Create Exception"})]})]})]})})})}function Ue({exception:r,onClose:n}){const{data:o=[]}=re({queryKey:["exception-audit",r.id],queryFn:()=>J.getAuditLog(r.id)});return e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center p-4 z-50 modal-backdrop",children:e.jsx("div",{className:"bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-xl",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold",children:"Exception Details"}),e.jsx("button",{onClick:n,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Exception ID"}),e.jsx("p",{className:"font-medium",children:r.id})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Status"}),e.jsx("p",{children:e.jsx(Ce,{exception:r})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Scope"}),e.jsxs("p",{className:"font-medium",children:[r.scope_type,": ",r.item_id]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Device Filter"}),e.jsx("p",{className:"font-medium",children:r.device_filter||"All devices"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Action"}),e.jsx("p",{className:"font-medium",children:r.action.replace("_"," ")})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Approval Tier"}),e.jsx("p",{className:"font-medium",children:r.approval_tier})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Reason"}),e.jsx("p",{className:"mt-1",children:r.reason})]}),r.compensating_control&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Compensating Control"}),e.jsx("p",{className:"mt-1",children:r.compensating_control})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Risk Accepted By"}),e.jsx("p",{className:"font-medium",children:r.risk_accepted_by})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Approved By"}),e.jsx("p",{className:"font-medium",children:r.approved_by})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Start Date"}),e.jsx("p",{className:"font-medium",children:new Date(r.start_date).toLocaleDateString()})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm text-gray-500",children:"Expiration Date"}),e.jsx("p",{className:"font-medium",children:new Date(r.expiration_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Audit Log"}),e.jsx("div",{className:"space-y-2",children:o.map((d,u)=>e.jsxs("div",{className:"text-sm bg-gray-50 p-2 rounded",children:[e.jsx("span",{className:"font-medium",children:d.action})," by ",d.performed_by,e.jsx("span",{className:"text-gray-400 ml-2",children:new Date(d.performed_at).toLocaleString()}),d.notes&&e.jsx("p",{className:"text-gray-600 mt-1",children:d.notes})]},u))})]})]}),e.jsx("div",{className:"flex justify-end pt-4 mt-4 border-t",children:e.jsx("button",{onClick:n,className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Close"})})]})})})}const He=()=>{const{apiKey:r,isAuthenticated:n}=ee(),[o,d]=g.useState(null),[u,y]=g.useState([]),[w,v]=g.useState([]),[s,t]=g.useState(!0),[a,i]=g.useState(null),[l,p]=g.useState(null),[c,h]=g.useState(null),[x,S]=g.useState(!1),[P,N]=g.useState(!1),[C,M]=g.useState(""),[O,$]=g.useState(""),[F,f]=g.useState(""),[k,E]=g.useState(!1),[L,I]=g.useState(!1),b=r?{headers:{"X-API-Key":r}}:{credentials:"include"};g.useEffect(()=>{n&&R()},[n]);const R=async()=>{t(!0),i(null);try{const[j,m,A]=await Promise.all([fetch("/api/partners/me/learning/stats",b),fetch("/api/partners/me/learning/candidates",b),fetch("/api/partners/me/learning/promoted-rules",b)]);if(j.ok){const T=await j.json();d(T)}if(m.ok){const T=await m.json();y(T.candidates||[])}if(A.ok){const T=await A.json();v(T.rules||[])}}catch(j){console.error("Failed to load learning data",j),i("Failed to load learning data")}finally{t(!1)}},H=async()=>{if(c){E(!0),i(null);try{const j=await fetch(`/api/partners/me/learning/candidates/${c.id}/approve`,{method:"POST",headers:{"Content-Type":"application/json",...r?{"X-API-Key":r}:{}},credentials:r?void 0:"include",body:JSON.stringify({deploy_immediately:!0,custom_name:C||void 0,notes:O||void 0})});if(j.ok){const m=await j.json();p(`Rule ${m.rule_id} created and deployed to ${m.deployed_to} appliances`),S(!1),h(null),M(""),$(""),R()}else{const m=await j.json();i(m.detail||"Failed to approve candidate")}}catch{i("Failed to approve candidate")}finally{E(!1)}}},U=async()=>{if(!(!c||!F.trim())){E(!0),i(null);try{const j=await fetch(`/api/partners/me/learning/candidates/${c.id}/reject`,{method:"POST",headers:{"Content-Type":"application/json",...r?{"X-API-Key":r}:{}},credentials:r?void 0:"include",body:JSON.stringify({reason:F})});if(j.ok)p("Pattern rejected"),N(!1),h(null),f(""),R();else{const m=await j.json();i(m.detail||"Failed to reject candidate")}}catch{i("Failed to reject candidate")}finally{E(!1)}}},z=async j=>{const m=j.status==="active"?"disabled":"active";try{const A=await fetch(`/api/partners/me/learning/promoted-rules/${j.rule_id}/status?status=${m}`,{method:"PATCH",headers:r?{"X-API-Key":r}:{},credentials:r?void 0:"include"});if(A.ok)p(`Rule ${j.rule_id} ${m}`),R();else{const T=await A.json();i(T.detail||"Failed to update rule status")}}catch{i("Failed to update rule status")}},W=j=>{switch(j){case"approved":case"active":return"bg-green-100 text-green-800";case"pending":case"not_submitted":return"bg-yellow-100 text-yellow-800";case"rejected":case"disabled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},K=j=>`${(j*100).toFixed(1)}%`,G=j=>j?new Date(j).toLocaleDateString():"-";return s?e.jsxs("div",{className:"flex items-center justify-center p-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"}),e.jsx("span",{className:"ml-3 text-gray-500",children:"Loading learning data..."})]}):e.jsxs("div",{className:"space-y-6",children:[a&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg flex items-center justify-between",children:[e.jsx("span",{children:a}),e.jsx("button",{onClick:()=>i(null),className:"text-red-500 hover:text-red-700",children:"Ã—"})]}),l&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-lg flex items-center justify-between",children:[e.jsx("span",{children:l}),e.jsx("button",{onClick:()=>p(null),className:"text-green-500 hover:text-green-700",children:"Ã—"})]}),o&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pending Candidates"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-600 tabular-nums",children:o.pending_candidates})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Active L1 Rules"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 tabular-nums",children:o.active_promoted_rules})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"L1 Resolution Rate"}),e.jsx("p",{className:"text-2xl font-bold text-indigo-600 tabular-nums",children:K(o.l1_resolution_rate)})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 p-6",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Avg Success Rate"}),e.jsx("p",{className:"text-2xl font-bold text-blue-600 tabular-nums",children:K(o.avg_success_rate)})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Promotion Candidates"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Patterns eligible for L1 promotion (5+ occurrences, 90%+ success rate)"})]}),u.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Promotion Candidates"}),e.jsx("p",{className:"text-gray-500",children:"Patterns will appear here once they meet the promotion criteria."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Pattern"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Site"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Occurrences"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Success Rate"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:u.map(j=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:j.recommended_action||"Unknown Pattern"}),e.jsxs("p",{className:"text-xs text-gray-500 font-mono",children:[j.pattern_signature.substring(0,12),"..."]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-gray-900",children:j.site_name})}),e.jsxs("td",{className:"px-6 py-4",children:[e.jsx("p",{className:"text-sm text-gray-900",children:j.total_occurrences}),e.jsxs("p",{className:"text-xs text-gray-500",children:["L2: ",j.l2_resolutions]})]}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${j.success_rate>=.95?"bg-green-100 text-green-800":j.success_rate>=.9?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:K(j.success_rate)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${W(j.approval_status)}`,children:j.approval_status==="not_submitted"?"Pending Review":j.approval_status})}),e.jsx("td",{className:"px-6 py-4",children:j.approval_status==="not_submitted"&&e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>{h(j),S(!0)},className:"px-3 py-1 bg-green-600 text-white text-sm font-medium rounded hover:bg-green-700 transition",children:"Approve"}),e.jsx("button",{onClick:()=>{h(j),N(!0)},className:"px-3 py-1 bg-red-100 text-red-700 text-sm font-medium rounded hover:bg-red-200 transition",children:"Reject"})]})})]},j.id))})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 flex items-center justify-between cursor-pointer",onClick:()=>I(!L),children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900",children:["Promoted Rules (",w.length,")"]}),e.jsx("p",{className:"text-sm text-gray-500",children:"Active L1 rules deployed from pattern promotions"})]}),e.jsx("svg",{className:`w-5 h-5 text-gray-500 transform transition ${L?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),L&&(w.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"No promoted rules yet. Approve promotion candidates to create L1 rules."}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Rule ID"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Site"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Deployments"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Promoted"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:w.map(j=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm font-medium text-gray-900 font-mono",children:j.rule_id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-gray-900",children:j.site_name||j.site_id})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-gray-900",children:j.deployment_count})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("p",{className:"text-sm text-gray-900",children:G(j.promoted_at)})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${W(j.status)}`,children:j.status})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("button",{onClick:()=>z(j),className:`px-3 py-1 text-sm font-medium rounded transition ${j.status==="active"?"bg-red-100 text-red-700 hover:bg-red-200":"bg-green-100 text-green-700 hover:bg-green-200"}`,children:j.status==="active"?"Disable":"Enable"})})]},j.id))})]}))]}),x&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 modal-backdrop",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-lg shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Approve Pattern for L1 Promotion"}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Pattern"}),e.jsx("p",{className:"text-sm font-medium text-gray-900",children:c.recommended_action}),e.jsx("p",{className:"text-xs text-gray-500 font-mono mt-1",children:c.pattern_signature})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Occurrences"}),e.jsx("p",{className:"text-lg font-semibold text-gray-900",children:c.total_occurrences})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"Success Rate"}),e.jsx("p",{className:"text-lg font-semibold text-green-600",children:K(c.success_rate)})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Custom Rule Name (optional)"}),e.jsx("input",{type:"text",value:C,onChange:j=>M(j.target.value),placeholder:"e.g., Firewall Auto-Heal",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Notes (optional)"}),e.jsx("textarea",{value:O,onChange:j=>$(j.target.value),placeholder:"Approval notes...",rows:2,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{S(!1),h(null),M(""),$("")},className:"px-4 py-2 text-gray-700 font-medium rounded-lg hover:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:H,disabled:k,className:"px-4 py-2 bg-green-600 text-white font-medium rounded-lg hover:bg-green-700 disabled:opacity-50 transition",children:k?"Approving...":"Approve & Deploy"})]})]})}),P&&c&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 modal-backdrop",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Reject Pattern"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason"}),e.jsx("textarea",{value:F,onChange:j=>f(j.target.value),placeholder:"Why is this pattern not suitable for L1 promotion?",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx("button",{onClick:()=>{N(!1),h(null),f("")},className:"px-4 py-2 text-gray-700 font-medium rounded-lg hover:bg-gray-100 transition",children:"Cancel"}),e.jsx("button",{onClick:U,disabled:k||!F,className:"px-4 py-2 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 disabled:opacity-50 transition",children:k?"Rejecting...":"Reject"})]})]})})]})},Ge=()=>{const r=xe(),[n]=de(),{partner:o,apiKey:d,isAuthenticated:u,isLoading:y,logout:w}=ee(),[v,s]=g.useState("sites");g.useEffect(()=>{const b=n.get("billing");(b==="success"||b==="canceled")&&s("billing")},[n]);const[t,a]=g.useState([]),[i,l]=g.useState([]),[p,c]=g.useState(!0),[h,x]=g.useState(!1),[S,P]=g.useState(""),[N,C]=g.useState(!1),[M,O]=g.useState(null);g.useEffect(()=>{!y&&!u&&r("/partner/login",{replace:!0})},[u,y,r]),g.useEffect(()=>{u&&$()},[u]);const $=async()=>{if(!u)return;c(!0);const R=d?{headers:d?{"X-API-Key":d}:{}}:{credentials:"include"};try{const[H,U]=await Promise.all([fetch("/api/partners/me/sites",R),fetch("/api/partners/me/provisions",R)]);if(H.ok){const z=await H.json();a(z.sites||[])}if(U.ok){const z=await U.json();l(z.provisions||[])}}catch(H){console.error("Failed to load data",H)}finally{c(!1)}},F=async()=>{if(!(!u||!S.trim())){C(!0);try{(await fetch("/api/partners/me/provisions",{method:"POST",headers:d?{"Content-Type":"application/json","X-API-Key":d}:{"Content-Type":"application/json"},credentials:d?void 0:"include",body:JSON.stringify({target_client_name:S.trim(),expires_days:30})})).ok&&(P(""),x(!1),$())}catch(b){console.error("Failed to create provision",b)}finally{C(!1)}}},f=async b=>{if(!(!u||!confirm("Revoke this provision code?")))try{const R=d?{method:"DELETE",headers:{"X-API-Key":d}}:{method:"DELETE",credentials:"include"};await fetch(`/api/partners/me/provisions/${b}`,R),$()}catch(R){console.error("Failed to revoke",R)}},k=b=>{switch(b){case"online":case"active":case"claimed":return"bg-green-100 text-green-800";case"pending":return"bg-yellow-100 text-yellow-800";case"offline":case"expired":case"revoked":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},E=b=>b?new Date(b).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"}):"-",L=b=>{if(!b)return"Never";const R=new Date(b),U=new Date().getTime()-R.getTime(),z=Math.floor(U/6e4);return z<1?"Just now":z<60?`${z}m ago`:z<1440?`${Math.floor(z/60)}h ago`:E(b)};if(y||p)return e.jsx("div",{className:"min-h-screen bg-gray-50/80 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl mx-auto mb-4 flex items-center justify-center animate-pulse-soft",style:{background:"linear-gradient(135deg, #4F46E5 0%, #7C3AED 100%)"},children:e.jsx("svg",{className:"w-6 h-6 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("p",{className:"text-gray-500 text-sm",children:"Loading dashboard..."})]})});if(!o)return null;const I=o.primary_color||"#4F46E5";return e.jsxs("div",{className:"min-h-screen bg-gray-50/80 page-enter",children:[e.jsx("header",{className:"sticky top-0 z-30 border-b border-gray-200/60",style:{background:"rgba(255,255,255,0.82)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[o.logo_url?e.jsx("img",{src:o.logo_url,alt:o.brand_name,className:"h-10"}):e.jsx("div",{className:"w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold text-lg",style:{background:`linear-gradient(135deg, ${I} 0%, #7C3AED 100%)`,boxShadow:`0 2px 10px ${I}40`},children:o.brand_name.charAt(0)}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-lg font-semibold text-gray-900 tracking-tight",children:o.brand_name}),e.jsx("p",{className:"text-xs text-gray-500",children:"Partner Dashboard"})]})]}),e.jsx("button",{onClick:()=>{w(),r("/partner/login")},className:"px-4 py-2 text-sm text-gray-500 hover:text-gray-900 rounded-lg hover:bg-gray-100 transition",children:"Sign Out"})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6 py-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(79,70,229,0.12) 0%, rgba(124,58,237,0.08) 100%)"},children:e.jsx("svg",{className:"w-5 h-5 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5"})})}),e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Total Sites"})]}),e.jsx("p",{className:"text-3xl font-bold text-gray-900 tabular-nums",children:o.site_count})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(234,179,8,0.12) 0%, rgba(245,158,11,0.08) 100%)"},children:e.jsx("svg",{className:"w-5 h-5 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Pending"})]}),e.jsx("p",{className:"text-3xl font-bold text-yellow-600 tabular-nums",children:o.provisions.pending})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center",style:{background:"linear-gradient(135deg, rgba(34,197,94,0.12) 0%, rgba(22,163,74,0.08) 100%)"},children:e.jsx("svg",{className:"w-5 h-5 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Claimed"})]}),e.jsx("p",{className:"text-3xl font-bold text-green-600 tabular-nums",children:o.provisions.claimed})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-6 shadow-sm border border-gray-100 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-xl flex items-center justify-center",style:{background:`linear-gradient(135deg, ${I}1F 0%, ${I}14 100%)`},children:e.jsx("svg",{className:"w-5 h-5",style:{color:I},fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("p",{className:"text-xs font-medium text-gray-500 uppercase tracking-wide",children:"Revenue Share"})]}),e.jsxs("p",{className:"text-3xl font-bold tabular-nums",style:{color:I},children:[o.revenue_share_percent,"%"]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-6",children:e.jsxs("div",{className:"flex gap-4 border-b",children:[e.jsxs("button",{onClick:()=>s("sites"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="sites"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Sites (",t.length,")"]}),e.jsxs("button",{onClick:()=>s("provisions"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="provisions"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:["Provision Codes (",i.length,")"]}),e.jsx("button",{onClick:()=>s("billing"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="billing"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Billing"}),e.jsx("button",{onClick:()=>s("compliance"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="compliance"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Compliance"}),e.jsx("button",{onClick:()=>s("exceptions"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="exceptions"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Exceptions"}),e.jsx("button",{onClick:()=>s("learning"),className:`px-4 py-3 font-medium transition border-b-2 -mb-px ${v==="learning"?"border-indigo-600 text-indigo-600":"border-transparent text-gray-500 hover:text-gray-700"}`,children:"Learning"})]})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-6",children:[v==="sites"&&e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:t.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Sites Yet"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"Create a provision code and use it to onboard your first client."}),e.jsx("button",{onClick:()=>{s("provisions"),x(!0)},className:"px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition",children:"Create Provision Code"})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Site"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Tier"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Appliances"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Last Check-in"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:t.map(b=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-gray-900",children:b.clinic_name}),e.jsx("p",{className:"text-sm text-gray-500",children:b.site_id})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${k(b.status)}`,children:b.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600 capitalize",children:b.tier}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:b.appliance_count}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:L(b.last_checkin)})]},b.site_id))})]})}),v==="provisions"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-4 flex justify-end",children:e.jsxs("button",{onClick:()=>x(!0),className:"px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"New Provision Code"]})}),h&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 modal-backdrop",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md shadow-xl",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Create Provision Code"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Client Name"}),e.jsx("input",{type:"text",value:S,onChange:b=>P(b.target.value),placeholder:"e.g., Scranton Family Practice",className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"This will be the default name when the appliance claims this code."})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx("button",{onClick:()=>{x(!1),P("")},className:"px-4 py-2 text-gray-600 hover:text-gray-900 transition",children:"Cancel"}),e.jsx("button",{onClick:F,disabled:N||!S.trim(),className:"px-4 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 disabled:opacity-50 transition",children:N?"Creating...":"Create Code"})]})]})}),M&&e.jsx("div",{className:"fixed inset-0 bg-black/40 flex items-center justify-center z-50 modal-backdrop",children:e.jsx("div",{className:"bg-white rounded-2xl p-8 w-full max-w-md shadow-xl",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Provision QR Code"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:M.target_client_name||"New Appliance"}),e.jsx("div",{className:"bg-white p-4 rounded-xl border-2 border-gray-200 inline-block mb-6",children:e.jsx(ke,{value:M.qr_content,size:200,level:"M",includeMargin:!0})}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-xs text-gray-500 uppercase tracking-wide mb-2",children:"Manual Entry Code"}),e.jsx("code",{className:"px-4 py-2 bg-gray-100 rounded-lg text-lg font-mono font-bold tracking-wider",children:M.provision_code})]}),e.jsxs("div",{className:"text-left bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("p",{className:"text-sm font-medium text-gray-700 mb-2",children:"To provision an appliance:"}),e.jsxs("ol",{className:"text-sm text-gray-600 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Boot the OsirisCare appliance"}),e.jsx("li",{children:"Scan this QR code or enter the code manually"}),e.jsx("li",{children:"The appliance will register automatically"})]})]}),e.jsxs("p",{className:"text-xs text-gray-400 mb-4",children:["Expires: ",E(M.expires_at)]}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsxs("button",{onClick:()=>{navigator.clipboard.writeText(M.provision_code)},className:"px-4 py-2 text-indigo-600 hover:text-indigo-800 font-medium transition flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"})}),"Copy Code"]}),e.jsx("button",{onClick:()=>O(null),className:"px-4 py-2 bg-gray-900 text-white font-medium rounded-lg hover:bg-gray-800 transition",children:"Done"})]})]})})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden",children:i.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No Provision Codes"}),e.jsx("p",{className:"text-gray-500",children:"Create a provision code to onboard new appliances."})]}):e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-gray-50 border-b",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Code"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Client"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Created"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase",children:"Expires"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase",children:"Actions"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:i.map(b=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4",children:e.jsx("code",{className:"px-2 py-1 bg-gray-100 rounded text-sm font-mono",children:b.provision_code})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:b.target_client_name||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${k(b.status)}`,children:b.status})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:E(b.created_at)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-600",children:E(b.expires_at)}),e.jsx("td",{className:"px-6 py-4 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[b.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>O(b),className:"text-indigo-600 hover:text-indigo-800 text-sm font-medium flex items-center gap-1",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"})}),"QR"]}),e.jsx("button",{onClick:()=>f(b.id),className:"text-red-600 hover:text-red-800 text-sm font-medium",children:"Revoke"})]}),b.status==="claimed"&&e.jsx("span",{className:"text-sm text-gray-500",children:b.claimed_by_mac})]})})]},b.id))})]})})]}),v==="billing"&&e.jsx(Oe,{}),v==="compliance"&&e.jsx(Be,{}),v==="exceptions"&&e.jsx($e,{sites:t.map(b=>({id:b.site_id,name:b.clinic_name}))}),v==="learning"&&e.jsx(He,{})]})]})};export{Ge as PartnerDashboard,He as PartnerLearning,We as PartnerLogin,Qe as PartnerProvider,ee as usePartner};
