import{Z as v,m as N,s as y,r as d,j as e}from"./index-D3EplXpq.js";const w=({status:r})=>{const t={valid:"bg-green-100 text-green-800 border-green-200",verified:"bg-green-100 text-green-800 border-green-200",invalid:"bg-red-100 text-red-800 border-red-200",broken:"bg-red-100 text-red-800 border-red-200",signature_invalid:"bg-orange-100 text-orange-800 border-orange-200",empty:"bg-gray-100 text-gray-800 border-gray-200",error:"bg-red-100 text-red-800 border-red-200"},a={valid:"Chain Valid",verified:"Chain Verified",invalid:"Chain Invalid",broken:"Chain Broken",signature_invalid:"Signature Invalid",empty:"No Evidence",error:"Error"},n={valid:"✓",verified:"✓",invalid:"✗",broken:"✗",signature_invalid:"⚠",empty:"○",error:"!"};return e.jsxs("span",{className:`inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium border ${t[r]||t.error}`,children:[e.jsx("span",{className:"text-lg",children:n[r]||"?"}),a[r]||r]})},b=({label:r,hash:t,isGenesis:a})=>e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3",children:[e.jsx("span",{className:"text-xs text-gray-500 block mb-1",children:r}),e.jsx("code",{className:`text-xs font-mono break-all ${a?"text-gray-400":"text-gray-700"}`,children:a?"(genesis - all zeros)":t})]}),_=({bundles:r})=>r.length===0?null:e.jsx("div",{className:"space-y-4",children:r.map((t,a)=>{const n=t.prev_hash==="0".repeat(64);return e.jsxs("div",{className:"relative pl-8",children:[a<r.length-1&&e.jsx("div",{className:"absolute left-3 top-8 bottom-0 w-0.5 bg-gray-200"}),e.jsx("div",{className:`absolute left-0 top-2 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold
              ${n?"bg-blue-100 text-blue-600":"bg-green-100 text-green-600"}`,children:n?"G":r.length-a}),e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl p-4 hover:shadow-sm transition",children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-gray-900",children:t.bundle_id}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(t.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[t.is_signed&&e.jsxs("span",{className:"text-xs bg-green-100 text-green-700 px-2 py-1 rounded flex items-center gap-1",title:`Signed by: ${t.signed_by}`,children:[e.jsx("svg",{className:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M2.166 4.999A11.954 11.954 0 0010 1.944 11.954 11.954 0 0017.834 5c.11.65.166 1.32.166 2.001 0 5.225-3.34 9.67-8 11.317C5.34 16.67 2 12.225 2 7c0-.682.057-1.35.166-2.001zm11.541 3.708a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}),"Signed"]}),e.jsxs("span",{className:"text-xs bg-gray-100 text-gray-600 px-2 py-1 rounded",children:[t.checks_count," checks"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[e.jsx(b,{label:"Previous Hash",hash:t.prev_hash,isGenesis:n}),e.jsx(b,{label:"Bundle Hash",hash:t.bundle_hash})]}),!n&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-400",children:[e.jsxs("span",{className:"font-mono",children:[t.prev_hash.substring(0,8),"..."]}),e.jsx("span",{children:"links to previous bundle"})]})]})]},t.bundle_id)})}),E=()=>{var g;const[r]=v(),t=N(),{siteId:a}=y(),n=r.get("token"),[s,u]=d.useState(null),[c,p]=d.useState([]),[j,o]=d.useState(!0),[x,m]=d.useState(null);d.useEffect(()=>{if(!a){m("Invalid site ID"),o(!1);return}const i={};n&&(i.Authorization=`Bearer ${n}`),Promise.all([fetch(`/api/evidence/sites/${a}/verify`,{credentials:"include",headers:i}).then(l=>l.json()),fetch(`/api/evidence/sites/${a}/bundles?limit=20`,{credentials:"include",headers:i}).then(l=>l.json())]).then(([l,f])=>{u(l),p(f.bundles||[])}).catch(l=>{m(l.message||"Failed to load verification data")}).finally(()=>o(!1))},[a,n]);const h=()=>{const i=n?`/portal/site/${a}/dashboard?token=${n}`:`/portal/site/${a}/dashboard`;t(i)};return j?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-12 h-12 border-4 border-blue-500 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Verifying evidence chain..."})]})}):x?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:"!"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Verification Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:x}),e.jsx("button",{onClick:h,className:"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition",children:"Back to Dashboard"})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white border-b shadow-sm",children:e.jsxs("div",{className:"max-w-5xl mx-auto px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Evidence Chain Verification"}),e.jsx("p",{className:"text-sm text-gray-500",children:"Cryptographic proof of compliance evidence integrity"})]}),e.jsx("button",{onClick:h,className:"px-4 py-2 text-sm text-gray-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg transition",children:"Back to Dashboard"})]})}),e.jsxs("main",{className:"max-w-5xl mx-auto px-6 py-8",children:[e.jsxs("section",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-8 mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Chain Integrity Status"}),s&&e.jsx(w,{status:s.status})]}),((s==null?void 0:s.status)==="valid"||(s==null?void 0:s.status)==="verified")&&e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6",children:e.jsxs("p",{className:"text-green-800",children:["All ",s.chain_length," evidence bundles form a valid cryptographic chain. Each bundle's hash correctly references its predecessor, ensuring no tampering has occurred.",s.signatures_total!==null&&s.signatures_total>0&&e.jsxs("span",{className:"block mt-2",children:[e.jsx("strong",{children:s.signatures_valid})," of ",e.jsx("strong",{children:s.signatures_total})," bundles have valid Ed25519 signatures."]})]})}),((s==null?void 0:s.status)==="invalid"||(s==null?void 0:s.status)==="broken")&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4 mb-6",children:e.jsxs("p",{className:"text-red-800",children:["Chain integrity verification failed at bundle: ",e.jsx("code",{className:"font-mono",children:s.bundle_id}),e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:s.error})]})}),(s==null?void 0:s.status)==="signature_invalid"&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4 mb-6",children:e.jsxs("p",{className:"text-orange-800",children:["Ed25519 signature verification failed at bundle: ",e.jsx("code",{className:"font-mono",children:s.bundle_id}),e.jsx("br",{}),e.jsx("span",{className:"text-sm",children:s.error}),e.jsx("br",{}),e.jsxs("span",{className:"text-sm mt-2 block",children:["Chain valid: ",s.chain_length," bundles | Signatures: ",s.signatures_valid,"/",s.signatures_total," valid"]})]})}),(s==null?void 0:s.status)==="empty"&&e.jsx("div",{className:"bg-gray-50 border border-gray-200 rounded-xl p-4 mb-6",children:e.jsx("p",{className:"text-gray-600",children:"No compliance evidence bundles have been recorded yet for this site. Evidence will appear here after the first compliance scan."})}),s&&s.status!=="empty"&&e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("span",{className:"text-3xl font-bold text-gray-900",children:s.chain_length}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Total Bundles"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("span",{className:"text-3xl font-bold text-green-600",children:s.signatures_valid??0}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Signed Bundles"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsxs("span",{className:"text-sm font-mono text-gray-700",children:[(g=s.first_bundle)==null?void 0:g.substring(0,12),"..."]}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Genesis Bundle"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.first_timestamp&&new Date(s.first_timestamp).toLocaleDateString()}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"First Evidence"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 text-center",children:[e.jsx("span",{className:"text-sm text-gray-700",children:s.last_timestamp&&new Date(s.last_timestamp).toLocaleDateString()}),e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Latest Evidence"})]})]})]}),c.length>0&&e.jsxs("section",{className:"bg-white rounded-2xl border border-gray-200 shadow-sm p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Evidence Bundle Timeline"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"Each bundle contains a cryptographic hash linking it to the previous bundle, forming an immutable chain. The genesis bundle (G) starts the chain with an all-zeros previous hash."}),e.jsx(_,{bundles:c})]}),e.jsxs("section",{className:"mt-8 bg-blue-50 rounded-2xl border border-blue-200 p-8",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-900 mb-4",children:"How Evidence Verification Works"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 text-sm text-blue-800",children:[e.jsxs("div",{children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold mb-3",children:"1"}),e.jsx("h3",{className:"font-semibold mb-1",children:"Bundle Creation"}),e.jsx("p",{className:"text-blue-700",children:"Each compliance scan generates an evidence bundle containing check results, timestamps, and metadata."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold mb-3",children:"2"}),e.jsx("h3",{className:"font-semibold mb-1",children:"Hash Linking"}),e.jsx("p",{className:"text-blue-700",children:"The bundle is hashed using SHA-256, and includes the previous bundle's hash, creating a chain."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold mb-3",children:"3"}),e.jsx("h3",{className:"font-semibold mb-1",children:"Ed25519 Signing"}),e.jsx("p",{className:"text-blue-700",children:"Each bundle hash is signed with the server's Ed25519 private key, proving authenticity and origin."})]}),e.jsxs("div",{children:[e.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center text-blue-600 font-bold mb-3",children:"4"}),e.jsx("h3",{className:"font-semibold mb-1",children:"Tamper Detection"}),e.jsx("p",{className:"text-blue-700",children:"Any modification breaks the chain hash or invalidates the signature, revealing tampering."})]})]})]}),e.jsxs("footer",{className:"mt-12 pt-8 border-t border-gray-200 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500",children:"This verification page provides cryptographic proof of evidence integrity for HIPAA auditors."}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-300",children:"Powered by"}),e.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"OsirisCare"})]})]})]})]})};export{E as PortalVerify,E as default};
