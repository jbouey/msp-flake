import{s as y,r as p,W as N,X as v,j as e,S as u,G as i,K as x,B as j}from"./index-Dfzg2dGd.js";function d(s){if(!s)return"Never";const t=new Date(s),l=new Date().getTime()-t.getTime(),r=Math.floor(l/6e4);if(r<1)return"Just now";if(r<60)return`${r} min ago`;const a=Math.floor(r/60);return a<24?`${a}h ago`:`${Math.floor(a/24)}d ago`}const m={workstation:{icon:"ðŸ’»",label:"Workstation",color:"text-blue-400"},server:{icon:"ðŸ–¥ï¸",label:"Server",color:"text-purple-400"},network:{icon:"ðŸ”Œ",label:"Network",color:"text-orange-400"},printer:{icon:"ðŸ–¨ï¸",label:"Printer",color:"text-gray-400"},medical:{icon:"ðŸ¥",label:"Medical",color:"text-red-400"},unknown:{icon:"â“",label:"Unknown",color:"text-gray-500"}},h={compliant:"bg-health-healthy text-white",drifted:"bg-health-critical text-white",unknown:"bg-gray-500 text-white",excluded:"bg-gray-600 text-white"},g=({summary:s})=>{const t=s.compliance_rate>=80?"text-health-healthy":s.compliance_rate>=50?"text-health-warning":"text-health-critical";return e.jsxs(i,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-label-primary mb-4",children:"Device Inventory Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${t}`,children:[s.compliance_rate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Compliance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-label-primary",children:s.total_devices}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-health-healthy",children:s.by_compliance.compliant}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Compliant"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-health-critical",children:s.by_compliance.drifted}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Drifted"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-400",children:s.by_compliance.unknown}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Unknown"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-red-400",children:s.medical_devices.total}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Medical"})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t border-glass-border",children:[e.jsx("h3",{className:"text-sm font-medium text-label-secondary mb-3",children:"Devices by Type"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3",children:[e.jsxs("div",{className:"rounded-lg p-3 bg-blue-500/10 border border-blue-500/30 text-center",children:[e.jsx("div",{className:"text-sm font-medium text-blue-400",children:"Workstations"}),e.jsx("div",{className:"text-2xl font-bold text-label-primary",children:s.by_type.workstations})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-purple-500/10 border border-purple-500/30 text-center",children:[e.jsx("div",{className:"text-sm font-medium text-purple-400",children:"Servers"}),e.jsx("div",{className:"text-2xl font-bold text-label-primary",children:s.by_type.servers})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-orange-500/10 border border-orange-500/30 text-center",children:[e.jsx("div",{className:"text-sm font-medium text-orange-400",children:"Network"}),e.jsx("div",{className:"text-2xl font-bold text-label-primary",children:s.by_type.network})]}),e.jsxs("div",{className:"rounded-lg p-3 bg-gray-500/10 border border-gray-500/30 text-center",children:[e.jsx("div",{className:"text-sm font-medium text-gray-400",children:"Printers"}),e.jsx("div",{className:"text-2xl font-bold text-label-primary",children:s.by_type.printers})]})]})]}),s.medical_devices.total>0&&e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:"âš ï¸"}),e.jsxs("div",{className:"text-sm text-red-400",children:[e.jsxs("strong",{children:[s.medical_devices.total," medical device(s) detected"]})," - Excluded from compliance scanning by default for patient safety.",s.medical_devices.excluded_by_default&&" Manual opt-in required for monitoring."]})]})})]})},f=({device:s,expanded:t,onToggle:n})=>{const l=m[s.device_type]||m.unknown,r=h[s.compliance_status]||h.unknown;return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-glass-bg/30 cursor-pointer transition-colors",onClick:n,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-lg",children:l.icon}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium text-label-primary",children:s.hostname||s.ip_address}),s.medical_device&&e.jsx(j,{variant:"error",className:"ml-2 text-xs",children:"Medical"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-label-secondary font-mono text-sm",children:s.ip_address}),e.jsx("td",{className:"px-4 py-3 text-label-secondary font-mono text-sm",children:s.mac_address||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`${l.color} text-sm`,children:l.label})}),e.jsx("td",{className:"px-4 py-3 text-label-secondary text-sm",children:s.os_name||"-"}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r}`,children:s.compliance_status})}),e.jsx("td",{className:"px-4 py-3 text-label-secondary text-sm",children:d(s.last_seen_at)}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("svg",{className:`w-5 h-5 text-label-tertiary transition-transform ${t?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),t&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-4 py-4 bg-glass-bg/20",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"OS Version:"}),e.jsx("div",{className:"text-label-primary font-medium",children:s.os_version||"Unknown"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"Discovery Source:"}),e.jsx("div",{className:"text-label-primary font-medium",children:s.discovery_source})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"First Seen:"}),e.jsx("div",{className:"text-label-primary font-medium",children:d(s.first_seen_at)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"Appliance:"}),e.jsx("div",{className:"text-label-primary font-medium",children:s.appliance_hostname})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"Scan Policy:"}),e.jsx("div",{className:"text-label-primary font-medium",children:s.scan_policy})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-label-tertiary",children:"Last Scan:"}),e.jsx("div",{className:"text-label-primary font-medium",children:d(s.last_scan_at)})]}),s.open_ports&&s.open_ports.length>0&&e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-label-tertiary",children:"Open Ports:"}),e.jsx("div",{className:"text-label-primary font-mono text-xs mt-1",children:s.open_ports.join(", ")})]})]}),s.medical_device&&e.jsx("div",{className:"mt-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-lg",children:"ðŸ¥"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("div",{className:"font-medium text-red-400",children:"Medical Device"}),e.jsxs("div",{className:"text-label-secondary mt-1",children:["This device is classified as medical equipment.",s.manually_opted_in?" Monitoring enabled via manual opt-in.":" Excluded from compliance scanning to prevent interference with patient care."]})]})]})})]})})]})},w=({devices:s,filter:t,onFilterChange:n})=>{const[l,r]=p.useState(null);return e.jsxs(i,{className:"overflow-hidden",children:[e.jsxs("div",{className:"flex flex-wrap gap-4 p-4 border-b border-glass-border items-center",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-label-tertiary",children:"Type:"}),e.jsxs("select",{value:t.type||"",onChange:a=>n({...t,type:a.target.value||void 0}),className:"px-2 py-1 rounded bg-glass-bg border border-glass-border text-sm text-label-primary",children:[e.jsx("option",{value:"",children:"All Types"}),e.jsx("option",{value:"workstation",children:"Workstation"}),e.jsx("option",{value:"server",children:"Server"}),e.jsx("option",{value:"network",children:"Network"}),e.jsx("option",{value:"printer",children:"Printer"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-label-tertiary",children:"Status:"}),e.jsxs("select",{value:t.status||"",onChange:a=>n({...t,status:a.target.value||void 0}),className:"px-2 py-1 rounded bg-glass-bg border border-glass-border text-sm text-label-primary",children:[e.jsx("option",{value:"",children:"All Status"}),e.jsx("option",{value:"compliant",children:"Compliant"}),e.jsx("option",{value:"drifted",children:"Drifted"}),e.jsx("option",{value:"unknown",children:"Unknown"})]})]}),e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:t.includeMedical,onChange:a=>n({...t,includeMedical:a.target.checked}),className:"rounded border-glass-border"}),e.jsx("span",{className:"text-sm text-label-secondary",children:"Include Medical Devices"})]}),e.jsx("div",{className:"flex-1"}),e.jsxs("span",{className:"text-sm text-label-tertiary",children:[s.length," device",s.length!==1?"s":""]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-glass-border",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Device"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"IP Address"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"MAC Address"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"OS"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Last Seen"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-label-secondary"})]})}),e.jsx("tbody",{children:s.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-label-tertiary",children:"No devices discovered yet. Devices will appear after the network scanner runs."})}):s.map(a=>e.jsx(f,{device:a,expanded:l===a.id,onToggle:()=>r(l===a.id?null:a.id)},a.id))})]})})]})},S=()=>{const{siteId:s}=y(),[t,n]=p.useState({includeMedical:!1}),{data:l,isLoading:r,error:a}=N(s||null,{device_type:t.type,compliance_status:t.status,include_medical:t.includeMedical}),{data:c,isLoading:b}=v(s||null);if(r||b)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(u,{size:"lg"})});if(a)return e.jsx(i,{className:"p-6",children:e.jsxs("div",{className:"text-center text-health-critical",children:[e.jsx("p",{children:"Failed to load devices"}),e.jsx("p",{className:"text-sm text-label-secondary mt-2",children:a.message})]})});const o=(l==null?void 0:l.devices)||[];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(x,{to:"/sites",className:"text-label-secondary hover:text-label-primary",children:"Sites"}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx(x,{to:`/sites/${s}`,className:"text-label-secondary hover:text-label-primary",children:s}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx("span",{className:"text-label-primary",children:"Devices"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-label-primary",children:"Device Inventory"}),e.jsx("p",{className:"text-label-secondary mt-1",children:"Network-discovered devices from the appliance scanner"})]}),e.jsxs(j,{variant:"info",className:"px-3 py-1",children:[o.length," Devices"]})]}),e.jsx(i,{className:"p-4 bg-accent-primary/5 border-accent-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-accent-primary mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-label-primary",children:"Network Scanner (EYES)"}),e.jsx("p",{className:"text-sm text-label-secondary mt-1",children:"Devices are discovered via AD enumeration, ARP scanning, and nmap probing. The scanner runs daily at 2 AM. Medical devices are excluded from compliance scanning by default for patient safety."})]})]})}),c&&e.jsx(g,{summary:c}),e.jsx(w,{devices:o,siteId:s||"",filter:t,onFilterChange:n})]})};export{S as SiteDevices,S as default};
