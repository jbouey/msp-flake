import{j as e,r as p,Z as b,m as j,s as y}from"./index-Dfzg2dGd.js";const u=({label:t,value:r,unit:i,status:a,description:s})=>{const c={pass:"text-green-600",warn:"text-orange-500",fail:"text-red-600"},g={pass:"bg-green-50 border-green-200",warn:"bg-orange-50 border-orange-200",fail:"bg-red-50 border-red-200"},m={pass:"On target",warn:"Review suggested",fail:"Attention recommended"};return e.jsxs("div",{className:`rounded-xl border p-6 ${g[a]}`,children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:`text-4xl font-bold ${c[a]}`,children:[typeof r=="number"?r.toFixed(r%1===0?0:1):r,i]}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${a==="pass"?"bg-green-100 text-green-700":a==="warn"?"bg-orange-100 text-orange-700":"bg-red-100 text-red-700"}`,children:m[a]})]}),e.jsx("div",{className:"text-gray-800 font-medium mt-2",children:t}),s&&e.jsx("div",{className:"text-gray-500 text-xs mt-1",children:s})]})},f=({control:t})=>{const[r,i]=p.useState(!1),a={pass:{border:"border-green-400",bg:"bg-green-50",icon:"‚úì",iconColor:"text-green-600",label:"EXPECTED",labelBg:"bg-green-100 text-green-800"},warn:{border:"border-orange-400",bg:"bg-orange-50",icon:"‚ö†",iconColor:"text-orange-600",label:"REVIEW",labelBg:"bg-orange-100 text-orange-800"},fail:{border:"border-red-400",bg:"bg-red-50",icon:"‚úó",iconColor:"text-red-600",label:"DRIFT DETECTED",labelBg:"bg-red-100 text-red-800"}},s=a[t.status]||a.pass,c=t.plain_english||t.name;return e.jsxs("div",{className:`border-2 rounded-xl p-4 ${s.border} ${s.bg} cursor-pointer transition-all hover:shadow-md`,onClick:()=>i(!r),children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex-1 pr-2",children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-sm leading-tight",children:c}),t.plain_english&&e.jsx("p",{className:"text-xs text-gray-500 mt-0.5",children:t.name})]}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${s.labelBg}`,children:s.label})]}),t.status!=="pass"&&t.consequence&&e.jsx("div",{className:"mt-2 p-2 bg-white/60 rounded-lg",children:e.jsxs("p",{className:"text-xs text-gray-700",children:[e.jsx("span",{className:"font-medium text-red-700",children:"Risk: "}),t.consequence]})}),r&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-200/50 space-y-2",children:[t.why_it_matters&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"Why it matters: "}),e.jsx("span",{className:"text-gray-600",children:t.why_it_matters})]}),t.what_we_check&&e.jsxs("div",{className:"text-xs",children:[e.jsx("span",{className:"font-medium text-gray-700",children:"What we check: "}),e.jsx("span",{className:"text-gray-600",children:t.what_we_check})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2",children:[e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-blue-50 text-blue-700 border border-blue-200",children:t.hipaa_section||t.hipaa_controls.join(", ")}),e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded text-xs ${t.severity==="critical"?"bg-red-50 text-red-700 border border-red-200":t.severity==="high"?"bg-orange-50 text-orange-700 border border-orange-200":t.severity==="medium"?"bg-yellow-50 text-yellow-700 border border-yellow-200":"bg-gray-50 text-gray-700 border border-gray-200"}`,children:[t.severity.toUpperCase()," priority"]})]}),e.jsxs("div",{className:"text-xs text-gray-400 mt-2",children:["HIPAA: ",t.hipaa_controls.join(", ")]})]}),t.auto_fix_triggered&&e.jsxs("div",{className:"mt-3 text-xs text-green-700 bg-green-100 rounded-lg px-2 py-1.5 flex items-center gap-1",children:[e.jsx("span",{children:"‚úì"}),e.jsxs("span",{children:["Remediation attempted (",t.fix_duration_sec??0,"s)"]})]}),t.exception_applied&&e.jsxs("div",{className:"mt-2 text-xs text-orange-700 bg-orange-100 rounded-lg px-2 py-1.5 flex items-center gap-1",children:[e.jsx("span",{children:"‚ö†"}),e.jsxs("span",{children:["Exception: ",t.exception_reason||"Active"]})]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center text-xs text-gray-400",children:[e.jsx("span",{children:t.checked_at?`Checked ${new Date(t.checked_at).toLocaleString()}`:"Pending check"}),e.jsx("span",{className:"text-gray-300",children:r?"‚ñ≤ less":"‚ñº more"})]})]})},N=({controls:t})=>{const r={critical:0,high:1,medium:2,low:3},i=[...t].sort((a,s)=>{const c=r[a.severity]??4,g=r[s.severity]??4;if(c!==g)return c-g;const m={fail:0,warn:1,pass:2};return(m[a.status]??3)-(m[s.status]??3)});return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4",children:i.map(a=>e.jsx(f,{control:a},a.rule_id))})},v=({incidents:t})=>{const r={critical:"bg-red-100 text-red-800",high:"bg-orange-100 text-orange-800",medium:"bg-yellow-100 text-yellow-800",low:"bg-blue-100 text-blue-800"},i=s=>s.replace(/_/g," ").replace(/\b\w/g,c=>c.toUpperCase()),a=s=>s?s<60?`${s}s`:s<3600?`${Math.floor(s/60)}m`:`${Math.floor(s/3600)}h ${Math.floor(s%3600/60)}m`:"-";return t.length===0?e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"‚úì"}),e.jsx("p",{className:"text-gray-600",children:"No recent incidents"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Your systems are running smoothly"})]}):e.jsx("div",{className:"bg-white rounded-xl border border-gray-200 divide-y divide-gray-100",children:t.map(s=>e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{className:`px-2 py-0.5 text-xs font-medium rounded ${r[s.severity]||r.medium}`,children:s.severity.toUpperCase()}),e.jsx("span",{className:"text-sm font-medium text-gray-900 truncate",children:i(s.incident_type)})]}),e.jsx("p",{className:"text-xs text-gray-500",children:new Date(s.created_at).toLocaleString()})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1",children:[s.auto_fixed?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-green-700 bg-green-100 px-2 py-1 rounded-full",children:[e.jsx("span",{children:"‚úì"}),e.jsx("span",{children:"Auto-fixed"})]}):s.resolved_at?e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-blue-700 bg-blue-100 px-2 py-1 rounded-full",children:[e.jsx("span",{children:"‚úì"}),e.jsx("span",{children:"Resolved"})]}):e.jsxs("span",{className:"inline-flex items-center gap-1 text-xs text-orange-700 bg-orange-100 px-2 py-1 rounded-full",children:[e.jsx("span",{children:"‚è≥"}),e.jsx("span",{children:"In Progress"})]}),s.resolution_time_sec&&e.jsx("span",{className:"text-xs text-gray-400",children:a(s.resolution_time_sec)})]})]})},s.incident_id))})},w=({bundles:t,siteId:r,token:i})=>{const[a,s]=p.useState(null),c=n=>{if(n===0)return"0 B";const d=1024,o=["B","KB","MB","GB"],x=Math.floor(Math.log(n)/Math.log(d));return`${parseFloat((n/Math.pow(d,x)).toFixed(1))} ${o[x]}`},g=n=>({icon:{daily:"üìÑ",weekly:"üìä",monthly:"üìë"}[n]||"üìÅ",label:n.charAt(0).toUpperCase()+n.slice(1)}),m=async n=>{s(n);try{const o=await(await fetch(`/api/portal/site/${r}/evidence/${n}/download?token=${i}`)).json();o.download_url&&window.open(o.download_url,"_blank")}catch(d){console.error("Download failed:",d)}finally{s(null)}};if(t.length===0)return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-8 text-center",children:[e.jsx("div",{className:"text-4xl mb-3",children:"üìÅ"}),e.jsx("p",{className:"text-gray-600",children:"No evidence bundles yet"}),e.jsx("p",{className:"text-sm text-gray-400 mt-1",children:"Bundles will appear after first compliance check"})]});const h=t.reduce((n,d)=>{const o=d.bundle_type;return n[o]||(n[o]=[]),n[o].push(d),n},{});return e.jsxs("div",{className:"space-y-4",children:[Object.entries(h).map(([n,d])=>{const{icon:o,label:x}=g(n);return e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200",children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:o}),e.jsxs("span",{className:"font-medium text-gray-900",children:[x," Reports"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["(",d.length,")"]})]}),e.jsx("div",{className:"divide-y divide-gray-100",children:d.slice(0,5).map(l=>e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between hover:bg-gray-50",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-900",children:l.bundle_id}),e.jsxs("p",{className:"text-xs text-gray-500",children:[new Date(l.generated_at).toLocaleDateString()," ‚Ä¢ ",c(l.size_bytes)]})]}),e.jsx("button",{onClick:()=>m(l.bundle_id),disabled:a===l.bundle_id,className:"px-3 py-1.5 text-sm font-medium text-blue-600 hover:text-blue-700 hover:bg-blue-50 rounded-lg disabled:opacity-50 disabled:cursor-wait",children:a===l.bundle_id?"Loading...":"Download"})]},l.bundle_id))})]},n)}),e.jsx("div",{className:"bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl border border-blue-200 p-4",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900",children:"Monthly Compliance Packet"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"PDF report with full compliance summary, incident log, and evidence index"})]}),e.jsx("a",{href:`/api/portal/site/${r}/report/monthly?token=${i}`,target:"_blank",rel:"noopener noreferrer",className:"px-4 py-2 bg-blue-600 text-white text-sm font-medium rounded-lg hover:bg-blue-700 whitespace-nowrap",children:"Download PDF"})]})})]})},_=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50 animate-pulse",children:[e.jsx("div",{className:"bg-white border-b px-6 py-4",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("div",{className:"h-8 w-64 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-4 w-48 bg-gray-200 rounded"})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[1,2,3,4].map(t=>e.jsx("div",{className:"h-24 bg-gray-200 rounded-xl"},t))}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[1,2,3,4,5,6,7,8].map(t=>e.jsx("div",{className:"h-48 bg-gray-200 rounded-xl"},t))})]})]}),k=({message:t})=>e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("span",{className:"text-3xl",children:"üîí"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600 mb-6",children:t}),e.jsx("p",{className:"text-sm text-gray-400",children:"If you believe this is an error, please contact your administrator."})]})}),$=()=>{const[t]=b(),r=j(),{siteId:i}=y(),a=t.get("token"),[s,c]=p.useState(null),[g,m]=p.useState(!0),[h,n]=p.useState(null);p.useEffect(()=>{if(!i){n("Invalid portal URL."),m(!1);return}const x=a?`/api/portal/site/${i}?token=${a}`:`/api/portal/site/${i}`;fetch(x,{credentials:"include"}).then(l=>{if(l.status===403)throw r(`/portal/site/${i}/login`,{replace:!0}),new Error("redirect");if(!l.ok)throw new Error("Failed to load dashboard. Please try again.");return l.json()}).then(c).catch(l=>{l.message!=="redirect"&&n(l.message)}).finally(()=>m(!1))},[i,a,r]);const d=async()=>{try{await fetch("/api/portal/auth/logout",{method:"POST",credentials:"include"})}catch{}r(`/portal/site/${i}/login`,{replace:!0})};if(g)return e.jsx(_,{});if(h)return e.jsx(k,{message:h});if(!s)return null;const o=(x,l)=>x>=l.pass?"pass":x>=l.warn?"warn":"fail";return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-white border-b shadow-sm",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-6 py-4 flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:s.site.name}),e.jsxs("p",{className:"text-sm text-gray-500",children:["HIPAA Monitoring Dashboard ‚Ä¢ Last updated:"," ",s.site.last_checkin?new Date(s.site.last_checkin).toLocaleString():"Never"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:`px-3 py-1.5 rounded-full text-sm font-medium ${s.site.status==="online"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:s.site.status==="online"?"‚óè Online":"‚óè Offline"}),e.jsx("button",{onClick:d,className:"px-3 py-1.5 text-sm text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition",children:"Log out"})]})]})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-6 py-8",children:[e.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsx(u,{label:"Control Coverage",value:s.kpis.compliance_pct??0,unit:"%",status:o(s.kpis.compliance_pct??0,{pass:95,warn:80}),description:"Percentage of monitored controls in expected state"}),e.jsx(u,{label:"Security Update Speed",value:s.kpis.patch_mttr_hours??0,unit:" hrs",status:(s.kpis.patch_mttr_hours??0)<24?"pass":(s.kpis.patch_mttr_hours??0)<72?"warn":"fail",description:"Average time to apply critical security patches"}),e.jsx(u,{label:"Two-Factor Auth",value:s.kpis.mfa_coverage_pct??0,unit:"%",status:(s.kpis.mfa_coverage_pct??0)===100?"pass":"warn",description:"Accounts with MFA enabled"}),e.jsx(u,{label:"Remediation Actions",value:s.kpis.auto_fixes_24h??0,unit:"",status:"pass",description:"Automated remediation actions attempted in last 24h"})]}),e.jsx("section",{className:"mb-6",children:e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200 p-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-green-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("strong",{className:"text-gray-900",children:s.kpis.controls_passing??0})," Passing"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-orange-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("strong",{className:"text-gray-900",children:s.kpis.controls_warning??0})," Warning"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"w-3 h-3 rounded-full bg-red-500"}),e.jsxs("span",{className:"text-sm text-gray-600",children:[e.jsx("strong",{className:"text-gray-900",children:s.kpis.controls_failing??0})," Failing"]})]})]}),e.jsx("span",{className:"text-sm text-gray-400",children:"8 Core HIPAA Controls"})]})}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Control Status"}),e.jsx(N,{controls:s.controls})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Recent Activity"}),e.jsx(v,{incidents:s.incidents})]}),e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Evidence & Reports"}),e.jsxs("button",{onClick:()=>{const x=a?`/portal/site/${i}/verify?token=${a}`:`/portal/site/${i}/verify`;r(x)},className:"text-sm text-blue-600 hover:text-blue-800 hover:underline flex items-center gap-1",children:[e.jsx("span",{children:"Verify Chain"}),e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})})]})]}),e.jsx(w,{bundles:s.evidence_bundles,siteId:i,token:a})]})]}),e.jsxs("footer",{className:"mt-12 pt-8 border-t border-gray-200 text-center",children:[e.jsx("p",{className:"text-sm text-gray-500 max-w-2xl mx-auto",children:"This report contains system metadata only. No Protected Health Information (PHI) is processed, stored, or transmitted by the monitoring system."}),e.jsx("div",{className:"mt-4 p-4 bg-gray-100 rounded-lg max-w-2xl mx-auto",children:e.jsxs("p",{className:"text-xs text-gray-500 leading-relaxed",children:[e.jsx("strong",{children:"Important:"})," This system monitors configuration states and reports observations. OsirisCare does not certify HIPAA compliance. Compliance determinations require qualified assessment by authorized personnel. Contact your compliance officer for official guidance. All metrics represent point-in-time observations, not guarantees of security or compliance status."]})}),e.jsxs("p",{className:"mt-4 text-sm text-gray-400",children:["Questions?"," ",e.jsx("a",{href:"mailto:support@osiriscare.net",className:"text-blue-600 hover:underline",children:"support@osiriscare.net"})]}),e.jsxs("div",{className:"mt-4 flex items-center justify-center gap-2",children:[e.jsx("span",{className:"text-xs text-gray-300",children:"Powered by"}),e.jsx("span",{className:"text-sm font-semibold text-gray-500",children:"OsirisCare"})]})]})]})]})};export{$ as PortalDashboard,$ as default};
