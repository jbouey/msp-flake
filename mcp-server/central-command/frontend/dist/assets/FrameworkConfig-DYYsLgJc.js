import{s as O,r as n,j as e,K as L,a8 as D,a9 as f}from"./index-Dfzg2dGd.js";import{F as $,e as I}from"./index-CJjopUK2.js";const M=["hipaa","soc2","pci_dss","nist_csf","cis"],v=[{value:"healthcare",label:"Healthcare",primary:"hipaa"},{value:"technology",label:"Technology / SaaS",primary:"soc2"},{value:"retail",label:"Retail / E-commerce",primary:"pci_dss"},{value:"finance",label:"Financial Services",primary:"soc2"},{value:"government",label:"Government",primary:"nist_csf"},{value:"general",label:"General / Other",primary:"nist_csf"}];function P({framework:i,enabled:c,isPrimary:m,score:t,metadata:o,onToggle:s,onSetPrimary:d}){const g=$[i];return e.jsxs("div",{className:`bg-gray-800 rounded-lg p-4 border-2 transition-all ${c?`border-${g}-500`:"border-gray-700"} ${m?"ring-2 ring-yellow-500":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[I[i],m&&e.jsx("span",{className:"text-xs bg-yellow-500 text-black px-2 py-0.5 rounded",children:"Primary"})]}),o&&e.jsx("p",{className:"text-sm text-gray-400",children:o.version})]}),e.jsxs("label",{className:"relative inline-flex items-center cursor-pointer",children:[e.jsx("input",{type:"checkbox",className:"sr-only peer",checked:c,onChange:s}),e.jsx("div",{className:"w-11 h-6 bg-gray-600 peer-focus:ring-2 peer-focus:ring-blue-500 rounded-full peer peer-checked:after:translate-x-full after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600"})]})]}),o&&e.jsx("p",{className:"text-sm text-gray-400 mb-3",children:o.description}),t&&c&&e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm text-gray-400",children:"Compliance Score"}),e.jsxs("span",{className:`text-lg font-bold ${t.is_compliant?"text-green-400":t.at_risk?"text-red-400":"text-yellow-400"}`,children:[t.score_percentage.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${t.is_compliant?"bg-green-500":t.at_risk?"bg-red-500":"bg-yellow-500"}`,style:{width:`${t.score_percentage}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mt-1",children:[e.jsxs("span",{children:[t.passing_controls," passing"]}),e.jsxs("span",{children:[t.failing_controls," failing"]}),e.jsxs("span",{children:[t.unknown_controls," unknown"]})]})]}),c&&!m&&e.jsx("button",{onClick:d,className:"text-sm text-blue-400 hover:text-blue-300",children:"Set as primary"})]})}function W(){const{siteId:i}=O(),[c,m]=n.useState([]),[t,o]=n.useState(null),[s,d]=n.useState(null),[g,k]=n.useState([]),[x,N]=n.useState(null),[S,h]=n.useState(!0),[b,y]=n.useState(!1),[w,p]=n.useState(null),[j,_]=n.useState(null);n.useEffect(()=>{async function a(){if(i)try{h(!0);const[r,l]=await Promise.all([D.getAppliances(i),f.getMetadata()]);m(r.appliances),N(l.frameworks||l),r.appliances.length>0&&o(r.appliances[0].appliance_id)}catch(r){p(r instanceof Error?r.message:"Failed to load data")}finally{h(!1)}}a()},[i]),n.useEffect(()=>{async function a(){if(t)try{const[r,l]=await Promise.all([f.getConfig(t).catch(()=>null),f.getScores(t).catch(()=>[])]);d(r||{appliance_id:t,site_id:i||"",enabled_frameworks:["hipaa"],primary_framework:"hipaa",industry:"healthcare",framework_metadata:{},created_at:new Date().toISOString(),updated_at:new Date().toISOString()});const u=Array.isArray(l)?l:(l==null?void 0:l.scores)||[];k(u)}catch(r){console.error("Failed to load appliance config:",r)}}a()},[t,i]);const C=a=>{if(!s)return;const r=s.enabled_frameworks.includes(a);let l;if(r){if(a===s.primary_framework){p("Cannot disable the primary framework. Set a different primary first.");return}l=s.enabled_frameworks.filter(u=>u!==a)}else l=[...s.enabled_frameworks,a];d({...s,enabled_frameworks:l}),p(null)},A=a=>{if(!s)return;const r=s.enabled_frameworks.includes(a)?s.enabled_frameworks:[...s.enabled_frameworks,a];d({...s,enabled_frameworks:r,primary_framework:a})},E=a=>{if(!s)return;const r=v.find(R=>R.value===a),l=(r==null?void 0:r.primary)||"nist_csf",u=s.enabled_frameworks.includes(l)?s.enabled_frameworks:[...s.enabled_frameworks,l];d({...s,industry:a,enabled_frameworks:u,primary_framework:l})},F=async()=>{if(!(!s||!t))try{y(!0),p(null),await f.updateConfig(t,{enabled_frameworks:s.enabled_frameworks,primary_framework:s.primary_framework,industry:s.industry,framework_metadata:s.framework_metadata}),_("Framework configuration saved successfully"),setTimeout(()=>_(null),3e3)}catch(a){p(a instanceof Error?a.message:"Failed to save configuration")}finally{y(!1)}};return S?e.jsx("div",{className:"min-h-screen bg-gray-900 p-6 flex items-center justify-center",children:e.jsx("div",{className:"text-gray-400",children:"Loading..."})}):e.jsx("div",{className:"min-h-screen bg-gray-900 p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx(L,{to:`/sites/${i}`,className:"text-blue-400 hover:text-blue-300 text-sm mb-2 inline-block",children:"Back to Site"}),e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Multi-Framework Compliance Configuration"}),e.jsx("p",{className:"text-gray-400 mt-1",children:"Configure which compliance frameworks this appliance reports against. One check can satisfy controls across multiple frameworks."})]}),w&&e.jsx("div",{className:"bg-red-900/50 border border-red-500 text-red-200 px-4 py-3 rounded mb-4",children:w}),j&&e.jsx("div",{className:"bg-green-900/50 border border-green-500 text-green-200 px-4 py-3 rounded mb-4",children:j}),c.length>1&&e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Select Appliance"}),e.jsx("select",{value:t||"",onChange:a=>o(a.target.value),className:"bg-gray-800 border border-gray-600 text-white rounded-lg px-4 py-2 w-full max-w-md",children:c.map(a=>e.jsx("option",{value:a.appliance_id,children:a.hostname||a.appliance_id},a.appliance_id))})]}),s&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-400 mb-2",children:"Industry"}),e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:"Select your industry to get recommended frameworks and set the primary framework."}),e.jsx("select",{value:s.industry,onChange:a=>E(a.target.value),className:"bg-gray-700 border border-gray-600 text-white rounded-lg px-4 py-2 w-full max-w-md",children:v.map(a=>e.jsx("option",{value:a.value,children:a.label},a.value))})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 mb-6",children:M.map(a=>e.jsx(P,{framework:a,enabled:s.enabled_frameworks.includes(a),isPrimary:s.primary_framework===a,score:g.find(r=>r.framework===a),metadata:x==null?void 0:x[a],onToggle:()=>C(a),onSetPrimary:()=>A(a)},a))}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:F,disabled:b,className:"bg-blue-600 hover:bg-blue-700 disabled:bg-blue-800 disabled:cursor-not-allowed text-white font-medium px-6 py-2 rounded-lg transition-colors",children:b?"Saving...":"Save Configuration"})})]}),c.length===0&&e.jsx("div",{className:"text-center text-gray-400 py-12",children:"No appliances found for this site. Deploy an appliance first to configure frameworks."})]})})}export{W as default};
