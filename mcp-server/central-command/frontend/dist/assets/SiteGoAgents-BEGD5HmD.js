import{s as C,Q as A,j as e,S as G,G as h,K as N,B as L,r as b,T,U as R,V as M}from"./index-CMHeoQ51.js";import{G as j,b as S,c as E,d as P}from"./index-CJjopUK2.js";function v(t){if(!t)return"Never";const i=new Date(t),l=new Date().getTime()-i.getTime(),r=Math.floor(l/6e4);if(r<1)return"Just now";if(r<60)return`${r} min ago`;const c=Math.floor(r/60);return c<24?`${c}h ago`:`${Math.floor(c/24)}d ago`}const _={active:"bg-health-healthy text-white",offline:"bg-gray-500 text-white",error:"bg-health-critical text-white",pending:"bg-yellow-500 text-white"},g={monitor_only:"bg-blue-500/20 text-blue-400 border border-blue-500/30",self_heal:"bg-purple-500/20 text-purple-400 border border-purple-500/30",full_remediation:"bg-health-healthy/20 text-health-healthy border border-health-healthy/30"},$=({summary:t})=>{const i=t.overall_compliance_rate||0,n=i>=80?"text-health-healthy":i>=50?"text-health-warning":"text-health-critical";return e.jsxs(h,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-label-primary mb-4",children:"Go Agent Fleet Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${n}`,children:[i.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Compliance"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-label-primary",children:t.total_agents}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Total"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-health-healthy",children:t.active_agents}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Active"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-gray-400",children:t.offline_agents}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Offline"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-health-critical",children:t.error_agents}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Error"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-yellow-400",children:t.pending_agents}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Pending"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-orange-400",children:t.rmm_detected_count}),e.jsx("div",{className:"text-sm text-label-secondary",children:"RMM Found"})]})]}),t.agents_by_tier&&Object.keys(t.agents_by_tier).length>0&&e.jsxs("div",{className:"mt-6 pt-4 border-t border-glass-border",children:[e.jsx("h3",{className:"text-sm font-medium text-label-secondary mb-3",children:"Agents by Capability Tier"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["monitor_only","self_heal","full_remediation"].map(l=>e.jsxs("div",{className:`rounded-lg p-3 text-center ${g[l]}`,children:[e.jsx("div",{className:"text-sm font-medium",children:j[l]}),e.jsx("div",{className:"text-2xl font-bold",children:t.agents_by_tier[l]||0})]},l))})]}),t.agents_by_version&&Object.keys(t.agents_by_version).length>0&&e.jsxs("div",{className:"mt-4 pt-4 border-t border-glass-border",children:[e.jsx("h3",{className:"text-sm font-medium text-label-secondary mb-3",children:"Agent Versions"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.entries(t.agents_by_version).map(([l,r])=>e.jsxs("span",{className:"px-2 py-1 bg-glass-bg/50 rounded text-sm text-label-secondary",children:["v",l,": ",e.jsx("span",{className:"font-medium text-label-primary",children:r})]},l))})]})]})},z=({agent:t,siteId:i,expanded:n,onToggle:l})=>{const r=_[t.status]||_.pending,c=S[t.status]||"Unknown",o=g[t.capability_tier]||g.monitor_only,s=j[t.capability_tier]||"Unknown",d=T(),m=R(),p=M(),[y,u]=b.useState(!1),w=a=>{d.mutate({siteId:i,agentId:t.id,tier:a}),u(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-glass-bg/30 cursor-pointer transition-colors",onClick:l,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:`w-2 h-2 rounded-full ${t.status==="active"?"bg-health-healthy":"bg-gray-500"}`}),e.jsx("span",{className:"font-medium text-label-primary",children:t.hostname})]})}),e.jsx("td",{className:"px-4 py-3 text-label-secondary",children:t.ip_address||"-"}),e.jsxs("td",{className:"px-4 py-3 text-label-secondary text-sm",children:["v",t.agent_version||"?"]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${r}`,children:c})}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),u(!y)},className:`px-2 py-1 rounded text-xs font-medium ${o}`,children:s}),y&&e.jsx("div",{className:"absolute z-50 mt-1 bg-glass-bg border border-glass-border rounded-lg shadow-lg py-1 w-40",children:["monitor_only","self_heal","full_remediation"].map(a=>e.jsx("button",{onClick:x=>{x.stopPropagation(),w(a)},className:`w-full px-3 py-2 text-left text-sm hover:bg-glass-bg/50 ${t.capability_tier===a?"text-accent-primary":"text-label-secondary"}`,children:j[a]},a))})]})}),e.jsx("td",{className:"px-4 py-3 text-label-secondary text-sm",children:v(t.last_heartbeat)}),e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx("span",{className:"text-health-healthy",children:t.checks_passed}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx("span",{className:"text-label-secondary",children:t.checks_total})]})}),e.jsx("td",{className:"px-4 py-3 text-right",children:e.jsx("svg",{className:`w-5 h-5 text-label-tertiary transition-transform ${n?"rotate-180":""}`,fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),n&&e.jsx("tr",{children:e.jsxs("td",{colSpan:8,className:"px-4 py-3 bg-glass-bg/20",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4 text-sm",children:[t.rmm_detected&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-label-tertiary",children:"RMM Detected:"}),e.jsxs("span",{className:`font-medium ${t.rmm_disabled?"text-health-healthy":"text-orange-400"}`,children:[t.rmm_detected," ",t.rmm_disabled?"(Disabled)":"(Active)"]})]}),t.offline_queue_size>0&&e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-label-tertiary",children:"Queued Events:"}),e.jsx("span",{className:"font-medium text-yellow-400",children:t.offline_queue_size})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-label-tertiary",children:"Connected:"}),e.jsx("span",{className:"text-label-secondary",children:v(t.connected_at)})]})]}),t.checks&&t.checks.length>0&&e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3 mb-4",children:t.checks.map(a=>{const x=a.status==="pass",k=a.status==="error",f=a.status==="skipped";return e.jsxs("div",{className:`p-3 rounded-lg border ${x?"border-health-healthy/30 bg-health-healthy/10":k?"border-health-critical/30 bg-health-critical/10":f?"border-gray-500/30 bg-gray-500/10":"border-health-warning/30 bg-health-warning/10"}`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsx("span",{className:"text-sm font-medium text-label-primary",children:E[a.check_type]||a.check_type}),x?e.jsx("svg",{className:"w-4 h-4 text-health-healthy",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z",clipRule:"evenodd"})}):f?e.jsx("svg",{className:"w-4 h-4 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z",clipRule:"evenodd"})}):e.jsx("svg",{className:"w-4 h-4 text-health-critical",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z",clipRule:"evenodd"})})]}),e.jsx("div",{className:"text-xs text-label-tertiary",children:P[a.check_type]||"N/A"}),a.message&&e.jsx("div",{className:"text-xs text-label-secondary mt-1 truncate",title:a.message,children:a.message})]},a.check_type)})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:a=>{a.stopPropagation(),m.mutate({siteId:i,agentId:t.id})},disabled:m.isPending,className:"px-3 py-1.5 bg-accent-primary/10 text-accent-primary hover:bg-accent-primary/20 rounded text-sm font-medium transition-colors disabled:opacity-50",children:m.isPending?"Running...":"Run Check"}),e.jsx("button",{onClick:a=>{a.stopPropagation(),confirm(`Remove agent ${t.hostname} from registry?`)&&p.mutate({siteId:i,agentId:t.id})},disabled:p.isPending,className:"px-3 py-1.5 bg-health-critical/10 text-health-critical hover:bg-health-critical/20 rounded text-sm font-medium transition-colors disabled:opacity-50",children:p.isPending?"Removing...":"Remove"})]})]})})]})},B=({agents:t,siteId:i})=>{const[n,l]=b.useState(null),[r,c]=b.useState("all"),o=t.filter(s=>{switch(r){case"active":return s.status==="active";case"healthy":return s.checks_passed===s.checks_total&&s.checks_total>0;case"drifted":return s.checks_passed<s.checks_total;default:return!0}});return e.jsxs(h,{className:"overflow-hidden",children:[e.jsx("div",{className:"flex gap-2 p-4 border-b border-glass-border",children:["all","active","healthy","drifted"].map(s=>e.jsxs("button",{onClick:()=>c(s),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${r===s?"bg-accent-primary text-white":"text-label-secondary hover:bg-glass-bg/50"}`,children:[s.charAt(0).toUpperCase()+s.slice(1),e.jsxs("span",{className:"ml-1 text-xs opacity-70",children:["(",s==="all"?t.length:s==="active"?t.filter(d=>d.status==="active").length:s==="healthy"?t.filter(d=>d.checks_passed===d.checks_total&&d.checks_total>0).length:t.filter(d=>d.checks_passed<d.checks_total).length,")"]})]},s))}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-glass-border",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Hostname"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"IP Address"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Version"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Tier"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Last Heartbeat"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Checks"}),e.jsx("th",{className:"px-4 py-3 text-right text-sm font-medium text-label-secondary"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:8,className:"px-4 py-8 text-center text-label-tertiary",children:"No Go agents connected"})}):o.map(s=>e.jsx(z,{agent:s,siteId:i,expanded:n===s.id,onToggle:()=>l(n===s.id?null:s.id)},s.id))})]})})]})},D=()=>{const{siteId:t}=C(),{data:i,isLoading:n,error:l}=A(t||"");if(n)return e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(G,{size:"lg"})});if(l)return e.jsx(h,{className:"p-6",children:e.jsxs("div",{className:"text-center text-health-critical",children:[e.jsx("p",{children:"Failed to load Go agents"}),e.jsx("p",{className:"text-sm text-label-secondary mt-2",children:l.message})]})});const{summary:r,agents:c}=i||{summary:null,agents:[]};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(N,{to:"/sites",className:"text-label-secondary hover:text-label-primary",children:"Sites"}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx(N,{to:`/sites/${t}`,className:"text-label-secondary hover:text-label-primary",children:t}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx("span",{className:"text-label-primary",children:"Go Agents"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-label-primary",children:"Go Agents"}),e.jsx("p",{className:"text-label-secondary mt-1",children:"Lightweight workstation agents pushing drift events via gRPC"})]}),e.jsxs(L,{variant:"info",className:"px-3 py-1",children:[c.length," Agents"]})]}),e.jsx(h,{className:"p-4 bg-accent-primary/5 border-accent-primary/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("svg",{className:"w-5 h-5 text-accent-primary mt-0.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-label-primary",children:"Push-Based Architecture"}),e.jsx("p",{className:"text-sm text-label-secondary mt-1",children:"Go agents run on Windows workstations and push compliance events to the appliance via gRPC (port 50051). This replaces WinRM polling for better scalability (25-50+ workstations per site)."})]})]})}),r&&e.jsx($,{summary:r}),e.jsx(B,{agents:c,siteId:t||""})]})};export{D as SiteGoAgents,D as default};
