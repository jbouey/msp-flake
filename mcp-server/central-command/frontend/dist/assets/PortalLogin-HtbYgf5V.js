import{Z as b,m as j,s as v,r as m,j as e}from"./index-Dfzg2dGd.js";const w=()=>{const[u]=b(),x=j(),{siteId:n}=v(),[o,g]=m.useState(""),[r,s]=m.useState({status:"idle"}),c=u.get("magic"),d=u.get("token"),h=t=>t?/^[a-zA-Z0-9_-]{1,100}$/.test(t):!1;m.useEffect(()=>{if(!h(n)){s({status:"error",message:"Invalid site identifier."});return}c&&n?f(c):d&&n&&p(d,n)},[c,d,n]);const p=async(t,i)=>{s({status:"validating",message:"Validating your access..."});try{const a=await fetch("/api/portal/auth/validate-legacy",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:t,site_id:i})});if(a.ok){const l=await a.json();x(`/portal/site/${encodeURIComponent(l.site_id)}/dashboard`,{replace:!0})}else{const l=await a.json();s({status:"error",message:l.detail||"Invalid or expired link. Please request a new one."})}}catch{s({status:"error",message:"Failed to validate access link. Please try again."})}},f=async t=>{s({status:"validating",message:"Validating your access..."});try{const i=await fetch("/api/portal/auth/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({magic_token:t})});if(i.ok){const a=await i.json(),l=encodeURIComponent(a.site_id||"");h(a.site_id)?x(`/portal/site/${l}/dashboard`,{replace:!0}):s({status:"error",message:"Invalid site identifier in response."})}else{const a=await i.json();s({status:"error",message:a.detail||"Invalid or expired link. Please request a new one."})}}catch{s({status:"error",message:"Failed to validate access link. Please try again."})}},y=async t=>{if(t.preventDefault(),!(!o||!n)){s({status:"loading"});try{(await fetch(`/api/portal/sites/${n}/request-access`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:o})})).ok?s({status:"sent",message:"Check your email for the access link."}):s({status:"error",message:"Failed to send access link. Please try again."})}catch{s({status:"error",message:"Network error. Please check your connection."})}}};return r.status==="validating"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-500 border-t-transparent"})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Validating Access"}),e.jsx("p",{className:"text-gray-600",children:r.message})]})}):r.status==="sent"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Check Your Email"}),e.jsx("p",{className:"text-gray-600 mb-6",children:r.message}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Didn't receive it? Check your spam folder or"," ",e.jsx("button",{onClick:()=>s({status:"idle"}),className:"text-blue-600 hover:underline",children:"try again"})]})]})}):r.status==="error"?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full bg-white rounded-2xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx("svg",{className:"w-8 h-8 text-red-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h1",{className:"text-xl font-semibold text-gray-900 mb-2",children:"Access Error"}),e.jsx("p",{className:"text-gray-600 mb-6",children:r.message}),e.jsx("button",{onClick:()=>s({status:"idle"}),className:"px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center p-6",children:e.jsxs("div",{className:"max-w-md w-full",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"OsirisCare"}),e.jsx("p",{className:"text-gray-600 mt-2",children:"HIPAA Monitoring Portal"})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-2 text-center",children:"Access Your Dashboard"}),e.jsx("p",{className:"text-gray-600 text-center mb-6",children:"Enter your email to receive a secure login link."}),e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"email",className:"block text-sm font-medium text-gray-700 mb-1",children:"Email Address"}),e.jsx("input",{type:"email",id:"email",value:o,onChange:t=>g(t.target.value),placeholder:"you@company.com",required:!0,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition"})]}),e.jsx("button",{type:"submit",disabled:r.status==="loading"||!o,className:"w-full py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition",children:r.status==="loading"?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending..."]}):"Send Login Link"})]}),e.jsx("p",{className:"mt-6 text-center text-sm text-gray-400",children:"No password required. We'll send you a secure link."})]}),e.jsxs("p",{className:"mt-8 text-center text-sm text-gray-400",children:["Questions?"," ",e.jsx("a",{href:"mailto:support@osiriscare.net",className:"text-blue-600 hover:underline",children:"Contact Support"})]}),e.jsx("p",{className:"mt-4 text-center text-xs text-gray-300 max-w-sm mx-auto",children:"This portal provides monitoring data only. OsirisCare does not certify compliance."})]})})};export{w as PortalLogin,w as default};
