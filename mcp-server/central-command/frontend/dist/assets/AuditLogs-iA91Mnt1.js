import{w,r as d,j as e,G as r}from"./index-DEFEL2Dr.js";const v=s=>new Date(s).toLocaleString([],{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit",second:"2-digit"}),L=s=>{switch(s){case"LOGIN":case"LOGIN_SUCCESS":return"text-health-healthy bg-green-50";case"LOGOUT":return"text-label-secondary bg-gray-100";case"CREATE":case"UPDATE":return"text-ios-blue bg-blue-50";case"DELETE":case"LOGIN_FAILED":case"LOGIN_BLOCKED":return"text-health-critical bg-red-50";case"EXECUTE":return"text-ios-purple bg-purple-50";case"VIEW":return"text-label-tertiary bg-gray-50";default:return"text-label-secondary bg-gray-100"}},C=()=>{const{auditLogs:s,user:c,refreshAuditLogs:u}=w(),[x,g]=d.useState("all"),[m,b]=d.useState("all"),[o,j]=d.useState("");d.useEffect(()=>{u()},[]);const y=Array.from(new Set(s.map(t=>t.action))),p=Array.from(new Set(s.map(t=>t.user))),h=s.filter(t=>{var a;const l=x==="all"||t.action===x,n=m==="all"||t.user===m,i=o===""||t.target.toLowerCase().includes(o.toLowerCase())||(((a=t.details)==null?void 0:a.toLowerCase().includes(o.toLowerCase()))??!1);return l&&n&&i}),f=s.filter(t=>{const l=new Date(t.timestamp),n=new Date;return l.toDateString()===n.toDateString()}).length,N=s.filter(t=>t.action==="LOGIN").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold",children:"Audit Logs"}),e.jsx("p",{className:"text-label-tertiary mt-1",children:"Track all user actions and system changes for accountability"})]}),(c==null?void 0:c.role)==="admin"&&e.jsxs("button",{onClick:()=>{if(confirm("Export audit logs to CSV?")){const t=[["Timestamp","User","Action","Target","Details"].join(","),...s.map(a=>[a.timestamp,a.user,a.action,`"${a.target}"`,`"${a.details||""}"`].join(","))].join(`
`),l=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(l),i=document.createElement("a");i.href=n,i.download=`audit-logs-${new Date().toISOString().split("T")[0]}.csv`,i.click()}},className:"btn-secondary flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})}),"Export CSV"]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(r,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Total Logs"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:s.length})]}),e.jsxs(r,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Today"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:f})]}),e.jsxs(r,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Login Events"}),e.jsx("p",{className:"text-2xl font-semibold text-health-healthy mt-1",children:N})]}),e.jsxs(r,{padding:"md",children:[e.jsx("p",{className:"text-xs text-label-tertiary uppercase tracking-wide",children:"Unique Users"}),e.jsx("p",{className:"text-2xl font-semibold mt-1",children:p.length})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-4",children:[e.jsxs("div",{className:"relative flex-1 max-w-md",children:[e.jsx("svg",{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-label-tertiary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),e.jsx("input",{type:"text",placeholder:"Search logs...",value:o,onChange:t=>j(t.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/50 border border-separator-light rounded-ios-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-primary focus:border-transparent"})]}),e.jsxs("select",{value:x,onChange:t=>g(t.target.value),className:"px-4 py-2 bg-white/50 border border-separator-light rounded-ios-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[e.jsx("option",{value:"all",children:"All Actions"}),y.map(t=>e.jsx("option",{value:t,children:t},t))]}),e.jsxs("select",{value:m,onChange:t=>b(t.target.value),className:"px-4 py-2 bg-white/50 border border-separator-light rounded-ios-md text-sm focus:outline-none focus:ring-2 focus:ring-accent-primary",children:[e.jsx("option",{value:"all",children:"All Users"}),p.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx(r,{children:h.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("svg",{className:"w-12 h-12 text-label-tertiary mx-auto mb-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:1.5,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),e.jsx("p",{className:"text-label-secondary",children:"No audit logs found"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:s.length===0?"Actions will be logged here as you use the system":"Try adjusting your filters"})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-separator-light",children:[e.jsx("th",{className:"text-left text-xs font-semibold text-label-tertiary uppercase tracking-wide py-3 px-4",children:"Timestamp"}),e.jsx("th",{className:"text-left text-xs font-semibold text-label-tertiary uppercase tracking-wide py-3 px-4",children:"User"}),e.jsx("th",{className:"text-left text-xs font-semibold text-label-tertiary uppercase tracking-wide py-3 px-4",children:"Action"}),e.jsx("th",{className:"text-left text-xs font-semibold text-label-tertiary uppercase tracking-wide py-3 px-4",children:"Target"}),e.jsx("th",{className:"text-left text-xs font-semibold text-label-tertiary uppercase tracking-wide py-3 px-4",children:"Details"})]})}),e.jsx("tbody",{children:h.map(t=>e.jsxs("tr",{className:"border-b border-separator-light last:border-b-0 hover:bg-separator-light/50 transition-colors",children:[e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm text-label-secondary font-mono",children:v(t.timestamp)})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm font-medium text-label-primary",children:t.user})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:`inline-flex px-2 py-1 text-xs font-medium rounded ${L(t.action)}`,children:t.action})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm text-label-primary",children:t.target})}),e.jsx("td",{className:"py-3 px-4",children:e.jsx("span",{className:"text-sm text-label-tertiary",children:t.details||"-"})})]},t.id))})]})})}),e.jsx(r,{padding:"sm",children:e.jsx("p",{className:"text-xs text-label-tertiary text-center",children:"Audit logs are stored server-side for HIPAA compliance. Export to CSV for external records."})})]})};export{C as AuditLogs,C as default};
