import{s as M,r as d,Y as C,j as e,K as u,G as p,B as w,S}from"./index-ByrxzNCH.js";const R=[{value:"connectwise",label:"ConnectWise Automate"},{value:"datto",label:"Datto RMM"},{value:"ninja",label:"NinjaRMM"},{value:"syncro",label:"Syncro"},{value:"manual",label:"CSV / Manual"}],D={exact:"bg-health-healthy text-white",high:"bg-blue-500 text-white",medium:"bg-health-warning text-white",low:"bg-orange-500 text-white",no_match:"bg-gray-500 text-white"},v={exact:"Exact Match",high:"High Confidence",medium:"Medium",low:"Low",no_match:"No Match"},k={missing_from_rmm:"bg-health-warning",missing_from_ad:"bg-blue-500",stale_rmm:"bg-gray-500",stale_ad:"bg-gray-500"},F={missing_from_rmm:"Missing from RMM",missing_from_ad:"Missing from AD",stale_rmm:"Stale in RMM",stale_ad:"Stale in AD"};function y(t){const l=t.trim().split(`
`);if(l.length<2)return[];const r=l[0].split(",").map(s=>s.trim().toLowerCase()),c=[];for(let s=1;s<l.length;s++){const n=l[s].split(",").map(a=>a.trim()),i={};r.forEach((a,o)=>{n[o]&&(a==="hostname"||a==="computer_name"||a==="name"?i.hostname=n[o]:a==="ip"||a==="ip_address"?i.ip_address=n[o]:a==="mac"||a==="mac_address"?i.mac_address=n[o]:a==="os"||a==="os_name"?i.os_name=n[o]:a==="serial"||a==="serial_number"?i.serial_number=n[o]:(a==="device_id"||a==="id")&&(i.device_id=n[o]))}),i.hostname&&c.push(i)}return c}const E=({summary:t})=>{const l=t.coverage_rate>=90?"text-health-healthy":t.coverage_rate>=70?"text-health-warning":"text-health-critical";return e.jsxs(p,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-label-primary mb-4",children:"Comparison Summary"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:`text-3xl font-bold ${l}`,children:[t.coverage_rate.toFixed(0),"%"]}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Coverage"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-label-primary",children:t.our_device_count}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Our Devices"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-label-primary",children:t.rmm_device_count}),e.jsx("div",{className:"text-sm text-label-secondary",children:"RMM Devices"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-health-healthy",children:t.matched_count}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Matched"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-400",children:t.exact_match_count}),e.jsx("div",{className:"text-sm text-label-secondary",children:"Exact Match"})]})]})]})},A=({matches:t})=>{const[l,r]=d.useState("all"),c=t.filter(s=>l==="all"?!0:s.confidence===l);return e.jsxs(p,{className:"mb-6",children:[e.jsxs("div",{className:"p-4 border-b border-glass-border",children:[e.jsx("h3",{className:"text-lg font-semibold text-label-primary mb-3",children:"Device Matches"}),e.jsx("div",{className:"flex gap-2 flex-wrap",children:["all","exact","high","medium","low","no_match"].map(s=>e.jsxs("button",{onClick:()=>r(s),className:`px-3 py-1.5 rounded-lg text-sm font-medium transition-colors ${l===s?"bg-accent-primary text-white":"text-label-secondary hover:bg-glass-bg/50"}`,children:[s==="all"?"All":v[s],e.jsxs("span",{className:"ml-1 text-xs opacity-70",children:["(",s==="all"?t.length:t.filter(n=>n.confidence===s).length,")"]})]},s))})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b border-glass-border",children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Our Device"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"RMM Device"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Confidence"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-medium text-label-secondary",children:"Matching Fields"})]})}),e.jsx("tbody",{children:c.map((s,n)=>{var i;return e.jsxs("tr",{className:"hover:bg-glass-bg/30 border-b border-glass-border/50",children:[e.jsx("td",{className:"px-4 py-3 font-medium text-label-primary",children:s.our_hostname}),e.jsx("td",{className:"px-4 py-3 text-label-secondary",children:((i=s.rmm_device)==null?void 0:i.hostname)||"-"}),e.jsxs("td",{className:"px-4 py-3",children:[e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${D[s.confidence]}`,children:v[s.confidence]}),e.jsxs("span",{className:"ml-2 text-xs text-label-tertiary",children:["(",(s.confidence_score*100).toFixed(0),"%)"]})]}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("div",{className:"flex gap-1 flex-wrap",children:s.matching_fields.map(a=>e.jsx("span",{className:"px-2 py-0.5 bg-glass-bg rounded text-xs text-label-secondary",children:a},a))})})]},n)})})]})})]})},L=({gaps:t})=>{if(t.length===0)return e.jsxs(p,{className:"p-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-label-primary mb-3",children:"Coverage Gaps"}),e.jsx("div",{className:"text-center text-health-healthy py-4",children:"No coverage gaps detected!"})]});const l=t.reduce((r,c)=>{const s=c.gap_type;return r[s]||(r[s]=[]),r[s].push(c),r},{});return e.jsxs(p,{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold text-label-primary mb-4",children:["Coverage Gaps (",t.length,")"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(l).map(([r,c])=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 rounded text-xs font-medium text-white ${k[r]}`,children:F[r]}),e.jsxs("span",{className:"text-sm text-label-secondary",children:["(",c.length,")"]})]}),e.jsxs("div",{className:"ml-4 space-y-2",children:[c.slice(0,10).map((s,n)=>e.jsxs("div",{className:"flex items-start gap-2 text-sm",children:[e.jsx("span",{className:"text-label-primary font-medium",children:s.device.hostname||"Unknown"}),e.jsx("span",{className:"text-label-tertiary",children:"-"}),e.jsx("span",{className:"text-label-secondary",children:s.recommendation})]},n)),c.length>10&&e.jsxs("div",{className:"text-label-tertiary text-sm",children:["...and ",c.length-10," more"]})]})]},r))})]})},$=({onCompare:t,isLoading:l})=>{const[r,c]=d.useState("manual"),[s,n]=d.useState(""),[i,a]=d.useState(0),o=d.useCallback(m=>{var g;const b=(g=m.target.files)==null?void 0:g[0];if(!b)return;const x=new FileReader;x.onload=N=>{var f;const j=(f=N.target)==null?void 0:f.result;n(j);const _=y(j);a(_.length)},x.readAsText(b)},[]),h=d.useCallback(async m=>{if(m.preventDefault(),!s)return;const b=y(s);b.length!==0&&await t({provider:r,devices:b.map(x=>({hostname:x.hostname||"",device_id:x.device_id,ip_address:x.ip_address,mac_address:x.mac_address,os_name:x.os_name,serial_number:x.serial_number}))})},[s,r,t]);return e.jsxs(p,{className:"p-6 mb-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-label-primary mb-4",children:"Upload RMM Data"}),e.jsxs("form",{onSubmit:h,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-2",children:"RMM Provider"}),e.jsx("select",{value:r,onChange:m=>c(m.target.value),className:"w-full px-4 py-2 bg-glass-bg border border-glass-border rounded-lg text-label-primary focus:outline-none focus:ring-2 focus:ring-accent-primary",children:R.map(m=>e.jsx("option",{value:m.value,children:m.label},m.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-label-secondary mb-2",children:"CSV Export File"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("input",{type:"file",accept:".csv",onChange:o,className:"flex-1 px-4 py-2 bg-glass-bg border border-glass-border rounded-lg text-label-primary file:mr-4 file:py-1 file:px-4 file:rounded-lg file:border-0 file:bg-accent-primary file:text-white file:cursor-pointer"}),i>0&&e.jsxs(w,{variant:"success",className:"whitespace-nowrap",children:[i," devices"]})]}),e.jsx("p",{className:"mt-1 text-xs text-label-tertiary",children:"CSV should have headers: hostname, ip_address, mac_address, os_name, device_id"})]}),e.jsx("button",{type:"submit",disabled:l||i===0,className:"w-full px-4 py-2 bg-accent-primary text-white rounded-lg font-medium hover:bg-accent-primary/80 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx(S,{size:"sm"})," Comparing..."]}):"Compare with Workstations"})]})]})},O=()=>{const{siteId:t}=M(),[l,r]=d.useState(null),[c,s]=d.useState(!1),[n,i]=d.useState(null),a=d.useCallback(async o=>{if(t){s(!0),i(null);try{const h=await C.compare(t,o);r(h)}catch(h){i(h instanceof Error?h.message:"Failed to compare")}finally{s(!1)}}},[t]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[e.jsx(u,{to:"/sites",className:"text-label-secondary hover:text-label-primary",children:"Sites"}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx(u,{to:`/sites/${t}`,className:"text-label-secondary hover:text-label-primary",children:t}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx(u,{to:`/sites/${t}/workstations`,className:"text-label-secondary hover:text-label-primary",children:"Workstations"}),e.jsx("span",{className:"text-label-tertiary",children:"/"}),e.jsx("span",{className:"text-label-primary",children:"RMM Comparison"})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-label-primary",children:"RMM Comparison"}),e.jsx("p",{className:"text-label-secondary mt-1",children:"Compare your AD-discovered workstations with RMM tool data to identify coverage gaps and duplicates"})]}),e.jsx($,{onCompare:a,isLoading:c}),n&&e.jsx(p,{className:"p-4 bg-health-critical/20 border-health-critical",children:e.jsx("p",{className:"text-health-critical",children:n})}),l&&e.jsxs(e.Fragment,{children:[e.jsx(E,{summary:l.summary}),e.jsx(A,{matches:l.matches}),e.jsx(L,{gaps:l.gaps})]})]})};export{O as RMMComparison,O as default};
