import{j as e,G as l,r as d,g as k,h as _,i as P,k as C,l as A,S as F,P as R}from"./index-ByrxzNCH.js";const S=({history:n,isLoading:x=!1})=>{const c=s=>new Date(s).toLocaleDateString(void 0,{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),m=s=>s>=95?"bg-health-healthy":s>=80?"bg-health-warning":"bg-health-critical";return x?e.jsxs(l,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recently Promoted"}),e.jsx("div",{className:"space-y-4",children:[1,2,3].map(s=>e.jsxs("div",{className:"flex gap-4 animate-pulse",children:[e.jsx("div",{className:"w-3 h-3 bg-separator-light rounded-full mt-1.5"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"h-4 bg-separator-light rounded w-1/2 mb-2"}),e.jsx("div",{className:"h-3 bg-separator-light rounded w-1/3"})]})]},s))})]}):n.length===0?e.jsxs(l,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recently Promoted"}),e.jsx("p",{className:"text-label-tertiary text-sm",children:"No promotions yet. Approve patterns above to start building your L1 rule library."})]}):e.jsxs(l,{children:[e.jsx("h2",{className:"text-lg font-semibold mb-4",children:"Recently Promoted"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute left-1.5 top-2 bottom-2 w-px bg-separator-light"}),e.jsx("div",{className:"space-y-4",children:n.map((s,r)=>e.jsxs("div",{className:"flex gap-4 relative",children:[e.jsx("div",{className:`w-3 h-3 rounded-full flex-shrink-0 mt-1.5 ${r===0?"bg-accent-primary":"bg-separator-light"}`}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"font-mono text-sm font-medium text-label-primary truncate",children:s.pattern_signature}),e.jsx("p",{className:"text-xs text-label-tertiary mt-0.5",children:c(s.promoted_at)})]}),e.jsx("div",{className:"flex items-center gap-2 flex-shrink-0",children:e.jsx("span",{className:"px-2 py-0.5 text-xs font-medium bg-level-l1 text-white rounded",children:s.rule_id})})]}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:`w-2 h-2 rounded-full ${m(s.post_promotion_success_rate)}`}),e.jsxs("span",{className:"text-label-tertiary",children:[s.post_promotion_success_rate.toFixed(1),"% success"]})]}),e.jsxs("div",{className:"text-label-tertiary",children:[s.executions_since_promotion," executions"]})]})]})]},s.id))})]})]})},D=()=>{var j,g;const[n,x]=d.useState(null),[c,m]=d.useState(null),{data:s,isLoading:r,isError:b}=k(),{data:o=[],isLoading:f,isError:N}=_(),{data:y=[],isLoading:v}=P(50),h=C(),p=A(),i=d.useCallback((t,a)=>{m({type:t,message:a}),setTimeout(()=>m(null),4e3)},[]),u=d.useCallback(async t=>{x(t);try{const a=await h.mutateAsync(t);i("success",`Pattern promoted to ${a.new_rule_id}`)}catch(a){i("error",`Failed to promote: ${a instanceof Error?a.message:"Unknown error"}`)}finally{x(null)}},[h,i]),w=d.useCallback(async t=>{try{await p.mutateAsync(t),i("success","Pattern rejected")}catch(a){i("error",`Failed to reject: ${a instanceof Error?a.message:"Unknown error"}`)}},[p,i]),L=async()=>{for(const t of o)await u(t.id)};return e.jsxs("div",{className:"space-y-6",children:[c&&e.jsx("div",{className:`px-4 py-3 rounded-lg text-sm font-medium ${c.type==="success"?"bg-health-healthy/10 text-health-healthy border border-health-healthy/20":"bg-health-critical/10 text-health-critical border border-health-critical/20"}`,children:c.message}),(b||N)&&e.jsx("div",{className:"bg-health-critical/10 border border-health-critical/20 px-4 py-3 rounded-lg",children:e.jsx("p",{className:"text-sm text-health-critical font-medium",children:"Failed to load learning data. Check your connection and try refreshing."})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(l,{padding:"md",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"L1 Rules"}),r?e.jsx("div",{className:"h-9 animate-pulse bg-separator-light rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl font-semibold",children:(s==null?void 0:s.total_l1_rules)??0}),e.jsx("p",{className:"text-xs text-health-healthy",children:"Deterministic resolutions"})]})]}),e.jsxs(l,{padding:"md",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"L2 Decisions (30d)"}),r?e.jsx("div",{className:"h-9 animate-pulse bg-separator-light rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-3xl font-semibold",children:(s==null?void 0:s.total_l2_decisions_30d)??0}),e.jsx("p",{className:"text-xs text-label-tertiary",children:"LLM-assisted resolutions"})]})]}),e.jsxs(l,{padding:"md",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"L1 Resolution Rate"}),r?e.jsx("div",{className:"h-9 animate-pulse bg-separator-light rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:"text-3xl font-semibold text-health-healthy",children:[((j=s==null?void 0:s.l1_resolution_rate)==null?void 0:j.toFixed(1))??0,"%"]}),e.jsx("p",{className:"text-xs text-label-tertiary",children:"Target: 70-80%"})]})]}),e.jsxs(l,{padding:"md",children:[e.jsx("p",{className:"text-label-tertiary text-sm",children:"Promotion Success"}),r?e.jsx("div",{className:"h-9 animate-pulse bg-separator-light rounded mt-1"}):e.jsxs(e.Fragment,{children:[e.jsxs("p",{className:`text-3xl font-semibold ${((s==null?void 0:s.promotion_success_rate)??0)>=90?"text-health-healthy":"text-health-warning"}`,children:[((g=s==null?void 0:s.promotion_success_rate)==null?void 0:g.toFixed(1))??0,"%"]}),e.jsx("p",{className:"text-xs text-label-tertiary",children:"Post-promotion accuracy"})]})]})]}),e.jsxs(l,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-lg font-semibold",children:["Awaiting Promotion (",o.length,")"]}),e.jsx("p",{className:"text-sm text-label-tertiary mt-1",children:"L2 patterns with consistent success ready for L1 promotion"})]}),o.length>0&&e.jsx("button",{onClick:L,disabled:n!==null,className:"btn-primary text-sm disabled:opacity-50",children:"Approve All"})]}),f?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(F,{size:"lg"})}):o.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-health-healthy/10 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-health-healthy",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),e.jsx("p",{className:"text-label-secondary font-medium",children:"All caught up!"}),e.jsx("p",{className:"text-label-tertiary text-sm mt-1",children:"No patterns awaiting promotion at this time."})]}):e.jsx("div",{className:"space-y-4",children:o.map(t=>e.jsx(R,{candidate:t,onApprove:u,onReject:w,isPromoting:n===t.id},t.id))})]}),e.jsx(S,{history:y,isLoading:v}),e.jsxs(l,{padding:"md",children:[e.jsx("h3",{className:"font-semibold text-label-primary mb-2",children:"How the Learning Loop Works"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 text-sm text-label-secondary",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 rounded-full bg-level-l2/20 flex items-center justify-center",children:e.jsx("span",{className:"text-level-l2 font-bold text-xs",children:"L2"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-label-primary",children:"Pattern Detection"}),e.jsx("p",{className:"text-xs",children:"LLM identifies recurring incident patterns and successful resolutions"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 rounded-full bg-accent-primary/20 flex items-center justify-center",children:e.jsx("svg",{className:"w-4 h-4 text-accent-primary",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-label-primary",children:"Human Review"}),e.jsx("p",{className:"text-xs",children:"Admin approves patterns meeting success thresholds for promotion"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 flex-shrink-0 rounded-full bg-level-l1/20 flex items-center justify-center",children:e.jsx("span",{className:"text-level-l1 font-bold text-xs",children:"L1"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-label-primary",children:"Deterministic Rule"}),e.jsx("p",{className:"text-xs",children:"Pattern becomes instant L1 resolution - no LLM cost, <100ms"})]})]})]})]})]})};export{D as Learning,D as default};
